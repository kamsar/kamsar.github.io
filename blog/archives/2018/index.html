<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2018 | Kam&#39;s Idea Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Kam&#39;s Idea Log">
<meta property="og:url" content="https://kamsar.net/blog/archives/2018/index.html">
<meta property="og:site_name" content="Kam&#39;s Idea Log">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Kam Figy">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@kamsar">
  
    <link rel="alternative" href="/index.php/feed" title="Kam&#39;s Idea Log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62284328-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo">
        <span class="site-title">Kam&#39;s Idea Log</span>
        <span class="subtitle">C#, Jamstack, and Shenanigans</span>
      </a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=40" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=80 2x" alt="omg the beard"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </td>
      </tr>
    </table>
  </div>
  
  <div id="header-sub" class="header-sub header-inner">
    <div class="outer">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=128" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=256 2x" alt="#sitecorebeard">
      <h2 id="name">Kam Figy</h2>
      <h3 id="title">Principal Platform Architect at</h3>
      <a class="corp-logo" href="https://uniform.dev" target="_blank"><img src="/css/images/uniform-logo.svg" alt="Uniform" width="180"></a>
      <span id="location"><i class="fa fa-map-marker"></i>Vancouver, WA USA</span>
      <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/kamsar">FOLLOW</a>
  	</div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a target="_blank" rel="noopener" href="https://github.com/kamsar" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a target="_blank" rel="noopener" href="https://twitter.com/kamsar" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/index.php/feed" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    <div class="article-info profile-block bio">
      <h2>About</h2>
      <p>Kam has been making websites since 1996, starting out with a 14.4k modem on a <a href="https://en.wikipedia.org/wiki/Party_line_(telephony)" target="_blank">party line</a> in the Hawaiian rainforest. A veteran developer, architect, and speaker, he's been working in the content management space for well over a decade. Kam is the author of <a href="https://github.com/kamsar/Unicorn" target="_blank">Unicorn</a>, <a href="https://github.com/kamsar/Synthesis" target="_blank">Synthesis</a>, <a href="https://github.com/kamsar/Dianoga" target="_blank">Dianoga</a>, and several other open-source libraries.</p>
    </div>
  </div>
</aside>
      <section id="main">
  
  
    
    
      
        <div class="archive-year-wrap">
          <i class="fa fa-calendar"></i>
          <a href="/archives/2018" class="archive-year">2018</a>
        </div>
    
    <article id="post-Routing-Sitecore-links-with-JSS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2018/09/Routing-Sitecore-links-with-JSS/">Routing Sitecore links with JSS</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2018/09/Routing-Sitecore-links-with-JSS/">
    <time datetime="2018-09-12T18:59:43.000Z" itemprop="datePublished">September 12, 2018</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/JSS/">JSS</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>When building a single-page app with <a target="_blank" rel="noopener" href="https://jss.sitecore.net/">Sitecore JSS</a> and defining internal links in Sitecore content, you may notice that clicking the link in the JSS app does not act like a <em>single</em> page app. Instead the link click causes a full page refresh to occur, because the routing library used by the app is not aware that the link emitted by JSS can be treated as a route link.</p>
<p>Maybe you don’t want that to happen, because you like the fluidity of single-page apps or want to reduce bandwidth. Excellent! You’ve come to the right place.</p>
<p>The following examples use React, but the same architectural principles will translate well to Vue or Angular apps and the JSS field data schema is identical.</p>
<p>There are two places where we can receive links back from Sitecore:</p>
<h2 id="Link-Fields"><a href="#Link-Fields" class="headerlink" title="Link Fields"></a>Link Fields</h2><p>Sitecore supports content fields that are explicitly hyperlinks (usually <em>General Link</em> fields, also referred to as <code>CommonFieldTypes.GeneralLink</code> in JSS disconnected data). When returned these fields contain link data (a <code>href</code>, optionally body text, CSS class, target, etc). In JSS apps, these are rendered using the <code>Link</code> component like so:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&#x27;@sitecore-jss/sitecore-jss-react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyJSSComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">field</span>=<span class="string">&#123;props.fields.externalLink&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>This gives us normal anchor tag output in the DOM:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/path&quot;</span>&gt;</span>Link Text<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>But in <code>react-router</code>, a link needs to be rendered using <code>react-router-dom</code>‘s <code>Link</code> component instead, for example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RouterLinkComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/path&quot;</span>&gt;</span>Link Text<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>To make JSS general links render using <code>react-router</code> links for internal links, we can create a component that conditionally chooses the link component like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&#x27;@sitecore-jss/sitecore-jss-react&#x27;</span>;</span><br><span class="line"><span class="comment">// note we&#x27;re aliasing the router&#x27;s link component name, since it conflicts with JSS&#x27; link component</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link <span class="keyword">as</span> RouterLink &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** React component that turns Sitecore link values that start with / into react-router route links */</span></span><br><span class="line"><span class="keyword">const</span> RoutableSitecoreLink = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> hasValidHref = props.field &amp;&amp; props.field.value &amp;&amp; props.field.value.href;</span><br><span class="line">  <span class="keyword">const</span> isEditing = props.editable &amp;&amp; props.field.editable;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// only want to apply the routing link if not editing (if editing, need to render editable link value)</span></span><br><span class="line">  <span class="keyword">if</span>(hasValidHref &amp;&amp; !isEditing) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = props.field.value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// determine if a link is a route or not. This logic may not be appropriate for all usages.</span></span><br><span class="line">    <span class="keyword">if</span>(value.href.startsWith(<span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&#123;value.href&#125;</span> <span class="attr">title</span>=<span class="string">&#123;value.title&#125;</span> <span class="attr">target</span>=<span class="string">&#123;value.target&#125;</span> <span class="attr">className</span>=<span class="string">&#123;value.class&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;props.children || value.text || value.href&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Link</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage - drop-in replacement for JSS&#x27; Link component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyJSSComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">RoutableSitecoreLink</span> <span class="attr">field</span>=<span class="string">&#123;props.fields.externalLink&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>With this component, now your internal link values will be turned into router links and result in only a new fetch of route data instead of a page refresh!</p>
<h2 id="Rich-Text-Fields"><a href="#Rich-Text-Fields" class="headerlink" title="Rich Text Fields"></a>Rich Text Fields</h2><p>Rich Text fields are a more interesting proposition because they contain free text that is placed into the DOM, and we cannot inject <code>RouterLink</code> components directly into the HTML blob. Instead we can use React’s DOM access to attach an event handler to the rich text markup after it’s rendered by React that will trigger route navigation.</p>
<p>Similar to the general link field handling, we can wrap the JSS default <code>RichText</code> component with our own component that selects whether to bind the route handling events based on whether we’re editing the page or not:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RichText &#125; <span class="keyword">from</span> <span class="string">&#x27;@sitecore-jss/sitecore-jss-react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Binds route handling to internal links within a rich text field */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouteLinkedRichText</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.routeHandler = <span class="built_in">this</span>.routeHandler.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handler function called on click of route links</span></span><br><span class="line">  <span class="comment">// pushes the click into the router history thus changing the route</span></span><br><span class="line">  <span class="comment">// props.history comes from the react-router withRouter() higher order component.</span></span><br><span class="line">  <span class="function"><span class="title">routeHandler</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    <span class="built_in">this</span>.props.history.push(event.target.pathname);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// rebinds event handlers to route links within this component</span></span><br><span class="line">  <span class="comment">// fired both on mount and update</span></span><br><span class="line">  <span class="function"><span class="title">bindRouteLinks</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hasText = <span class="built_in">this</span>.props.field &amp;&amp; <span class="built_in">this</span>.props.field.value;</span><br><span class="line">    <span class="keyword">const</span> isEditing = <span class="built_in">this</span>.props.editable &amp;&amp; <span class="built_in">this</span>.props.field.editable;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(hasText &amp;&amp; !isEditing) &#123;</span><br><span class="line">      <span class="keyword">const</span> node = ReactDOM.findDOMNode(<span class="built_in">this</span>);</span><br><span class="line">      <span class="comment">// selects all links that start with &#x27;/&#x27; - this logic may be inappropriate for some advanced uses</span></span><br><span class="line">      <span class="keyword">const</span> internalLinks = node.querySelectorAll(<span class="string">&#x27;a[href^=&quot;/&quot;]&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      internalLinks.forEach(<span class="function">(<span class="params">link</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// the component can be updated multiple times during its lifespan,</span></span><br><span class="line">        <span class="comment">// and we don&#x27;t want to bind the same event handler several times so unbind first</span></span><br><span class="line">        link.removeEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="built_in">this</span>.routeHandler, <span class="literal">false</span>);</span><br><span class="line">        link.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="built_in">this</span>.routeHandler, <span class="literal">false</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// called once when component is created</span></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.bindRouteLinks();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// called if component data changes _after_ created</span></span><br><span class="line">  <span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.bindRouteLinks();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// strip the &#x27;staticContext&#x27; prop from withRouter() </span></span><br><span class="line">    <span class="comment">// to avoid confusing React before we pass it down</span></span><br><span class="line">    <span class="keyword">const</span> &#123; staticContext, ...props &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">RichText</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// augment the component with the react-router context using withRouter()</span></span><br><span class="line"><span class="comment">// this gives us props.history to push new routes</span></span><br><span class="line">RouteLinkedRichText = withRouter(RouteLinkedRichText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage - drop-in replacement for JSS&#x27; RichText component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyJSSComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">RouteLinkedRichText</span> <span class="attr">field</span>=<span class="string">&#123;props.fields.richText&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<p>Now internal links entered in rich text fields will also be treated as route links.</p>
<h2 id="Advanced-Usages"><a href="#Advanced-Usages" class="headerlink" title="Advanced Usages"></a>Advanced Usages</h2><p>These examples use simple internal link detection that consists of “starts with <code>/</code>.” There are some edge cases that can defeat simple link detection, such as:</p>
<ul>
<li>Scheme-insensitive links (<code>//google.com</code>) that are HTTP or HTTPS depending on the current page. These are an antipattern; encrypt all your resources.</li>
<li>Links to static files (i.e. media files).</li>
</ul>
<p>For use cases such as this, more advanced detection of internal links may be required that is situational for your implementation.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2018/09/Routing-Sitecore-links-with-JSS/" data-id="ckrl9emyq005j98q7416p17x1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Code-splitting-with-Sitecore-JSS-React" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2018/08/Code-splitting-with-Sitecore-JSS-React/">Code splitting with Sitecore JSS + React</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2018/08/Code-splitting-with-Sitecore-JSS-React/">
    <time datetime="2018-08-01T15:43:31.000Z" itemprop="datePublished">August 1, 2018</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/JSS/">JSS</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Page weight - how much data a user needs to download to view your website - is a big deal in JavaScript applications. The more script that an application loads, the longer it takes to render for a user - especially in critical mobile scenarios. The longer it takes an app to render, the less happy the users of that app are. JavaScript is especially important to keep lightweight, because JS is not merely downloaded like an image - it also has to be <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/javascript-startup-optimization/">parsed and compiled by the browser</a>. Especially on slower mobile devices, this parsing can take longer than the download! So less script is a very good thing.</p>
<p>Imagine a large Sitecore JSS application, with a large number of JavaScript components. With the default JSS applications the entire app JS must be deployed to the user when any page in the application loads. This is simple to reason about and performs well with smaller sites, but on a large site it is detrimental to performance if the home page must load 40 components that are not used on that route in order to render.</p>
<h2 id="Enter-Code-Splitting"><a href="#Enter-Code-Splitting" class="headerlink" title="Enter Code Splitting"></a>Enter Code Splitting</h2><p><a target="_blank" rel="noopener" href="https://webpack.js.org/guides/code-splitting/"><em>Code Splitting</em></a> is a term for breaking up your app’s JS into several chunks, usually via <a target="_blank" rel="noopener" href="https://webpack.js.org/">webpack</a>. There are many ways that code splitting can be set up, but we’ll focus on two popular automatic techniques: route-level code splitting, and component-level code splitting.</p>
<p>Route-level code splitting creates a JS bundle for each route in an application. Because of this, it relies on the app using <em>static routing</em> - in other words knowing all routes in advance, and having static components on those routes. This is probably the most widespread code splitting technique, but it is fundamentally incompatible with JSS because the app’s structure and layout is defined by Sitecore. We do not know all of the routes that an app has at build time, nor do we know which components are on those routes because that is also defined by Sitecore.</p>
<p>Component-level code splitting creates a JS bundle for each component in an application. This results in quite granular bundles, but overall excellent compatibility with JSS because it works great with dynamic routing - we only need to load the JS for the components that an author has added to a given route, and they’re individually cacheable by the browser providing great caching across routes too.</p>
<h2 id="Component-level-Code-Splitting-with-React"><a href="#Component-level-Code-Splitting-with-React" class="headerlink" title="Component-level Code Splitting with React"></a>Component-level Code Splitting with React</h2><p>The <a target="_blank" rel="noopener" href="https://github.com/jamiebuilds/react-loadable">react-loadable</a> library provides excellent component-level code splitting capabilities to React apps. Let’s add it to the JSS React app and split up our components!</p>
<h3 id="Step-1-Add-react-loadable"><a href="#Step-1-Add-react-loadable" class="headerlink" title="Step 1: Add react-loadable"></a>Step 1: Add <code>react-loadable</code></h3><p>We need some extra npm packages to make this work.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// yarn</span><br><span class="line">yarn add react-loadable</span><br><span class="line">yarn add babel-plugin-syntax-dynamic-import babel-plugin-dynamic-import-node --dev</span><br><span class="line"></span><br><span class="line">// npm</span><br><span class="line">npm i react-loadable</span><br><span class="line">npm i babel-plugin-syntax-dynamic-import babel-plugin-dynamic-import-node --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="Step-2-Make-the-componentFactory-use-code-splitting"><a href="#Step-2-Make-the-componentFactory-use-code-splitting" class="headerlink" title="Step 2: Make the componentFactory use code splitting"></a>Step 2: Make the <code>componentFactory</code> use code splitting</h3><p>In order to use code splitting, we have to tell <code>create-react-app</code> (which uses <code>webpack</code>) how to split our output JS. This is pretty easy using <a target="_blank" rel="noopener" href="https://reactjs.org/docs/code-splitting.html#import">dynamic <code>import</code></a>, which works like a normal <code>import</code> or <code>require</code> but loads the module lazily at runtime. <a target="_blank" rel="noopener" href="https://github.com/jamiebuilds/react-loadable">react-loadable</a> provides a simple syntax to wrap any React component in a lazy-loading shell.</p>
<p>In JSS applications, the <em>Component Factory</em> is a mapping of the names of components into the implementation of those components - for example to allow the JSS app to resolve the component named <code>&#39;ContentBlock&#39;</code>, provided by the Sitecore Layout Service, to a React component defined in <code>ContentBlock.js</code>. The Component Factory is a perfect place to put component-level code splitting.</p>
<p>In a JSS React app, the Component Factory is generated code by default - inferring the components to register based on filesystem conventions. The <code>/scripts/generate-component-factory.js</code> file defines how the code is generated. The generated code - created when a build starts - is emitted to <code>/src/temp/componentFactory.js</code>. Before we alter the code generator to generate split components, let’s compare registering a component in each way:</p>
<h5 id="JSS-React-standard-componentFactory-js"><a href="#JSS-React-standard-componentFactory-js" class="headerlink" title="JSS React standard componentFactory.js"></a>JSS React standard componentFactory.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// static import</span></span><br><span class="line"><span class="keyword">import</span> ContentBlock <span class="keyword">from</span> <span class="string">&#x27;../components/ContentBlock&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create component map (identical code)</span></span><br><span class="line"><span class="keyword">const</span> components = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">components.set(<span class="string">&#x27;ContentBlock&#x27;</span>, ContentBlock);</span><br></pre></td></tr></table></figure>

<h5 id="react-loadable-componentFactory-js"><a href="#react-loadable-componentFactory-js" class="headerlink" title="react-loadable componentFactory.js"></a>react-loadable componentFactory.js</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">&#x27;react-loadable&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// loadable dynamic import component - lazily loads the component implementation when it is first used</span></span><br><span class="line"><span class="keyword">const</span> ContentBlock = Loadable(&#123;</span><br><span class="line">  <span class="comment">// setting webpackChunkName lets us have a nice chunk filename like ContentBlock.hash.js instead of 1.hash.js</span></span><br><span class="line">  <span class="attr">loader</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;ContentBlock&quot; */</span> <span class="string">&#x27;../components/ContentBlock&#x27;</span>),</span><br><span class="line">  <span class="comment">// this is a react component shown while lazy loading. See the react-loadable docs for guidance on making a good one.</span></span><br><span class="line">  <span class="attr">loading</span>: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">  <span class="comment">// this module name should match the webpackChunkName that was set. This is used to determine dependency during server-side rendering.</span></span><br><span class="line">  modules: [<span class="string">&#x27;ContentBlock&#x27;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create component map (identical code)</span></span><br><span class="line"><span class="keyword">const</span> components = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">components.set(<span class="string">&#x27;ContentBlock&#x27;</span>, ContentBlock);</span><br></pre></td></tr></table></figure>

<h4 id="Updating-the-Component-Factory-Code-Generation"><a href="#Updating-the-Component-Factory-Code-Generation" class="headerlink" title="Updating the Component Factory Code Generation"></a>Updating the Component Factory Code Generation</h4><p>In order to have our component factory use splitting, let’s update the code generator to emit <code>react-loadable</code> component definitions. </p>
<p>Modify <code>/scripts/generate-component-factory.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add this function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadableComponent</span>(<span class="params">importVarName, componentFolder</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`const <span class="subst">$&#123;importVarName&#125;</span> = Loadable(&#123;</span></span><br><span class="line"><span class="string">    loader: () =&gt; import(/* webpackChunkName: &quot;<span class="subst">$&#123;componentFolder&#125;</span>&quot; */ &#x27;../components/<span class="subst">$&#123;componentFolder&#125;</span>&#x27;),</span></span><br><span class="line"><span class="string">    loading: () =&gt; &lt;div&gt;Loading...&lt;/div&gt;,</span></span><br><span class="line"><span class="string">    modules: [&#x27;<span class="subst">$&#123;componentFolder&#125;</span>&#x27;],</span></span><br><span class="line"><span class="string">    &#125;);`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// modify generateComponentFactory()...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// after const imports = [];</span></span><br><span class="line">imports.push(<span class="string">`import React from &#x27;react&#x27;;`</span>);</span><br><span class="line">imports.push(<span class="string">`import Loadable from &#x27;react-loadable&#x27;;`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// change imports.push(``import $&#123;importVarName&#125; from &#x27;../components/$&#123;componentFolder&#125;&#x27;;``); to</span></span><br><span class="line">imports.push(LoadableComponent(importVarName, componentFolder));</span><br></pre></td></tr></table></figure>

<p>You can find a completed <a target="_blank" rel="noopener" href="https://gist.github.com/kamsar/9a616dffdb2dc1d76772cc796d716b03">gist of these changes here</a>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the loader.</p>
<h5 id="Try-it"><a href="#Try-it" class="headerlink" title="Try it!"></a>Try it!</h5><p>Start your app up with <code>jss start</code>. At this point Code Splitting should be working: you should see a JS file get loaded for each component on a route, and a short flash of <code>Loading...</code> when the route initially loads.</p>
<p>But it still has some issues that could make it more usable. If the app is server-side rendered in <a target="_blank" rel="noopener" href="https://jss.sitecore.net/docs/fundamentals/application-modes">headless or integrated modes</a> none of the content will be present because the dynamic imports are asynchronous and have not resolved before the SSR completes. We’d also love to avoid that flash of loading text if the page was server-side rendered, too. Well guess what, we can do all of that!</p>
<h3 id="Step-3-Configure-code-splitting-for-Server-Side-Rendering"><a href="#Step-3-Configure-code-splitting-for-Server-Side-Rendering" class="headerlink" title="Step 3: Configure code splitting for Server-Side Rendering"></a>Step 3: Configure code splitting for Server-Side Rendering</h3><p>Server-side rendering with code splitting is a bit more complex. There are several pieces that the app needs to support:</p>
<ul>
<li>Preload all lazy loaded components, so that they render immediately during server-side rendering instead of starting to load async and leaving a loading message in the SSR HTML.</li>
<li>Determine which lazy loaded components were used during rendering, so that we can preload the same components’ JS files on the client-side to avoid the flash of loading text.</li>
<li>Emit <code>&lt;script&gt;</code> tags to preload the used components’ JS files on the client side into the SSR HTML.</li>
</ul>
<h4 id="3-1-Configure-SSR-Webpack-to-understand-dynamic-import"><a href="#3-1-Configure-SSR-Webpack-to-understand-dynamic-import" class="headerlink" title="3.1: Configure SSR Webpack to understand dynamic import"></a>3.1: Configure SSR Webpack to understand dynamic import</h4><p>The build of the server-side JS bundle is separate from the client bundle. We need to teach the server-side build how to compile the dynamic import expressions. Open <code>/server/server.webpack.config.js</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add these after other imports</span></span><br><span class="line"><span class="keyword">const</span> dynamicImport = <span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-syntax-dynamic-import&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dynamicImportNode = <span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-dynamic-import-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> loadableBabel = <span class="built_in">require</span>(<span class="string">&#x27;react-loadable/babel&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the plugins to your babel-loader section</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">use: &#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">  <span class="attr">babelrc</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">presets</span>: [env, stage0, reactApp],</span><br><span class="line">  <span class="comment">// [CS] ADDED FOR CODE SPLITTING</span></span><br><span class="line">  <span class="attr">plugins</span>: [dynamicImport, dynamicImportNode, loadableBabel],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>You can find a completed <a target="_blank" rel="noopener" href="https://gist.github.com/kamsar/016b591148325d7de9260042d8113286">gist of these changes here</a>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the webpack config.</p>
<h4 id="3-2-Configure-server-js"><a href="#3-2-Configure-server-js" class="headerlink" title="3.2: Configure server.js"></a>3.2: Configure server.js</h4><p>The <code>/server/server.js</code> is the entry point to the JSS React app when it’s rendered on the server-side. We need to teach this entry point how to successfully execute SSR with lazy loaded components, and to emit preload script tags for used components.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add to the top</span></span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">&#x27;react-loadable&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> manifest <span class="keyword">from</span> <span class="string">&#x27;../build/asset-manifest.json&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertLoadableModulesToScripts</span>(<span class="params">usedModules</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.keys(manifest)</span><br><span class="line">    .filter(<span class="function">(<span class="params">chunkName</span>) =&gt;</span> usedModules.indexOf(chunkName.replace(<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) &gt; -<span class="number">1</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">k</span>) =&gt;</span> <span class="string">`&lt;script src=&quot;<span class="subst">$&#123;manifest[k]&#125;</span>&quot;&gt;&lt;/script&gt;`</span>)</span><br><span class="line">    .join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add after const graphQLClient...</span></span><br><span class="line"><span class="keyword">const</span> loadableModules = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// add after initializei18n()...</span></span><br><span class="line">.then(<span class="function">() =&gt;</span> Loadable.preloadAll())</span><br><span class="line"></span><br><span class="line"><span class="comment">// wrap the `&lt;AppRoot&gt;` component with the loadable used-component-capture component</span></span><br><span class="line">&lt;Loadable.Capture report=&#123;<span class="function">(<span class="params"><span class="built_in">module</span></span>) =&gt;</span> loadableModules.push(<span class="built_in">module</span>)&#125;&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">AppRoot</span> <span class="attr">path</span>=<span class="string">&#123;path&#125;</span> <span class="attr">Router</span>=<span class="string">&#123;StaticRouter&#125;</span> <span class="attr">graphQLClient</span>=<span class="string">&#123;graphQLClient&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/Loadable.Capture&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// append another .replace() to the rendered HTML transformations</span></span><br><span class="line">.replace(<span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">`<span class="subst">$&#123;convertLoadableModulesToScripts(loadableModules)&#125;</span>&lt;script&gt;`</span>);</span><br></pre></td></tr></table></figure>

<p>You can find a completed <a target="_blank" rel="noopener" href="https://gist.github.com/kamsar/29370b58f7a4fb15bed74521e01ad6bc">gist of these changes here</a> <strong>with better explanatory comments</strong>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the entry point.</p>
<h4 id="3-3-Configure-client-side-index-js"><a href="#3-3-Configure-client-side-index-js" class="headerlink" title="3.3: Configure client-side index.js"></a>3.3: Configure client-side index.js</h4><p>The <code>/src/index.js</code> is the entry point to the JSS React app when it’s rendered on the browser-side. We need to teach this entry point how to wait to ensure that all preloaded components that SSR may have emitted to the page are done loading before we render the JSS app the first time to avoid a flash of loading text.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add to the top</span></span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">&#x27;react-loadable&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add after i18ninit()</span></span><br><span class="line">.then(<span class="function">() =&gt;</span> Loadable.preloadReady())</span><br></pre></td></tr></table></figure>

<p>You can find a completed <a target="_blank" rel="noopener" href="https://gist.github.com/kamsar/ecbc0a50fdb877eb598ef9c3a385aff9">gist of these changes here</a>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the entry point.</p>
<h3 id="Step-4-Try-it-out"><a href="#Step-4-Try-it-out" class="headerlink" title="Step 4: Try it out"></a>Step 4: Try it out</h3><p>With the code changes to enable splitting complete, deploy your app to Sitecore and try it in integrated mode. You should see the SSR HTML include a script tag for every component used on the route, and the rendering will wait until the components have preloaded before showing the application. This preloading means the browser does not have to wait for React to boot up before beginning load of the components, resulting in a much faster page load time.</p>
<img src="/index.php/2018/08/Code-splitting-with-Sitecore-JSS-React/ssr-trace.png" class="">

<p>The ideal component loading technique for each app will be different depending on the number and size of each component. Using the standard JSS styleguide sample app, enabling component code-splitting like this resulted in transferring almost 40k less data when loading the home page (which has a single component) vs the styleguide page (which has many components). This difference increases with the total number of components in a JSS app - but for most apps, code splitting is a smart idea if the app has many components that are used on only a few pages.</p>
<h2 id="Sources"><a href="#Sources" class="headerlink" title="Sources"></a>Sources</h2><ul>
<li><a target="_blank" rel="noopener" href="https://medium.com/bucharestjs/upgrading-a-create-react-app-project-to-a-ssr-code-splitting-setup-9da57df2040a">Upgrading a create-react-app project to a SSR + code splitting setup</a></li>
<li><a target="_blank" rel="noopener" href="https://serverless-stack.com/chapters/code-splitting-in-create-react-app.html">Code Splitting in Create React App</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jamiebuilds/react-loadable">react-loadable</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.js.org/guides/code-splitting/">Webpack Code Splitting Guide</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2018/08/Code-splitting-with-Sitecore-JSS-React/" data-id="ckrl9emyq005h98q7ar4xcpr4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Deploying-Disconnected-JSS-Apps" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2018/07/Deploying-Disconnected-JSS-Apps/">Deploying Disconnected JSS Apps</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2018/07/Deploying-Disconnected-JSS-Apps/">
    <time datetime="2018-07-27T15:16:07.000Z" itemprop="datePublished">July 27, 2018</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/JSS/">JSS</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>It’s possible to deploy server-side rendered <a target="_blank" rel="noopener" href="https://jss.sitecore.net/">Sitecore JSS</a> sites in <a target="_blank" rel="noopener" href="https://jss.sitecore.net/docs/fundamentals/application-modes">disconnected mode</a>. When deployed this way, the JSS app will run using disconnected layout and content data, and will not use a Sitecore backend.</p>
<h2 id="Why-would-I-want-this"><a href="#Why-would-I-want-this" class="headerlink" title="Why would I want this?"></a>Why would I want this?</h2><p>In a word, <em>previewing</em>. Imagine during early development and prototyping of a JSS implementation. There’s a team of designers, UX architects, and frontend developers who are designing the app and its interactions. In most cases, Sitecore developers may not be involved yet - or if they are involved, there is no Sitecore instance set up.</p>
<p>This is one of the major advantages of JSS - using disconnected mode, a team like this can develop non-throwaway frontend for the final JSS app. But stakeholders will want to review the in-progress JSS app somewhere other than <code>http://localhost:3001</code>, so how do we put a JSS site somewhere shared without having a Sitecore backend?</p>
<blockquote>
<p>Wondering about real-world usage?<br>The <a target="_blank" rel="noopener" href="https://jss.sitecore.net/">JSS docs</a> use this technique.</p>
</blockquote>
<h2 id="How-does-it-work"><a href="#How-does-it-work" class="headerlink" title="How does it work?"></a>How does it work?</h2><p>Running a disconnected JSS app is a lot like <a target="_blank" rel="noopener" href="https://jss.sitecore.net/docs/fundamentals/application-modes">headless mode</a>: a reverse proxy is set up that proxies incoming requests to Layout Service, then transforms the result of the LS call into HTML using JS server-side rendering and returns it. In the case of disconnected deployment instead of the proxy sending requests to the Sitecore hosted Layout Service, the requests are proxied to the disconnected layout service.</p>
<h2 id="Setting-up-a-disconnected-app-step-by-step"><a href="#Setting-up-a-disconnected-app-step-by-step" class="headerlink" title="Setting up a disconnected app step by step"></a>Setting up a disconnected app step by step</h2><p>To deploy a disconnected app you’ll need a Node-compatible host. This is easiest with something like Heroku or another PaaS Node host, but it can also be done on any machine that can run Node. For our example, we’ll use <a target="_blank" rel="noopener" href="https://www.heroku.com/">Heroku</a>.</p>
<h3 id="Configuring-the-app-for-disconnected-deployment"><a href="#Configuring-the-app-for-disconnected-deployment" class="headerlink" title="Configuring the app for disconnected deployment"></a>Configuring the app for disconnected deployment</h3><p>Any of the JSS sample templates will work for this technique. <a target="_blank" rel="noopener" href="https://jss.sitecore.net/docs/getting-started/quick-start">Create yourself a JSS app with the CLI in 5 minutes</a> if you need one to try.</p>
<ol>
<li>Ensure the app has no <code>scjssconfig.json</code> in the root. This will make the build use the local layout service.</li>
<li>Create a build of the JSS app with <code>jss build</code>. This will build the artifacts that the app needs to run.</li>
<li>Install npm packages necessary to host a disconnected server: <code>yarn add @sitecore-jss/sitecore-jss-proxy express</code> (substitute <code>npm i --save</code> if you use npm instead of yarn)</li>
<li>Deploy the following code to <code>/scripts/disconnected-ssr.js</code> (or similar path). Note: this code is set up for React, and will require minor tweaks for Angular or Vue samples (<code>build</code> -&gt; <code>dist</code>) <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const &#123; appName, language, sitecoreDistPath &#125; = require(&#x27;../package.json&#x27;).config;</span><br><span class="line">const scProxy = require(&#x27;@sitecore-jss/sitecore-jss-proxy&#x27;).default;</span><br><span class="line">const &#123; createDefaultDisconnectedServer &#125; = require(&#x27;@sitecore-jss/sitecore-jss-dev-tools&#x27;);</span><br><span class="line">const app = require(&#x27;../build/server.bundle&#x27;);</span><br><span class="line"></span><br><span class="line">const server = express();</span><br><span class="line"></span><br><span class="line">// the port the disconnected app will run on</span><br><span class="line">// Node hosts usually pass a port to run on using a CLI argument</span><br><span class="line">const port = process.argv[2] || 8080;</span><br><span class="line"></span><br><span class="line">// create a JSS disconnected-mode server</span><br><span class="line">createDefaultDisconnectedServer(&#123;</span><br><span class="line">  port,</span><br><span class="line">  appRoot: __dirname,</span><br><span class="line">  appName,</span><br><span class="line">  language,</span><br><span class="line">  server,</span><br><span class="line">  afterMiddlewareRegistered: (expressInstance) =&gt; &#123;</span><br><span class="line">    // to make disconnected SSR work, we need to add additional middleware (beyond mock layout service) to handle</span><br><span class="line">    // local static build artifacts, and to handle SSR by loopback proxying to the disconnected</span><br><span class="line">    // layout service on the same express server</span><br><span class="line"></span><br><span class="line">    // Serve static app assets from local /build folder into the sitecoreDistPath setting</span><br><span class="line">    // Note: for Angular and Vue samples, change /build to /dist to match where they emit build artifacts</span><br><span class="line">    expressInstance.use(</span><br><span class="line">      sitecoreDistPath,</span><br><span class="line">      express.static(&#x27;build&#x27;, &#123;</span><br><span class="line">        fallthrough: false, // force 404 for unknown assets under /dist</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    const ssrProxyConfig = &#123;</span><br><span class="line">      // api host = self, because this server hosts the disconnected layout service</span><br><span class="line">      apiHost: `http://localhost:$&#123;port&#125;`,</span><br><span class="line">      layoutServiceRoute: &#x27;/sitecore/api/layout/render/jss&#x27;,</span><br><span class="line">      apiKey: &#x27;NA&#x27;,</span><br><span class="line">      pathRewriteExcludeRoutes: [&#x27;/dist&#x27;, &#x27;/build&#x27;, &#x27;/assets&#x27;, &#x27;/sitecore/api&#x27;, &#x27;/api&#x27;],</span><br><span class="line">      debug: false,</span><br><span class="line">      maxResponseSizeBytes: 10 * 1024 * 1024,</span><br><span class="line">      proxyOptions: &#123;</span><br><span class="line">        headers: &#123;</span><br><span class="line">          &#x27;Cache-Control&#x27;: &#x27;no-cache&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // For any other requests, we render app routes server-side and return them</span><br><span class="line">    expressInstance.use(&#x27;*&#x27;, scProxy(app.renderView, ssrProxyConfig, app.parseRouteUrl));</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>Test it out. From a console in the app root, run <code>node ./scripts/disconnected-ssr.js</code>. Then in a browser, open <code>http://localhost:8080</code> to see it in action!</li>
</ol>
<h3 id="Deploying-the-disconnected-app-to-Heroku"><a href="#Deploying-the-disconnected-app-to-Heroku" class="headerlink" title="Deploying the disconnected app to Heroku"></a>Deploying the disconnected app to Heroku</h3><p>Heroku is a very easy to use PaaS Node host, but you can also deploy to Azure App Service or any other service that can host Node. To get started, sign up for a Heroku account and install and configure the <a target="_blank" rel="noopener" href="https://devcenter.heroku.com/articles/heroku-cli">Heroku CLI</a>.</p>
<ol>
<li>We need to tell Heroku to build our app when it’s deployed.<ul>
<li>Locate the <code>scripts</code> section in the <code>package.json</code></li>
<li>Add the following script: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;postinstall&quot;: &quot;npm run build&quot;`</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>We need to tell Heroku the command to use to start our app.<ul>
<li>Create a file in the app root called <code>Procfile</code></li>
<li>Place the following contents: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web: node ./scripts/disconnected-ssr.js $PORT</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>To deploy to Heroku, we’ll use Git. Heroku provides us a Git remote that we can push to that will deploy our app. To use Git, we need to make our app a Git repository: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add -A</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br></pre></td></tr></table></figure></li>
<li>Create the Heroku app. This will create the app in Heroku and configure the Git remote to deploy to it. Using a console in your app root: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroku create &lt;your-heroku-app-name&gt;</span><br></pre></td></tr></table></figure></li>
<li>Configure Heroku to install node <code>devDependencies</code> (which we need to start the app in disconnected mode). Run the following command: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroku config:set NPM_CONFIG_PRODUCTION=false YARN_PRODUCTION=false</span><br></pre></td></tr></table></figure></li>
<li>Deploy the JSS app to Heroku: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u heroku master</span><br></pre></td></tr></table></figure></li>
<li>Your JSS app should be running at <code>https://&lt;yourappname&gt;.herokuapp.com</code>!</li>
</ol>
<blockquote>
<p>In case it’s not obvious, do not use this setup in production. The JSS disconnected server is not designed to handle heavy production load.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2018/07/Deploying-Disconnected-JSS-Apps/" data-id="ckrl9emyp005e98q70yiihq1d" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Announcing-Sitecore-JSS-XSLT-Support" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2018/04/Announcing-Sitecore-JSS-XSLT-Support/">Announcing Sitecore JSS XSLT Support</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2018/04/Announcing-Sitecore-JSS-XSLT-Support/">
    <time datetime="2018-04-01T07:07:06.000Z" itemprop="datePublished">April 1, 2018</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/JSS/">JSS</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Sitecore Team X is proud to announce the final public release of Sitecore JavaScript Services (JSS) with full XSLT 3.0 support!</p>
<h2 id="Why-XSLT-3-0"><a href="#Why-XSLT-3-0" class="headerlink" title="Why XSLT 3.0?"></a>Why XSLT 3.0?</h2><p>XSLT 3.0 allows for <a target="_blank" rel="noopener" href="https://www.xml.com/articles/2017/02/14/why-you-should-be-using-xslt-30/">JSON transformations</a>, so you can use the full power of modern JSS while retaining the XSLT developer experience that Site Core developers know and love.</p>
<p>Our XSLT 3.0 engine allows for client-side rendering by transforming hard-to-read JSON into plain, sensible XML using XSLT 3.0 standards-compliant JSON-to-XML transformations. Instead of ugly JSON, your JSS renderings can simple, easy to read XML like this:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">j:map</span> <span class="attr">xmlns:j</span>=<span class="string">&quot;http://www.w3.org/2013/XSL/json&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">j:map</span> <span class="attr">key</span>=<span class="string">&quot;fields&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">j:map</span> <span class="attr">key</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">j:map</span> <span class="attr">key</span>=<span class="string">&quot;value&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;editable&quot;</span>&gt;</span>SiteCore Experience Platform + JSS + XSLT<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;value&quot;</span>&gt;</span>SiteCore Experience Platform + JSS + XSLT<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>It’s just as simple to make a JSS XSLT to transform your rendering output. Check out this super simple “hello world” sample:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:math</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions/math&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xd</span>=<span class="string">&quot;http://www.oxygenxml.com/ns/doc/xsl&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:SiteCore</span>=<span class="string">&quot;http://www.SiteCore.com/demandMore/xslt&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:h</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:fn</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:j</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">exclude-result-prefixes</span>=<span class="string">&quot;xs math xd h SiteCore&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">&quot;3.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">expand-text</span>=<span class="string">&quot;yes&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:output</span>  <span class="attr">method</span>=<span class="string">&quot;text&quot;</span> <span class="attr">indent</span>=<span class="string">&quot;yes&quot;</span> <span class="attr">media-type</span>=<span class="string">&quot;text/json&quot;</span> <span class="attr">omit-xml-declaration</span>=<span class="string">&quot;yes&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-a&quot;</span> <span class="attr">select</span>=<span class="string">&quot;json-to-xml(/)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-b&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">xsl:apply-templates</span> <span class="attr">select</span>=<span class="string">&quot;$fields-a/*&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">xsl:variable</span>&gt;</span></span><br><span class="line">       &#123;xml-to-json($fields-b,map&#123;&#x27;indent&#x27;:true()&#125;)&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/j:map&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">j:array</span> <span class="attr">key</span>=<span class="string">&quot;fields&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">xsl:apply-templates</span> <span class="attr">select</span>=<span class="string">&quot;j:map[@key=&#x27;fields&#x27;]/j:map&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;rendering&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">j:array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;j:map&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;rendering&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;j:string[@key=&#x27;title:value&#x27;]||&#x27; &#x27;||j:string</span><br><span class="line">[@key=&#x27;title:editable&#x27;]&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">&quot;j:boolean [@key=&#x27;experienceEditor&#x27;]&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;editable&quot;</span>&gt;</span>&#123;j:string</span><br><span class="line">[@key=&#x27;editable&#x27;]/text()&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JSON transformations allow XSLT 3.0 to be a transformative force on the modern web. Expect to see recruiters demand 10 years of XSLT 3.0 experience for Site-core candidates within the next year - this is a technology you will not want to miss out on learning.</p>
<h2 id="Dynamic-XSLT-with-VBScript"><a href="#Dynamic-XSLT-with-VBScript" class="headerlink" title="Dynamic XSLT with VBScript"></a>Dynamic XSLT with VBScript</h2><p>Modern JavaScript is way too difficult, so we’ve implemented a feature that lets you define dynamic XSLT templates using ultra-modern VBScript:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:math</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions/math&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xd</span>=<span class="string">&quot;http://www.oxygenxml.com/ns/doc/xsl&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:SiteCore</span>=<span class="string">&quot;http://www.SiteCore.com/demandMore/xslt&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:h</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:fn</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:j</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">exclude-result-prefixes</span>=<span class="string">&quot;xs math xd h SiteCore&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">&quot;3.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">expand-text</span>=<span class="string">&quot;yes&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:output</span>  <span class="attr">method</span>=<span class="string">&quot;text&quot;</span> <span class="attr">indent</span>=<span class="string">&quot;yes&quot;</span> <span class="attr">media-type</span>=<span class="string">&quot;text/json&quot;</span> <span class="attr">omit-xml-declaration</span>=<span class="string">&quot;yes&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-a&quot;</span> <span class="attr">select</span>=<span class="string">&quot;json-to-xml(/)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-b&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">xsl:apply-templates</span> <span class="attr">select</span>=<span class="string">&quot;$fields-a/*&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">xsl:variable</span>&gt;</span></span><br><span class="line">       &#123;xml-to-json($fields-b,map&#123;&#x27;indent&#x27;:true()&#125;)&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/j:map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/vbscript&quot;</span>&gt;</span></span><br><span class="line">      Dim txtValue = xmlns.SiteCore.rendering.title.value</span><br><span class="line">      Dim txtEditable = xmlns.SiteCore.rendering.title.value</span><br><span class="line"></span><br><span class="line">      Sub xsltRender(txtVBProgrammers, txtAreDim)</span><br><span class="line">        document.write(txtVBProgrammers)</span><br><span class="line">      End Sub</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;j:map&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;rendering&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;j:string[@key=&#x27;title:value&#x27;]||&#x27; &#x27;||j:string</span><br><span class="line">[@key=&#x27;title:editable&#x27;]&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">&quot;j:boolean [@key=&#x27;experienceEditor&#x27;]&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;editable&quot;</span>&gt;</span>&#123;j:string</span><br><span class="line">[@key=&#x27;editable&#x27;]/text()&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>With a quick piece of simple VBScript like that, you’ll be making awesome JSS pages like this one in no time!</p>
<img src="/index.php/2018/04/Announcing-Sitecore-JSS-XSLT-Support/xslt.png" class="">

<h2 id="How-can-I-get-this-XSLT-goodness"><a href="#How-can-I-get-this-XSLT-goodness" class="headerlink" title="How can I get this XSLT goodness?"></a>How can I get this XSLT goodness?</h2><p>Glad you asked. Download it <a target="_blank" rel="noopener" href="https://goo.gl/EpcFui">right here</a>!</p>
<h2 id="What’s-next-for-JSS"><a href="#What’s-next-for-JSS" class="headerlink" title="What’s next for JSS"></a>What’s next for JSS</h2><p>The Sitecore JSS team is always looking for opportunities to improve JSS and make it compatible with the most modern technologies. Experimentation is already under way to add ColdFusion scripting support for XSLT 3 JSS renderings, and enable PHP server-side rendering for your SiteCore solutions.</p>
<p>Just another way that we help you succeed in your Site core implementations.</p>
<p><a target="_blank" rel="noopener" href="https://goo.gl/2jTvPX">Send us feedback on our roadmap</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2018/04/Announcing-Sitecore-JSS-XSLT-Support/" data-id="ckrl9emyo005c98q73uo127pu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JavaScript/">JavaScript</a></p>
              <p class="item-title"><a href="/index.php/2021/07/Fun-with-async-generators-and-for-await/" class="title">Fun with async generators and for await</a></p>
              <p class="item-date"><time datetime="2021-07-26T23:30:51.000Z" itemprop="datePublished">July 26, 2021</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/Jamstack/">Jamstack</a></p>
              <p class="item-title"><a href="/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/" class="title">Deploying multiple Netlify sites from one monorepo</a></p>
              <p class="item-date"><time datetime="2020-08-21T03:30:32.000Z" itemprop="datePublished">August 20, 2020</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/" class="title">Running JSS headless mode in containers part 2: Build containers</a></p>
              <p class="item-date"><time datetime="2019-09-16T02:14:04.000Z" itemprop="datePublished">September 15, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/" class="title">Running JSS headless mode in containers, part 1</a></p>
              <p class="item-date"><time datetime="2019-09-08T19:00:36.000Z" itemprop="datePublished">September 8, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/C/">C#</a></p>
              <p class="item-title"><a href="/index.php/2019/05/Build-2019-All-the-things/" class="title">Build 2019: All the things</a></p>
              <p class="item-date"><time datetime="2019-05-10T23:01:11.000Z" itemprop="datePublished">May 10, 2019</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Crypto/">Crypto</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Lucene/">Lucene</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/MVC/">MVC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Search/">Search</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/xDB/">xDB</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>&copy; 2021 Kam Figy</p>
      <p><small>Opinions expressed on this blog are my own, and not necessarily those of my employer.</small></p>
     <p><small>This work is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</small></p>
    </div>
  </div>
</footer>
    


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>