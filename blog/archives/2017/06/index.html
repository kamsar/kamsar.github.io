<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2017/6 | Kam&#39;s Idea Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Kam&#39;s Idea Log">
<meta property="og:url" content="https://kamsar.net/blog/archives/2017/06/index.html">
<meta property="og:site_name" content="Kam&#39;s Idea Log">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Kam Figy">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@kamsar">
  
    <link rel="alternative" href="/index.php/feed" title="Kam&#39;s Idea Log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62284328-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo">
        <span class="site-title">Kam&#39;s Idea Log</span>
        <span class="subtitle">C#, Jamstack, and Shenanigans</span>
      </a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=40" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=80 2x" alt="omg the beard"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </td>
      </tr>
    </table>
  </div>
  
  <div id="header-sub" class="header-sub header-inner">
    <div class="outer">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=128" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=256 2x" alt="#sitecorebeard">
      <h2 id="name">Kam Figy</h2>
      <h3 id="title">Principal Platform Architect at</h3>
      <a class="corp-logo" href="https://uniform.dev" target="_blank"><img src="/css/images/uniform-logo.svg" alt="Uniform" width="180"></a>
      <span id="location"><i class="fa fa-map-marker"></i>Vancouver, WA USA</span>
      <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/kamsar">FOLLOW</a>
  	</div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a target="_blank" rel="noopener" href="https://github.com/kamsar" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a target="_blank" rel="noopener" href="https://twitter.com/kamsar" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/index.php/feed" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    <div class="article-info profile-block bio">
      <h2>About</h2>
      <p>Kam has been making websites since 1996, starting out with a 14.4k modem on a <a href="https://en.wikipedia.org/wiki/Party_line_(telephony)" target="_blank">party line</a> in the Hawaiian rainforest. A veteran developer, architect, and speaker, he's been working in the content management space for well over a decade. Kam is the author of <a href="https://github.com/kamsar/Unicorn" target="_blank">Unicorn</a>, <a href="https://github.com/kamsar/Synthesis" target="_blank">Synthesis</a>, <a href="https://github.com/kamsar/Dianoga" target="_blank">Dianoga</a>, and several other open-source libraries.</p>
    </div>
  </div>
</aside>
      <section id="main">
  
  
    
    
      
        <div class="archive-year-wrap">
          <i class="fa fa-calendar"></i>
          <a href="/archives/2017" class="archive-year">2017</a>
        </div>
    
    <article id="post-Unicorn-4-Released" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/06/Unicorn-4-Released/">Unicorn 4 Released</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/06/Unicorn-4-Released/">
    <time datetime="2017-06-22T19:57:43.000Z" itemprop="datePublished">June 22, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Unicorn/">Unicorn</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://kamsar.net/nuget/unicorn/logo.png" alt="unicorn"></p>
<p>I’m happy to announce the final release of Unicorn 4.0! Unicorn 4 comes with significant performance and developer experience improvements, along with bug fixes. Unicorn 4 is available from NuGet or <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/releases/tag/4.0.0">GitHub</a>.</p>
<h1 id="Project-Dilithium-and-Performance"><a href="#Project-Dilithium-and-Performance" class="headerlink" title="Project Dilithium and Performance"></a>Project Dilithium and Performance</h1><p>Unicorn 4 is faster - a lot faster. Check out these benchmarks:</p>
<p><img src="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Project-Dilithium/perf.png" alt="performance benchmarks"></p>
<p>The speed increase is due to optimized caching routines, as well as the <em>Dilithium</em> batch processors. Dilithium is an optional feature that is off by default: because of its newness, it’s still experimental. I’m using it in production though. Give it a try - it can always be turned off without hurting anything.</p>
<p>For more detail into how Unicorn 4 is faster, and what Dilithium does, <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Project-Dilithium/">check out this detailed blog post</a>.</p>
<h1 id="Improved-Modular-Configuration"><a href="#Improved-Modular-Configuration" class="headerlink" title="Improved Modular Configuration"></a>Improved Modular Configuration</h1><p>Unicorn 4 features a refactored configuration system that is designed to support <a target="_blank" rel="noopener" href="http://helix.sitecore.net/">Sitecore Helix</a> projects with an improved configuration experience. The new config system is completely backwards-compatible, but now enables <em>configuration inheritance</em>, <em>configuration variables</em>, and <em>configuration extension</em> so that modular projects can encode their conventions (e.g. paths to include, physical paths) into one base config and all the module configs can extend it.</p>
<p>This drastically reduces the verbosity of the module configurations, and improves their maintainability by allowing conventions to be <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>. Here’s a very simple example of a base conventions configuration:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">name</span>=<span class="string">&quot;Habitat.Feature.Base&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">targetDataStore</span> <span class="attr">physicalRootPath</span>=<span class="string">&quot;$(sourceFolder)\$(layer)\$(module)\serialization&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">predicate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;$(layer).$(module).Templates&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/templates/$(layer)/$(module)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">predicate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>And here’s a module configuration that extends it:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">name</span>=<span class="string">&quot;Feature.News&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">extends</span>=<span class="string">&quot;Habitat.Feature.Base&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- automatically stores items at $(sourceFolder)\Feature\News\serialization --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- automatically includes /sitecore/templates/Feature/News --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>There’s a lot more that you can do with the configuration enhancements in Unicorn 4 too. For additional details, <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Part-III-Configuration-Enhancements/">read this extensive blog post</a>.</p>
<h1 id="Sitecore-PowerShell-Extensions-Support"><a href="#Sitecore-PowerShell-Extensions-Support" class="headerlink" title="Sitecore PowerShell Extensions Support"></a>Sitecore PowerShell Extensions Support</h1><p><img src="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/spe.png" alt="unicorn + spe"></p>
<p>Just about anything you can do with Unicorn can now be automated using Sitecore PowerShell Extensions in Unicorn 4. You can now run Unicorn SPE cmdlets to…</p>
<ul>
<li>Run a sync</li>
<li>Serialize an item or tree of items</li>
<li>Dump an item to YAML in the console</li>
<li><a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-5-Generating-Packages-with-SPE/">Create a Sitecore package of all the items in a Unicorn configuration</a></li>
<li>And there’s more, all <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/">in this blog post</a> - and <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-5-Generating-Packages-with-SPE/">this one, about packaging</a></li>
</ul>
<h1 id="Console-Output-Scaling"><a href="#Console-Output-Scaling" class="headerlink" title="Console Output Scaling"></a>Console Output Scaling</h1><p>The Unicorn console has received a serious upgrade in Unicorn 4. If you’ve ever run a sync that changed a large number of items from the Unicorn Control Panel, you may have noticed the browser slow to a crawl and the sync seem to almost stop. The console that underpins Unicorn 3 and earlier started to choke at around 500 lines.</p>
<p>No longer! Unicorn 4’s upgraded console has spit out 100,000 lines without a hitch, and it should scale beyond that.</p>
<p>The automated tool console (PowerShell API) has also received an upgrade. Previously the tool console buffered all the output of a sync before sending it back. This caused problems in certain environments, namely Azure, where TCP connections that don’t send any data for more than four minutes are terminated. This would cause long-running syncs in Azure to die unexpectedly.</p>
<p>In Unicorn 4 the automated tool console emits data in a stream just like the control panel console. There’s also a heartbeat timer where if no new console entries are made for 30 seconds, a <code>.</code> will be sent to make sure the connection is kept active.</p>
<p>The streaming tool console also requires updating your <code>Unicorn.psm1</code> file - not only will you get defense against TCP timeouts, you’ll also be able to see the sync occur in real time using the PSAPI just like you would from the control panel. No more waiting until it’s done to see how things are going :)</p>
<h1 id="Predicates-can-Exclude-by-Template-ID-or-Name"><a href="#Predicates-can-Exclude-by-Template-ID-or-Name" class="headerlink" title="Predicates can Exclude by Template ID or Name"></a>Predicates can Exclude by Template ID or Name</h1><p>Unicorn 4 can now exclude items from a configuration by template ID, thanks to <a target="_blank" rel="noopener" href="https://alan-null.github.io/2017/03/custom-unicorn-predicate">Alan Płócieniak</a>. See also <a target="_blank" rel="noopener" href="https://alan-null.github.io/2017/03/custom-unicorn-predicate">Alan’s original post</a> on the technique.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Template ID&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/allowed&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclude</span> <span class="attr">templateId</span>=<span class="string">&quot;&#123;3B4F2B85-778D-44F3-9B2D-BEFF1F3575E6&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can also exclude items by a regular expression of their name. This enables scenarios such as wanting to include all templates, but exclude all <code>__Standard values</code> items.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Name pattern&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/namepattern&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclude</span> <span class="attr">namePattern</span>=<span class="string">&quot;^__Standard values$&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The complete grammar for predicates is always in the <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn.Tests/Predicates/TestConfiguration.xml#L32">predicate test config</a>.</p>
<h1 id="Breaking-Changes"><a href="#Breaking-Changes" class="headerlink" title="Breaking Changes"></a>Breaking Changes</h1><p>Unicorn 4’s breaking changes do not break any common use-cases of Unicorn, but review them to see if they affect you.</p>
<ul>
<li>The <code>__Originator</code> field is now <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/commit/f7d073b255891ec487e9a092fb2fa172ea77b9ac">serialized by default</a>. This enables proper tracking of the origin of items instantiated from branch templates.</li>
<li>Multithreaded sync support has been removed due to Sitecore bugs preventing realistic use. This was disabled by default already. Dilithium is faster than multithread sync ever was.</li>
<li>The Rainbow <code>UseLegacyAttributeFormatting</code> (formats items in Unicorn &lt; 3.1 format) setting has been removed. The new format is now always used. This has always been off by default.</li>
<li>Rainbow <code>FieldComparer</code>s are no longer activated using the Sitecore Factory, so they only support parameterless constructors (this would only affect custom comparers; the stock ones have always been parameterless)</li>
<li>Due to the console upgrades, a new <code>Unicorn.psm1</code> is required if you are using Unicorn’s PowerShell API. This file also now ships in the NuGet package, so you can be sure you’re getting the right version for your Unicorn.</li>
</ul>
<h1 id="Bug-Fixes"><a href="#Bug-Fixes" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h1><ul>
<li>Transparent sync misc fixes (to renaming, saving display names, instantiating branch templates into TpSync areas)</li>
<li>Renaming an item and changing fields on it in one operation (only possible with Sitecore API) now no longer loses the additional field data in the serialized item</li>
<li>Improved output and logging, clarified messaging, improved developer experience</li>
<li>Content editor warnings now handle items in more than one configuration correctly</li>
<li>Control panel now displays which paths are invalid when initial serialization is blocked due to invalid include paths</li>
<li>The required password length for user serialization is now configurable, should you really really want to use <code>b</code></li>
<li>Using Fast Query while any Transparent Sync configuration is active will now log a warning to the Sitecore logs (fast query cannot find transparent sync items, so items may not be returned as expected). This can be disabled if your logs start to fill with spam and you understand the issue.</li>
<li>PowerShell API now defaults to not write secrets to the console (debug is off by default) for secure-by-default-ness</li>
<li>Fixed a background exception that could occur when modifying serialized items on disk in rare cases, which could cause the app pool to terminate <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/issues/222">#222</a></li>
<li>The Rainbow data cache now correctly invalidates if an item is moved or renamed on disk after being added to the cache</li>
<li>Choosing many configurations to sync will no longer push the sync button off the page <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/pull/232">#232</a></li>
<li>The default console logging level for interactive syncing has been changed from Info to Debug, since there is no longer a scaling issue with the console output. This provides better insights into what has been changed on items without needing to see the Sitecore logs</li>
</ul>
<h1 id="Upgrading"><a href="#Upgrading" class="headerlink" title="Upgrading"></a>Upgrading</h1><p>If you’re coming from classical Unicorn 3.1 or later, upgrading is actually really simple: just upgrade your NuGet package. Unicorn 4 changes nothing about storage or formatting (except that the <code>__Originator</code> field is no longer ignored by default), so all existing serialized items are compatible.</p>
<p>If you’re invoking Unicorn via its remote PowerShell API, make sure to upgrade your <code>Unicorn.psm1</code> to the Unicorn 4 version to ensure correct error handling with the streaming console.</p>
<h1 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h1><p>Thank you to the community members who contributed code and bug reports to this release.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/chemaxa">chemaxa</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Rclemens">Raymond Clemens</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/niles11">Niles11</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lordstyx">Luuk Ostendorf</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/alan-null">Alan Płócieniak</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/JamesSkemp">James Skemp</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/t00ki">t00ki</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/WimVergouwe">Wim Vergouwe</a></li>
</ul>
<h1 id="Address"><a href="#Address" class="headerlink" title="Address"></a>Address</h1><img src="/index.php/2017/06/Unicorn-4-Released/Elephant.jpg" class="" title="early design for Unicorn 5">
      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/06/Unicorn-4-Released/" data-id="ckrl9emym005198q72foh1qrb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Simplifying-Contact-Facets-with-C-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/">Simplifying Contact Facets with C# 6</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/">
    <time datetime="2017-06-02T17:04:08.000Z" itemprop="datePublished">June 2, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/index.php/category/Sitecore/xDB/">xDB</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Contact Facets allow you to persist information about visitors into the Sitecore xDB. We’re not going to get into the theory behind them in this post; for that go read Pete Navarra’s <a target="_blank" rel="noopener" href="https://sitecorehacker.com/2016/09/03/creating-custom-sitecore-xdb-contact-facets/">great blog post</a> that summarizes current practices and how to add facets.</p>
<p>Today we’re going to discuss how to syntactically improve the declaration of a contact facet class using syntaxes available in C# 6.0 (VS 2015) and C# 7.0 (VS 2017). It’s important to note that the C# version is decoupled from the .NET framework version: the C# 7.0 compiler is perfectly capable of emitting C# 7 syntax to a .NET 4.5-targeted assembly, for instance. So you can use these modern language features as long as you’ve got the right version of MSBuild or Visual Studio :)</p>
<p>Here’s the example Pete uses in his post, which follows <a target="_blank" rel="noopener" href="https://community.sitecore.net/technical_blogs/b/getting_to_know_sitecore/posts/introducing-contact-facets">other examples</a> out there as well:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SitecoreHacker.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> CUSTOMER_ID = <span class="string">&quot;CustomerId&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> SEGEMENT = <span class="string">&quot;Segment&quot;</span>; <span class="comment">// sic :p</span></span><br><span class="line"> </span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Properties</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(CUSTOMER_ID); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(CUSTOMER_ID, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(SEGEMENT); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(SEGEMENT, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(CUSTOMER_ID);</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(SEGEMENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As you can see, the facet API requires string keys for the facet values - in this case stored as <code>const string</code> - to get and set them. Further, as Pete notes:</p>
<blockquote>
<p>I found out the hard way that the constants defined, the value must equal the actual name of the class property for the same attribute.</p>
</blockquote>
<p>Well in C# 6 (VS 2015), there’s a syntax for that. The <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/nameof"><code>nameof</code></a> statement allows you to get the string name of a variable or property. This essentially hands off the management and maintenance of the <code>const</code> value to the compiler, instead of the developer.</p>
<p>So we can clean up this example by using <code>nameof</code> instead of constants - and get as a bonus refactoring support and compile-time validation of the names:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Elephant.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId)); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(<span class="keyword">nameof</span>(CustomerId), <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment)); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(<span class="keyword">nameof</span>(Segment), <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally if you have C# 7.0 (VS 2017), you can also utilize <a target="_blank" rel="noopener" href="https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/">expression bodied members</a> to further clean up the property syntax:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Rhino.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// expression bodied members turn the single-expression get </span></span><br><span class="line">            <span class="comment">// into a lamdba-style syntax, removing the need for braces</span></span><br><span class="line">            <span class="keyword">get</span> =&gt; GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            <span class="keyword">set</span> =&gt; SetAttribute(<span class="keyword">nameof</span>(CustomerId), <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> =&gt; GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">            <span class="keyword">set</span> =&gt; SetAttribute(<span class="keyword">nameof</span>(Segment), <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So there - now go forth and put your data in the xDB :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/" data-id="ckrl9emyk004z98q75ktq4dv6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JavaScript/">JavaScript</a></p>
              <p class="item-title"><a href="/index.php/2021/07/Fun-with-async-generators-and-for-await/" class="title">Fun with async generators and for await</a></p>
              <p class="item-date"><time datetime="2021-07-26T23:30:51.000Z" itemprop="datePublished">July 26, 2021</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/Jamstack/">Jamstack</a></p>
              <p class="item-title"><a href="/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/" class="title">Deploying multiple Netlify sites from one monorepo</a></p>
              <p class="item-date"><time datetime="2020-08-21T03:30:32.000Z" itemprop="datePublished">August 20, 2020</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/" class="title">Running JSS headless mode in containers part 2: Build containers</a></p>
              <p class="item-date"><time datetime="2019-09-16T02:14:04.000Z" itemprop="datePublished">September 15, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/" class="title">Running JSS headless mode in containers, part 1</a></p>
              <p class="item-date"><time datetime="2019-09-08T19:00:36.000Z" itemprop="datePublished">September 8, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/C/">C#</a></p>
              <p class="item-title"><a href="/index.php/2019/05/Build-2019-All-the-things/" class="title">Build 2019: All the things</a></p>
              <p class="item-date"><time datetime="2019-05-10T23:01:11.000Z" itemprop="datePublished">May 10, 2019</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Crypto/">Crypto</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Lucene/">Lucene</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/MVC/">MVC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Search/">Search</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/xDB/">xDB</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>&copy; 2021 Kam Figy</p>
      <p><small>Opinions expressed on this blog are my own, and not necessarily those of my employer.</small></p>
     <p><small>This work is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</small></p>
    </div>
  </div>
</footer>
    


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>