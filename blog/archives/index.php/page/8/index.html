<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives | Kam&#39;s Idea Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Kam&#39;s Idea Log">
<meta property="og:url" content="https://kamsar.net/blog/archives/index.php/page/8/index.html">
<meta property="og:site_name" content="Kam&#39;s Idea Log">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Kam Figy">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@kamsar">
  
    <link rel="alternative" href="/index.php/feed" title="Kam&#39;s Idea Log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62284328-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo">
        <span class="site-title">Kam&#39;s Idea Log</span>
        <span class="subtitle">C#, Jamstack, and Shenanigans</span>
      </a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=40" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=80 2x" alt="omg the beard"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </td>
      </tr>
    </table>
  </div>
  
  <div id="header-sub" class="header-sub header-inner">
    <div class="outer">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=128" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=256 2x" alt="#sitecorebeard">
      <h2 id="name">Kam Figy</h2>
      <h3 id="title">Principal Platform Architect at</h3>
      <a class="corp-logo" href="https://uniform.dev" target="_blank"><img src="/css/images/uniform-logo.svg" alt="Uniform" width="180"></a>
      <span id="location"><i class="fa fa-map-marker"></i>Vancouver, WA USA</span>
      <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/kamsar">FOLLOW</a>
  	</div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a target="_blank" rel="noopener" href="https://github.com/kamsar" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a target="_blank" rel="noopener" href="https://twitter.com/kamsar" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/index.php/feed" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    <div class="article-info profile-block bio">
      <h2>About</h2>
      <p>Kam has been making websites since 1996, starting out with a 14.4k modem on a <a href="https://en.wikipedia.org/wiki/Party_line_(telephony)" target="_blank">party line</a> in the Hawaiian rainforest. A veteran developer, architect, and speaker, he's been working in the content management space for well over a decade. Kam is the author of <a href="https://github.com/kamsar/Unicorn" target="_blank">Unicorn</a>, <a href="https://github.com/kamsar/Synthesis" target="_blank">Synthesis</a>, <a href="https://github.com/kamsar/Dianoga" target="_blank">Dianoga</a>, and several other open-source libraries.</p>
    </div>
  </div>
</aside>
      <section id="main">
  
  
    
    
      
        <div class="archive-year-wrap">
          <i class="fa fa-calendar"></i>
          <a href="/archives/2013" class="archive-year">2013</a>
        </div>
    
    <article id="post-blade-2-1-razor-3-support" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/11/blade-2-1-razor-3-support/">Blade 2.1 - Razor 3 support</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/11/blade-2-1-razor-3-support/">
    <time datetime="2013-11-21T04:54:11.000Z" itemprop="datePublished">November 20, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Blade/">Blade</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve pushed Blade 2.1 out to NuGet. This release updates the MVC references to MVC5, and the Razor references to Razor 3.</p>
<p>This release also uses the latest bits for Sitecore NuGet, which resolve some issues with local IIS site connections.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/11/blade-2-1-razor-3-support/" data-id="ckrl9emxr001s98q76f5x0w1s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-sitecore-data-architecture" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/11/sitecore-data-architecture/">Sitecore Data Architecture</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/11/sitecore-data-architecture/">
    <time datetime="2013-11-17T06:28:41.000Z" itemprop="datePublished">November 16, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>There are many times where you need to extend the Sitecore data architecture in some way. One of the most obvious, and most used, is attaching an event handler to one of the item events (e.g. item:saved, item:renamed) but this is not by any means the only way to manipulate items before they get to the database.</p>
<p>This blog post came out of a discussion I had with Alex Shyba about the DataEngine, a few hours on a plane, and a lot of decompilation. I’m going to attempt to show what happens when an item gets saved and where you can plug into that.</p>
<h2 id="The-entry-point"><a href="#The-entry-point" class="headerlink" title="The entry point"></a>The entry point</h2><p>The most high level API is of course the <code>Item</code> class. Saving an item using this API is very simple:</p>
<pre><code>using(new EditContext(item))
&#123;
    item[&quot;MyField&quot;] = &quot;newValue&quot;;
&#125;
</code></pre>
<p>When the <code>EditContext</code> goes out of scope, this causes <code>item.Editing.AcceptChanges()</code> to be invoked, and our journey down the rabbit-hole begins there.</p>
<h2 id="The-Item-Manager"><a href="#The-Item-Manager" class="headerlink" title="The Item Manager"></a>The Item Manager</h2><p>Our next step is the highest level item data API in Sitecore: the <code>ItemManager</code>. At first blush <code>ItemManager</code> appears to be a rather ugly giant static class, with tons of manipulaton methods: <code>SaveItem</code>, <code>AddVersion</code>, etc. However, it’s not as bad as it looks. <code>ItemManager</code> is basically a static facade around the current <code>ItemProvider</code>.</p>
<h2 id="The-Item-Provider"><a href="#The-Item-Provider" class="headerlink" title="The Item Provider"></a>The Item Provider</h2><p>Here’s where things get interesting. You can register <em>multiple</em> item providers in the config under <code>itemManager/providers</code>. While this appears to provide a lot of power as an extension point - being able to plugin your own high level provider - it unfortunately seems to be rather ungainly. If multiple providers are registered you can access them directly using <code>ItemManager.Providers</code>, but the other <code>ItemManager</code> methods only execute against the default provider. You <em>could</em> replace the default provider with your own, but this is less than ideal as it can lead to contention for whose item provider gets used if more than one module wants to extend using it.</p>
<p>Extension points aside, the <code>ItemProvider</code> is the most broad data API Sitecore provides. It deals in high level objects and abstracts lower level concepts like databases and item definitions away. Most all methods in the <code>ItemProvider</code> result in invocations of the next lower level construct, the <code>DataEngine</code>.</p>
<p><em>UPDATE</em>: <a target="_blank" rel="noopener" href="https://twitter.com/techphoria414">Nick Wesselman</a> pointed out that some queries will bypass the Item Provider and go directly to the Data Engine. <a target="_blank" rel="noopener" href="https://gist.github.com/techphoria414/7506347">This gist</a> has some examples of the types of things that bypass the Item Provider. In light of this I’d say the item provider is generally not a good candidate for extending things.</p>
<h2 id="The-Data-Engine"><a href="#The-Data-Engine" class="headerlink" title="The Data Engine"></a>The Data Engine</h2><p><code>DataEngine</code> (generally accessed by <code>databaseObject.DataManager.DataEngine</code>) is a very interesting component for extension. Unlike the item provider, the <code>DataEngine</code> is database-specific. This is also the layer at which item event handlers (e.g. item:saved) are processed, but more interestingly is also a place where you can hook events in an uninterruptible fashion. Regular event handlers, such as <code>item:saved</code>, are vulnerable to being disabled when someone scopes an <code>EventDisabler</code>. Generally this is good, as events are disabled for performance reasons during things like serialization bulk load operations. But occasionally, such as in <a target="_blank" rel="noopener" href="http://github.com/kamsar/Unicorn">Unicorn</a>, you need an event handler that cannot be disabled. Having a Unicorn event not fire would likely mean data being lost.</p>
<p>The internal architecture of <code>DataEngine</code> works something like this:</p>
<ul>
<li>An engine method gets invoked</li>
<li>The engine creates and initializes an <code>DataEngineCommand&lt;&gt;</code> object, using a stored prototype of the command</li>
<li>The <code>DataEngineCommand</code> has its <code>Execute</code> method invoked.</li>
</ul>
<p>The <code>EngineCommand</code> is a generic type, and each action that the engine can take has its own implementation - for example, there is a <code>Sitecore.Data.Engines.DataCommands.SaveItemCommand</code> class. Each of these command types is bootstrapped by a prototype system on the <code>DataEngine</code> itself. The engine, by way of its <code>Commands</code> property, stores copies of each command type. When a new command is needed, the existing prototype command is cloned (<code>Clone()</code>), initialized (<code>Initialize()</code>), and then used to execute the action. These prototypes are settable, including via configuration, so this allows you to inject your own derived implementation of each command and thus inject ‘event handler like’ functionality into the <code>DataEngine</code>.</p>
<p>Item Buckets utilizes this type of functionality injection, replacing the <code>AddFromTemplatePrototype</code> with its own extended implementation. This is the relevant section of Sitecore.Buckets.config:</p>
<pre><code>  &lt;database id=&quot;master&quot; singleInstance=&quot;true&quot; type=&quot;Sitecore.Data.Database, Sitecore.Kernel&quot;&gt;
    &lt;Engines.DataEngine.Commands.AddFromTemplatePrototype&gt;
      &lt;obj type=&quot;Sitecore.Buckets.Commands.AddFromTemplateCommand, Sitecore.Buckets&quot; /&gt;
    &lt;/Engines.DataEngine.Commands.AddFromTemplatePrototype&gt;
  &lt;/database&gt;
</code></pre>
<p>This same functionality could be used to inject non-disableable event handler type functionality into other events, for example by replacing the <code>SaveItemPrototype</code>. Unfortunately this method also suffers from possible contention issues if multiple modules wished to patch these commands, so be careful when using them.</p>
<h2 id="The-DataEngineCommand"><a href="#The-DataEngineCommand" class="headerlink" title="The DataEngineCommand"></a>The <code>DataEngineCommand</code></h2><p>Once the <code>DataEngine</code> creates and executes a command, the command generally does two things:</p>
<ul>
<li>Pass its task down to the Nexus <code>DataApi</code> to be handled</li>
<li>Fire off any normal item event handlers (item:saved), as long as events are not disabled</li>
</ul>
<p>Most of the methods on <code>DataEngineCommand</code> are virtual so you could extend them. The most obvious candidate, of course, is the <code>DoExecute</code> method that performs the basic action of the command. </p>
<p>Further down the rabbit-hole we arrive to the Nexus APIs.</p>
<h2 id="The-Nexus-DataApi"><a href="#The-Nexus-DataApi" class="headerlink" title="The Nexus DataApi"></a>The Nexus <code>DataApi</code></h2><p>The Nexus assembly, due to it containing licensing code I believe, is the only obfuscated assembly in Sitecore. This makes following what the data API is doing rather difficult, but I’m pretty sure I traced it back out as a call to the <code>databaseItem.DataManager.DataSource</code> APIs, which thankfully are not obfuscated. It’s worth noting that the Nexus APIs appear to also be using a <em>separate</em> command-class based architecture internally. Given the sensitive nature of the Nexus assembly however, I would look elsewhere for extension points.</p>
<h2 id="The-DataSource"><a href="#The-DataSource" class="headerlink" title="The DataSource"></a>The <code>DataSource</code></h2><p>The <code>Sitecore.Data.DataSource</code> appears to largely be a translation layer between slightly higher level APIs, where things like <code>Item</code> are used, and the low level API of the data providers (which use constructs like IDs and <code>ItemDefinition</code> instead). The data source is very generic and does not appear to be designed for extension, which is fine because we can extend both above and below it.</p>
<p>Methods within <code>DataSource</code> eventually make calls down to static methods on the <code>DataProvider</code> class.</p>
<h2 id="The-Data-Provider"><a href="#The-Data-Provider" class="headerlink" title="The Data Provider"></a>The Data Provider</h2><p>There are two faces to the <code>DataProvider</code> class. The internal static methods that the <code>DataSource</code> is invoking are helper methods that invoke non-static methods on all of the data providers attached to the database. (Yes, you can have multiple data providers within the same database, which may not even look at the same backend database at all…hehe) The actual data provider instances are the lowest level data APIs in Sitecore. They deal with primitive objects and have a lot of unspoken rules about them that make them tougher to implement than most other extension points. However they are also the most powerful extension point there is. Using a data provider you can manipulate the content tree in nearly any fashion for example <a target="_blank" rel="noopener" href="http://github.com/kamsar/Rhino">Rhino</a>, a data provider that makes serialized item files on disk appear to be real content items in Sitecore.</p>
<h2 id="You’re-still-reading-this"><a href="#You’re-still-reading-this" class="headerlink" title="You’re still reading this?"></a>You’re still reading this?</h2><p>Hopefully this is a useful post for some crazy nuts like myself who like to bend the guts of Sitecore. It’s definitely a long and byzantine road from saving an item to it getting to the database. Rather amazing that Sitecore is as fast as it is with all of these layers. Part of me suspects that some are baggage from Sitecore 4 for backwards compatibility ;)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/11/sitecore-data-architecture/" data-id="ckrl9emxs001u98q78m1lajru" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-a-fury-of-updates" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/11/a-fury-of-updates/">A Fury of Updates</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/11/a-fury-of-updates/">
    <time datetime="2013-11-15T06:30:16.000Z" itemprop="datePublished">November 14, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Synthesis/">Synthesis</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Put me on a plane to the Sitecore MVP Summit and I’m going to write software! All of these updates are available on <a target="_blank" rel="noopener" href="https://github.com/kamsar">GitHub</a> for source and NuGet for packages.</p>
<h1 id="Synthesis-Blade-Ninject"><a href="#Synthesis-Blade-Ninject" class="headerlink" title="Synthesis.Blade.Ninject"></a>Synthesis.Blade.Ninject</h1><p>This is an extension to Synthesis.Blade that enables automagical constructor dependency injection to any presenter using the Ninject IoC container. I previously blogged about how to do this (it’s not that complex) but now doing DI with Blade is as simple as a NuGet package. Simply wire up Ninject with your dependencies, add some dependencies to a presenter constructor, install this package, and you’re good to go. Here’s a simple example of a presenter using DI to get a repository dependency:</p>
<pre><code>public class TestPresenter : SynthesisPresenter&lt;TestModel, ITestTemplateItem&gt;
&#123;
    private readonly ITestRepository _repository;

    // this constructor parameter will be automatically set by Blade via Ninject
    public TestPresenter(ITestRepository repository)
    &#123;
        _repository = repository;
    &#125;

    public override TestModel GetModel(IView view, ITestTemplateItem item)
    &#123;
        var model = new TestModel();

        model.Frob = _repository.GetFrob(item);

        return model;
    &#125;
&#125;
</code></pre>
<p>Note: It’s trivial to implement the same constructor injection with a different IoC container, or without using Synthesis integration. Take a look at the source for Synthesis.Blade.Ninject and it should be pretty obvious what to do :)</p>
<p>Note2: Make sure to use the above Synthesis.Blade 7.0.1 configuration file, or the installation may not work correctly and patch the wrong thing.</p>
<h1 id="Blade-2-0-1"><a href="#Blade-2-0-1" class="headerlink" title="Blade 2.0.1"></a>Blade 2.0.1</h1><p>This is a minor release with enhancements to testability and bug fixes.</p>
<ul>
<li>The “Page” property on IView is now marked as obsolete, as it exposes a lot of untestable data to a presenter</li>
<li><code>IView</code> now has a <code>ViewContext</code> property that exposes the <code>HttpContextBase</code> for the current request, enabling testable access to request and response data within presenters</li>
<li>Fixed a bug that caused unexpected presenter resolution when using inheritance in model types (<code>IView</code> became covariant in Blade 2, which meant that <code>IView&lt;BaseClass&gt;</code> became similar to <code>IView&lt;DerivedClass&gt;</code>, and the base class presenter might be selected first in some cases) - fix courtesy of <a target="_blank" rel="noopener" href="https://twitter.com/Gobiner">@gobiner</a></li>
</ul>
<h1 id="Synthesis-7-0-1"><a href="#Synthesis-7-0-1" class="headerlink" title="Synthesis 7.0.1"></a>Synthesis 7.0.1</h1><p>This is a minor release that corrects an oversight in 7.0.0 where some of the new field type interfaces did not have setters for their values. This prevented editing items when using field type interfaces. Bug report courtesy of <a target="_blank" rel="noopener" href="https://twitter.com/Gobiner">@gobiner</a>.</p>
<h1 id="Synthesis-Blade-7-0-1"><a href="#Synthesis-Blade-7-0-1" class="headerlink" title="Synthesis.Blade 7.0.1"></a>Synthesis.Blade 7.0.1</h1><p>This is a minor release that resolves an issue with the default configuration file if multiple patches were present to the Blade <code>PresenterFactory</code>. To upgrade an existing installation, simply edit Synthesis.Blade.config and change the presenter factory patch line to read like so (changing the ‘instead’ attribute):</p>
<pre><code>&lt;presenterFactory patch:instead=&quot;*&quot; type=&quot;Synthesis.Blade.Configuration.SynthesisPresenterFactory, Synthesis.Blade&quot; /&gt;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/11/a-fury-of-updates/" data-id="ckrl9emxq001p98q7c7tq54r3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-make-web-forms-for-marketers-use-a-regular-connection-string" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/10/make-web-forms-for-marketers-use-a-regular-connection-string/">Make Web Forms for Marketers use a regular connection string</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/10/make-web-forms-for-marketers-use-a-regular-connection-string/">
    <time datetime="2013-10-10T06:31:11.000Z" itemprop="datePublished">October 9, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>One of my pet peeves about the Sitecore Web Forms for Marketers module is that it manages the forms database connection string in its own config file, instead of the regular ConnectionStrings.config file.</p>
<p>Fortunately this is easy to fix if you want to manage all your connection strings in one place. First, you need to override the default <code>WFMDataProvider</code> like so:</p>
<script src="//gist.github.com/6903359.js"></script>

<p>Then, you modify the data provider declaration in <code>App_Config\Include\forms.config</code> (replace the namespace and assembly with wherever you place the class above in your project):</p>
<script src="//gist.github.com/6903413.js"></script>

<p>Finally, simply add a connection string named forms (or whatever name you configured in forms.config above) to your <code>ConnectionStrings.config</code> and you’re good to go!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/10/make-web-forms-for-marketers-use-a-regular-connection-string/" data-id="ckrl9emxq001n98q7bvk2h5h3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-sitecore-preview-mode-and-loading-jquery" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/10/sitecore-preview-mode-and-loading-jquery/">Sitecore preview mode and loading jQuery</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/10/sitecore-preview-mode-and-loading-jquery/">
    <time datetime="2013-10-08T06:35:13.000Z" itemprop="datePublished">October 7, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>It seems like most folks these days are using jQuery on their sites. Sitecore, in fact, uses jQuery for the page editor UI. I discovered an interesting case where it can conflict with your own jQuery version that I thought I’d share.</p>
<p>The scenario where it happens is this:</p>
<ul>
<li>You are in preview, page editor, or debugger mode (any mode where the webedit toolbar renders on the site)</li>
<li>You are loading your jQuery library in the page header and not the footer (note: you should load it in the footer if it’s at all possible)</li>
</ul>
<p>jQuery has a feature called noConflict that is designed to allow you to isolate it from other libraries, such as Prototype, that also claim the “$” global variable. The feature can also be used to run two versions of jQuery on the same page, and Sitecore in fact does exactly this. However, the case that noConflict does not prevent is one where a second copy of jQuery is loaded on top of an existing one.</p>
<p>What happens here is that your jQuery loads in the heading, then Sitecore loads its jQuery and calls noConflict on it. Unfortunately, the loading of Sitecore’s JS overwrites the global <code>jQuery</code> variable, resulting in this mess:</p>
<ul>
<li><code>jQuery</code> = Sitecore jQuery (1.5.5 for SC7 Update-1, pretty old)</li>
<li><code>$</code> = your jQuery</li>
</ul>
<p>Now load a jQuery plugin that uses an <a target="_blank" rel="noopener" href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">IIFE</a> to load itself like:</p>
<pre><code>(function($) &#123;
    // plugin load code here
&#125;)(jQuery);
</code></pre>
<p>Yeah that’s right, the plugin invokes its function passing in <code>jQuery</code> aliased as <code>$</code>. Which means that <em>the plugin just loaded to Sitecore’s jQuery, not yours!</em> Now if you invoke the plugin you’ll see that it’s undefined in your jQuery!</p>
<p>Fortunately it’s relatively easy to manually fix this issue. You simply need to:</p>
<ul>
<li>Save your jQuery variable immediately after you load it: <br><code>&lt;script&gt;var my_jquery = jQuery;&lt;/script&gt;</code></li>
<li>Define the <code>webedit</code> placeholder explicitly on your layout, so you can control where Sitecore will load its version of jQuery:<br> <code>&lt;sc:Placeholder runat=&quot;server&quot; Key=&quot;webedit&quot;/&gt;</code></li>
<li>Set the global jQuery variable back to your saved jQuery immediately after the <code>webedit</code> placeholder definition:<br> <code>&lt;script&gt;jQuery = my_jquery;&lt;/script&gt;</code></li>
<li>It’s safe to let this code run even when not in preview mode, as it will simply have no effect if Sitecore does not load its jQuery. Of course you can also render it only when <code>!Sitecore.Context.PageMode.IsNormal</code> as well if you want clean output.</li>
</ul>
<p>If you can put your copy of jQuery in the footer, you don’t need to resort to any of this hackery. Hope this helps someone :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/10/sitecore-preview-mode-and-loading-jquery/" data-id="ckrl9emxp001k98q77c9102f0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-announcing-synthesis-7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/10/announcing-synthesis-7/">Announcing Synthesis 7</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/10/announcing-synthesis-7/">
    <time datetime="2013-10-03T06:37:07.000Z" itemprop="datePublished">October 2, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Synthesis/">Synthesis</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Synthesis 7 is now <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Synthesis">available on NuGet</a>. This version brings a number of new features and bug fixes largely aimed at supporting unit testing of sites that are built with Synthesis. Version 7 is compatible with Sitecore 7 Update-1 and Update-2.</p>
<h2 id="Fully-mockable-generated-item-classes"><a href="#Fully-mockable-generated-item-classes" class="headerlink" title="Fully mockable generated item classes"></a>Fully mockable generated item classes</h2><p>Previous versions of Synthesis would generate classes that had concrete field types, such as <code>RichTextField</code>, that were strongly tied to the Sitecore item APIs or search APIs. This prevented easily creating mock versions of the class for testing purposes. Synthesis 7 changes that by allowing you to define both a private concrete field type mapping <em>and</em> and public interface mapping, such as this:</p>
<pre><code>[IndexField(&quot;title&quot;)]
public ITextField Title &#123;
    get &#123; return new TextField(/* ... */);
&#125;
</code></pre>
<p>Now each field can be easily mocked with a mocking framework of your choice, enabling you to create totally Sitecore API free instances of Synthesis items. For example, using <a target="_blank" rel="noopener" href="https://github.com/Moq">Moq</a>:</p>
<pre><code>var item = new Mock&lt;IFooItem&gt;();
item.SetupGet(x =&gt; x.Title).Returns(new TestTextField(&quot;isn&#39;t this nice?&quot;));

string result = item.Object.Title.RawValue; // &quot;isn&#39;t this nice?&quot;
</code></pre>
<p>But wait! What about those pesky metadata properties like statistics, database, and editing? Those are annoying, huh. Well Synthesis 7 uses adapter classes to make those mockable too.</p>
<pre><code>public IDatabaseAdapter Database &#123; get; &#125;
</code></pre>
<p>It’s very easy to add a public interface to a field type mapping; you simply add an interface attribute to the mapping:</p>
<pre><code>&lt;map field=&quot;Single-Line Text&quot; type=&quot;Synthesis.FieldTypes.TextField, Synthesis&quot; interface=&quot;Synthesis.FieldTypes.Interfaces.ITextField, Synthesis&quot; /&gt;
</code></pre>
<h2 id="New-testing-package"><a href="#New-testing-package" class="headerlink" title="New testing package"></a>New testing package</h2><p>There is now a Synthesis.Testing package on NuGet that contains some dummy field type implementations to help you write cleaner mocks of Synthesis item types. The <code>TestTestField</code> class referred to in the Moq example above is part of the testing package.</p>
<h2 id="Injecting-custom-field-implementations-on-a-per-template-field-basis"><a href="#Injecting-custom-field-implementations-on-a-per-template-field-basis" class="headerlink" title="Injecting custom field implementations on a per-template-field basis"></a>Injecting custom field implementations on a per-template-field basis</h2><p>Previously you were able to map a Synthesis field class to a Sitecore field type. Synthesis 7 enables you to get more specific and map a field class to a specific field on a template. This enables you to provide custom behavior for specific fields.</p>
<pre><code>&lt;templateFieldMappings hint=&quot;raw:AddTemplateMapping&quot;&gt;
    &lt;map template=&quot;Content Section&quot; field=&quot;Content&quot; type=&quot;Synthesis.FieldTypes.TextField, Synthesis&quot; interface=&quot;Synthesis.FieldTypes.Interfaces.ITextField, Synthesis&quot; /&gt;
&lt;/templateFieldMappings&gt;
</code></pre>
<p>The template specification can be the template name, full path, or ID interchangeably. The field can be either the field name or field ID.</p>
<h2 id="Better-missing-field-messages"><a href="#Better-missing-field-messages" class="headerlink" title="Better missing field messages"></a>Better missing field messages</h2><p>If you’ve used Synthesis long, you’ve probably seen this one. You add a template field, generate your model, and forget to publish the field. Suddenly you get a really helpful “Parameter cannot be null” error that doesn’t tell you anything about the field name that actually caused it. Synthesis 7 fixes that problem, and reports the field name that was missing instead of a generic error message.</p>
<h2 id="Bug-fixes"><a href="#Bug-fixes" class="headerlink" title="Bug fixes"></a>Bug fixes</h2><ul>
<li>Modified default behavior of synthesis.axd. In Synthesis 5-6, if the model was detected as synchronized, no option to force a rebuild would be available. Problem is, configuration changes (e.g. changing the root namespace) do not invalidate the template signatures - so there were times when a ‘synchronized’ model would need to be force rebuilt. In Synthesis 7, the handler always rebuilds the model even if synchronization is detected.</li>
<li>Synthesis will no longer generate invalid C# code when faced with a template or field name that starts with a number. Leading numbers are automatically prefixed with _ so as to retain valid C#.</li>
<li>Fix media item URL generation error when <code>LinkProvider</code> has <code>AlwaysIncludeServerUrl</code> enabled. Previously, links like <code>/http://foo/~/media/bar</code> would be generated. Fix contributed by <a target="_blank" rel="noopener" href="https://github.com/PetersonDave">Dave Peterson</a></li>
<li>Removed a hack that allowed the LINQ extension <code>GetSynthesisQueryable()</code> to work, because it was fixed in Sitecore 7 Update-1.</li>
</ul>
<h2 id="Breaking-changes"><a href="#Breaking-changes" class="headerlink" title="Breaking changes"></a>Breaking changes</h2><ul>
<li>Due to the new adapter classes, code that uses the Database property may break. The adapter class returns Synthesis types, whereas the Synthesis 6 version returned Sitecore <code>Item</code> instances. This enables decoupling the <code>IDatabaseAdapter</code> from the Sitecore API.</li>
<li>If using interfaces for your object properties (which you will need to manually enable if upgrading), the type of those properties will change. This may break code such as view models that contains fields as properties.</li>
<li>Support for implicit field conversions (e.g. to treat a TextField as a string) have been removed. These do not work when using interfaces, and generally are a bad idea because they can allow unexpected behavior (is an implicit conversion to use a raw value? field renderer?).</li>
<li>Support for the <code>FileListField</code> (File Drop Area) field type has been removed</li>
<li>Support for the <code>WordDocumentField</code> field type has been removed</li>
<li>The <code>IFieldMappingProvider</code> interface signature has changed to enable injecting custom field types on a field level. Custom providers may need minor refactoring.</li>
<li><em>Synthesis.Blade:</em> the signature of the <code>SynthesisPresenter.GetItem()</code> method has changed from protected to public (a breaking change for all presenters based on this). Unfortunately, this was by far the simplest and cleanest avenue to allow for injecting arbitrary Synthesis item data sources for testing purposes.</li>
</ul>
<h2 id="Upgrading"><a href="#Upgrading" class="headerlink" title="Upgrading"></a>Upgrading</h2><p>Upgrading to Synthesis 7 is a process that takes a bit of work. </p>
<ul>
<li><p>First, upgrade the NuGet package to Synthesis 7</p>
</li>
<li><p>After upgrading the NuGet package, you should remove the field mappings in Synthesis.config to the removed Word Document field and File Drop Area field types. The Word field mapping may not exist depending on what version you’re coming from.</p>
<pre><code>  &lt;map field=&quot;File Drop Area&quot; type=&quot;Synthesis.FieldTypes.FileListField, Synthesis&quot; /&gt; &lt;!-- remove this from Synthesis.config --&gt;
</code></pre>
</li>
<li><p>Next, you will need to regenerate the Synthesis model. Do not build the project at this point, because the model format has changed in Synthesis 7 and the existing model will be full of build errors. Hit /synthesis.axd and force a regeneration, which will remove any build errors not caused by a breaking change as outlined above.</p>
<ul>
<li>If some sort of global handler (such as a <code>httpRequestBegin</code> pipeline handler) is causing an error before you even get to synthesis.axd temporarily disable it for the purposes of regenerating the model.</li>
</ul>
</li>
<li><p>By default, a Synthesis 7 upgrade will not enable using interfaces for field types (unless you overwrite Synthesis.config during the install, which is not recommended). Should you wish to enable interfaces, simply look at the <a target="_blank" rel="noopener" href="https://github.com/kamsar/Synthesis/blob/master/Source/Synthesis/Synthesis.config">default config file</a> and merge the interface attributes in under <code>&lt;fieldMappings&gt;</code> to your config, then regenerate.</p>
</li>
<li><p>If using Synthesis.Blade, you will need to change the visibility on <code>GetItem()</code> for any presenters that use <code>SynthesisPresenter</code> as their base class to public, instead of protected.</p>
</li>
<li><p>Verify that the case of your content search config patch at the bottom of <code>Synthesis.config</code> matches the case in your <code>Sitecore.ContentSearch.Lucene.DefaultIndexConfiguration.config</code>. The case of the default config changed in Update-2, but depending on how you upgraded yours might not have. See <a href="https://kamsar.net/index.php/2013/09/sitecore-7-update-2-and-synthesis-6/">this blog post</a> for details as to why this is necesary. If the case is incorrect, Synthesis LINQ queries will not work correctly.</p>
</li>
<li><p>Fix any remaining build issues caused by breaking changes (if any), and test the site.</p>
</li>
</ul>
<h2 id="Feedback"><a href="#Feedback" class="headerlink" title="Feedback"></a>Feedback</h2><p>I’d love to hear from you if you have trouble or ideas. <a target="_blank" rel="noopener" href="https://github.com/kamsar/Synthesis/issues/new">Send me an issue on GitHub!</a></p>
<p>As always, the <a target="_blank" rel="noopener" href="https://github.com/kamsar/Synthesis">Synthesis source is available</a> under <a target="_blank" rel="noopener" href="http://opensource.org/licenses/MIT">the MIT license</a>, so feel free to hack away - and send me a pull request ;)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/10/announcing-synthesis-7/" data-id="ckrl9emxo001i98q780v72kyp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-announcing-blade-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/10/announcing-blade-2/">Announcing Blade 2</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/10/announcing-blade-2/">
    <time datetime="2013-10-03T06:27:07.000Z" itemprop="datePublished">October 2, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Blade/">Blade</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’m happy to announce that <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Blade">Blade v2 is now available from NuGet</a>. There are some very nice new features in this release.</p>
<h2 id="MVC4-Razor-APIs-instead-of-RazorEngine"><a href="#MVC4-Razor-APIs-instead-of-RazorEngine" class="headerlink" title="MVC4 Razor APIs instead of RazorEngine"></a>MVC4 Razor APIs instead of RazorEngine</h2><p>Blade 2.0 replaces the RazorEngine library with directly calling MVC4 APIs. Doing this is much cleaner (and faster!) than the previous Razor implementation. This does introduce some minor breaking changes so read up before you upgrade.</p>
<ul>
<li>Useful errors with source context if there’s a syntax error or runtime error in a razor file. This was a major issue with previous versions of Blade that made razor errors difficult to debug.</li>
<li>Full support, including IntelliSense, for using <code>@model</code> to declare the model type in razor views instead of the much more verbose <code>@inherits RazorRendering&lt;TModel&gt;</code> previously required. The old way still works fine too.</li>
<li>The <code>BladeHtmlHelper</code> is gone, replaced by the normal MVC <code>HtmlHelper</code> - note that pieces of the helpers that do not make sense in a pseudo-MVC context, such as <code>ActionLink</code>, may behave unpredictably.</li>
<li>View resolution follows the conventions of the MVC view engines that are registered. This means that path resolution is a bit different:<ul>
<li>Html.Partial() will require absolute paths (<code>~/Foo/Bar/Baz.cshtml</code>) unless you are storing your Razor files in <code>/Views</code> like MVC does</li>
<li>When statically including Razor renderings with the <code>RazorTemplate</code> web control, you must add <code>.cshtml</code> on the end of view paths, whereas previously that was optional</li>
<li>Razor layout paths are unchanged from previous behavior: they can be relative, and you need .cshtml on them</li>
<li>You should be able to plug in whatever view resolution logic you desire by adding in your own view engines in Global.asax just like with MVC sites</li>
</ul>
</li>
</ul>
<h2 id="Form-support-and-model-binding"><a href="#Form-support-and-model-binding" class="headerlink" title="Form support and model binding!"></a>Form support and model binding!</h2><p>Presenters can now handle postback in a clean fashion by using ASP.NET MVC model binding to bind posted values to your ViewModel automatically. There is also explicit support for handling XHR (AJAX) postbacks separately, enabling easy creation of simple callbacks to the same page that return JSON data.</p>
<ul>
<li>MVC model validation attributes (e.g. <code>[Required]</code>) and validation controls are fully supported for Razor views, as are MVC HTML helpers (<code>@Html.TextBoxFor(x=&gt;x.MyStringProperty)</code>, for example). User Controls and Web Controls support validation, but they do not have <code>ModelState</code> to pass it around to so you’d need to manually parse the validation result in the presenter for those.</li>
<li>To support postback, if using a <code>SitecorePresenter</code> or <code>SynthesisPresenter</code>, simply override the <code>HandlePostBackWithModelBinding</code> method. The method is invoked if HTTP POST is requested, and model binding is automatically executed. Similar methods exist for XHR and non-automatic-modelbinding for both.</li>
<li>The postback handling occurs immediately after the OnLoad event just like web forms usually does for submit event handlers. You can assume that <code>GetModel()</code> will have already been called on the presenter.</li>
<li>Adding custom <code>ModelBinders</code> in Global.asax, just like in MVC, should work perfectly.</li>
</ul>
<h2 id="Unit-testable-presenters"><a href="#Unit-testable-presenters" class="headerlink" title="Unit testable presenters"></a>Unit testable presenters</h2><p>In Blade itself, the <code>SitecorePresenter</code> has been modified to allow injection of a custom <code>Item</code> as the data source of the presenter (via the <code>SetDataSource()</code> method), enabling you to decouple it from data source resolution logic. However, you probably should not be testing with <code>Item</code> instances, as those require a lot of Sitecore API presence. To get around this issue, Synthesis.Blade’s <code>SynthesisPresenter</code> enables injection of a custom Synthesis item interface directly into its <code>GetItem</code> method for completely Sitecore-independent tests! Check out this trivial example of testing a SynthesisPresenter, using Moq:</p>
<pre><code>var item = new Mock&lt;ITestTemplateItem&gt;();
var view = new Mock&lt;IView&gt;();

// todo: setup mocks appropriately

var presenter = new TestPresenter();

var model = presenter.GetModel(view.Object, item.Object);

// todo: assert something about the resultant model
</code></pre>
<h3 id="Testing-limitations"><a href="#Testing-limitations" class="headerlink" title="Testing limitations"></a>Testing limitations</h3><p>Views are not particularly testable due to them using the MVC Razor engine, which requires a web context to execute. Hypothetically you could write tests against them using a web-based test runner, but it seems that most people do not recommend testing the view due to the relative fragility of the tests involved.</p>
<h2 id="Upgrading"><a href="#Upgrading" class="headerlink" title="Upgrading"></a>Upgrading</h2><p>To upgrade from Blade 1.5 to Blade 2.0, simply upgrade the NuGet package. You should definitely test all of your razor views after the upgrade to make sure they are running correctly against the new MVC-based razor implementation. If you are not using razor, the upgrade should be pretty much seamless.</p>
<p>Because Blade uses XDT-transformation-based installation routines, you will need NuGet 2.6 or later to install it.</p>
<p>If you are also using Synthesis with Blade, you will need to upgrade to Synthesis/Synthesis.Blade 7.0 to be compatible with Blade 2.0.</p>
<h2 id="Feedback"><a href="#Feedback" class="headerlink" title="Feedback"></a>Feedback</h2><p>I’d love to hear from you if you have trouble or ideas. <a target="_blank" rel="noopener" href="https://github.com/kamsar/Blade/issues/new">Send me an issue on GitHub!</a></p>
<p>As always, the <a target="_blank" rel="noopener" href="https://github.com/kamsar/Blade">Blade source is available</a> under <a target="_blank" rel="noopener" href="http://opensource.org/licenses/MIT">the MIT license</a>, so feel free to hack away - and send me a pull request ;)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/10/announcing-blade-2/" data-id="ckrl9emxn001d98q7dwirh64n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-sitecore-7-update-2-and-synthesis-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/09/sitecore-7-update-2-and-synthesis-6/">Sitecore 7 Update-2 and Synthesis 6</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/09/sitecore-7-update-2-and-synthesis-6/">
    <time datetime="2013-09-25T06:40:32.000Z" itemprop="datePublished">September 24, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Synthesis/">Synthesis</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="http://sdn.sitecore.net/Products/Sitecore%20V5/Sitecore%20CMS%207/Update/7_0_rev_130918.aspx">Sitecore 7 Update-2</a> was released today, and it brought with it a surprise: Synthesis’ LINQ query support broke. Well, that’s unusual for a Sitecore update.</p>
<p>Fortunately it is easy to fix. In the <code>Sitecore.ContentSearch.Lucene.DefaultIndexConfiguration.config</code> config patch file, Update-2 changes all of the element casing from PascalCase to camelCase. So the old XPath <code>/configuration/sitecore/contentSearch/configuration/DefaultIndexConfiguration</code> turned into <code>/configuration/sitecore/contentSearch/configuration/defaultIndexConfiguration</code>. DOH! Unfortunately for us, XML - and Sitecore config patching - is case senstive. This means the config tweaks made to search in <code>Synthesis.config</code> no longer applied!</p>
<p>The <a target="_blank" rel="noopener" href="http://sdn.sitecore.net/SDN5/Products/Sitecore%20V5/Sitecore%20CMS%207/ReleaseNotes/webConfig/70_130918.aspx">release notes for Update-2</a> do not mention this casing change, so if you were manually patching you might <em>not</em> catch this. But the stock <code>DefaultIndexConfiguraion.config</code> file available for download on that page, as well as in the zip distro of Update-2, both change a lot of case in the config.</p>
<h2 id="Fixing-the-problem"><a href="#Fixing-the-problem" class="headerlink" title="Fixing the problem"></a>Fixing the problem</h2><p>Fortunately it’s pretty easy to fix Synthesis running against a re-cased Update-2 config file. At the bottom of your <code>Synthesis.config</code> find the <contentSearch> section and replace it with this (or just change :</p>
<pre><code> &lt;contentSearch&gt;
    &lt;configuration&gt;
        &lt;defaultIndexConfiguration&gt;
            &lt;indexDocumentPropertyMapper type=&quot;Synthesis.ContentSearch.SynthesisDocumentTypeMapper, Synthesis&quot; /&gt;

            &lt;fields hint=&quot;raw:AddComputedIndexField&quot;&gt;
                &lt;field fieldName=&quot;_templatesimplemented&quot; storageType=&quot;yes&quot; indexType=&quot;untokenized&quot;&gt;Synthesis.ContentSearch.ComputedFields.InheritedTemplates, Synthesis&lt;/field&gt;
            &lt;/fields&gt;
        &lt;/defaultIndexConfiguration&gt;
    &lt;/configuration&gt;
&lt;/contentSearch&gt;
</code></pre>
<h2 id="Dealing-with-versioning"><a href="#Dealing-with-versioning" class="headerlink" title="Dealing with versioning"></a>Dealing with versioning</h2><p>Unfortunately this leaves Synthesis in a less than optimal situation where the default distribution is more or less Sitecore patch-specific. Synthesis 5, released with Sitecore 7 RTM, only works with RTM. Synthesis 6, released with Update-1, only works with Update-1 due to the moving of a Sitecore class in the update. It requires you to find this blog post to get it to work correctly with Update-2 by way of the patch above. The upcoming Synthesis 7 will have configuration by default for Update-2 - which means it will break if installed under Update-1.</p>
<p>Don’t get me wrong, I love Sitecore 7, but the search APIs are more than a little unstable at the moment for library authors!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/09/sitecore-7-update-2-and-synthesis-6/" data-id="ckrl9emxo001f98q77dtw27ro" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-upgrading-sitecores-password-security" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/09/upgrading-sitecores-password-security/">Upgrading Sitecore&#39;s Password Security with PBKDF2</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/09/upgrading-sitecores-password-security/">
    <time datetime="2013-09-02T06:41:41.000Z" itemprop="datePublished">September 1, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/index.php/category/Sitecore/Crypto/">Crypto</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="The-problem"><a href="#The-problem" class="headerlink" title="The problem"></a>The problem</h2><p>A few months ago I read a very interesting article on Ars Technica titled <a target="_blank" rel="noopener" href="http://arstechnica.com/security/2013/03/how-i-became-a-password-cracker/">How I became a password cracker</a>. Seriously, go read it. These days it’s astonishing how simple it is to brute force even long, random-looking passwords. That 1337-5p33k p@55w0rd? You might as well use dictionary words because there are rules that check for that. Using a passphrase of english words (like <a target="_blank" rel="noopener" href="https://xkcd.com/936/">correct horse battery staple</a>)? Well it’s easy to test for combinations of dictionary words too, so those are a lot less secure than they look.</p>
<h2 id="Mitigation"><a href="#Mitigation" class="headerlink" title="Mitigation"></a>Mitigation</h2><p>The core problem is that most passwords are stored using hash algorithms such as SHA and MD5 that were originally designed to verify file integrity - so <em>speed</em> was a primary concern. If a hash algorithm is fast, so is brute-forcing passwords that use it. Modern GPUs can compute hashes obscenely fast (spend a bit and you can hit 1 <em>billion</em> hashes per second), so a good way to thwart attackers is simply to use a hash algorithm that is <em>slow</em>. Several algorithms exist that are designed to be utilized specifically for passwords (such as <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> and <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Bcrypt">BCrypt</a>), and they are all much slower to compute for this very reason.</p>
<p>These algorithms also usually have a “work factor” that allows you to adjust the time it takes to compute the hash, which provides even more future-proofing against even faster password cracking hardware that is yet to be developed.</p>
<h2 id="When-would-this-affect-Sitecore"><a href="#When-would-this-affect-Sitecore" class="headerlink" title="When would this affect Sitecore?"></a>When would this affect Sitecore?</h2><p>To be clear this is not a remotely-exploitable vulnerability. It’s also not a Sitecore-specific vulnerability - it affects most all sites running ASP.NET’s Membership provider which until very recent providers (Universal Providers) defaults to the SHA1 hash algorithm to store passwords. <em>In order to exploit what I’m describing here, an attacker would have to gain access to your databases</em>, which they would then use an offline password cracker like <a target="_blank" rel="noopener" href="http://hashcat.net/oclhashcat-plus/">oclHashcat-plus</a> to break the passwords to login to Sitecore.</p>
<h2 id="Using-PBKDF2-with-Sitecore"><a href="#Using-PBKDF2-with-Sitecore" class="headerlink" title="Using PBKDF2 with Sitecore"></a>Using PBKDF2 with Sitecore</h2><p>There’s a <a target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/system.security.cryptography.rfc2898derivebytes.aspx">class in the .NET framework that implements the PBKDF2 algorithm</a> already, but it does so in a way that makes it difficult to add to a membership provider. There’s a very nice NuGet package called <a target="_blank" rel="noopener" href="http://www.nuget.org/packages/Zetetic.Security">Zetetic.Security</a> that wraps this functionality into a <code>KeyedHashAlgorithm</code> that can be used easily with membership. It’s very easy to <a target="_blank" rel="noopener" href="http://zetetic.net/blog/2012/7/3/secure-password-hashing-for-aspnet-in-one-line.html">install PBKDF2 into a membership provider</a> using it - you have to install the NuGet package and change two configurations.</p>
<p>The only problem is that existing users will be unable to login because the existing hashes are all in SHA1 (Sitecore, and membership’s, default algorithm) and the membership provider now expects PBKDF2 hashes. If there are only a few users you can just reset passwords and be done with it. But if you have an existing userbase, you probably wish you could allow existing users to keep signing in, and new users (or password changes) to convert to PBKDF2. I’ve implemented <a target="_blank" rel="noopener" href="https://gist.github.com/kamsar/6407742">a prototype extension of the SqlMembershipProvider</a> that does exactly this by allowing the <code>ValidateUser</code> method to attempt SHA1 if PBKDF2 validation fails.</p>
<h2 id="Other-uses"><a href="#Other-uses" class="headerlink" title="Other uses"></a>Other uses</h2><p>The solution discussed in this post was tested against Sitecore, but is a generic method you could use with any .NET app that uses SQL Membership to store user info. I hope this random crypto rant has been useful to you :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/09/upgrading-sitecores-password-security/" data-id="ckrl9emxk001898q77rb26amj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-editing-hidden-template-fields-in-the-page-editor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2013/08/editing-hidden-template-fields-in-the-page-editor/">Editing hidden template fields in the page editor</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2013/08/editing-hidden-template-fields-in-the-page-editor/">
    <time datetime="2013-08-15T06:44:01.000Z" itemprop="datePublished">August 14, 2013</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently on a project I came across a need to allow editors who were using the Sitecore Page Editor to modify some fields that had no logical place on the actual editor screen. In this case, the fields were relating to page SEO - meta keywords and description among other things. Since these are in the head of the page, there’s no good place to stick an edit frame or custom experience button - they aren’t even part of a rendering placed on the page.</p>
<p>While poking around the WebEdit customization options, I hit on the idea of adding a WebEdit ribbon button that would act as a custom experience button would, and load a subset of the item fields in a content editor window. It turns out this was actually relatively easy. </p>
<p>In the Core database, the default WebEdit ribbon is defined under <code>/sitecore/content/Applications/WebEdit/Ribbons/WebEdit/Page Editor</code>. Under this item are items for each ‘chunk’ in the ribbon, and under that each command button, like this:</p>
<img src="/images/20130814tree.png" alt="tree" width="185" height="253" class="alignnone size-full wp-image-751" />

<p>To implement your own command, you just need to add a Small Button or Large Button item underneath a Chunk - new or existing - to place your button on the ribbon. The “SEO” chunk in the above screenshot is an example of what you want to end up with. </p>
<p>The key piece of all of this is how to have your button actually load the field editor, and telling it what fields to load. You do this by configuring the Click field on the button to run the <code>webedit:fieldeditor</code> command like so:</p>
<pre><code>webedit:fieldeditor(fields=Browser Title|Description|Keywords, command=&#123;007A0E9E-59AA-48BB-84F2-6D25A8D2EF80&#125;)
</code></pre>
<p>The fields argument is pretty easy to understand - a pipe delimited list of fields to edit, just like a WebEdit Custom Experience Button has (this command is in fact the one used by custom experience buttons). The command parameter I am not sure what it is used for. Internally it seems to need to be an item in the core db that exists - I used the GUID of my button item, and that worked fine.</p>
<p>And here’s what you end up with when you’re done, for a very small amount of work:</p>
<img src="/images/20130814result.png" alt="result" />

<p>This worked for me on Sitecore 7 (RTM), but I suspect the technique would work great on earlier versions of Sitecore as well.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2013/08/editing-hidden-template-fields-in-the-page-editor/" data-id="ckrl9emxj001698q7f32betec" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/blog/archives/index.php/page/7/">&amp;laquo; Prev</a><a class="page-number" href="/blog/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/archives/index.php/page/6/">6</a><a class="page-number" href="/blog/archives/index.php/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/blog/archives/index.php/page/9/">9</a><a class="page-number" href="/blog/archives/index.php/page/10/">10</a><a class="page-number" href="/blog/archives/index.php/page/11/">11</a><a class="extend next" rel="next" href="/blog/archives/index.php/page/9/">Next &amp;raquo;</a>
    </nav>
  
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JavaScript/">JavaScript</a></p>
              <p class="item-title"><a href="/index.php/2021/07/Fun-with-async-generators-and-for-await/" class="title">Fun with async generators and for await</a></p>
              <p class="item-date"><time datetime="2021-07-26T23:30:51.000Z" itemprop="datePublished">July 26, 2021</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/Jamstack/">Jamstack</a></p>
              <p class="item-title"><a href="/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/" class="title">Deploying multiple Netlify sites from one monorepo</a></p>
              <p class="item-date"><time datetime="2020-08-21T03:30:32.000Z" itemprop="datePublished">August 20, 2020</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/" class="title">Running JSS headless mode in containers part 2: Build containers</a></p>
              <p class="item-date"><time datetime="2019-09-16T02:14:04.000Z" itemprop="datePublished">September 15, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/" class="title">Running JSS headless mode in containers, part 1</a></p>
              <p class="item-date"><time datetime="2019-09-08T19:00:36.000Z" itemprop="datePublished">September 8, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/C/">C#</a></p>
              <p class="item-title"><a href="/index.php/2019/05/Build-2019-All-the-things/" class="title">Build 2019: All the things</a></p>
              <p class="item-date"><time datetime="2019-05-10T23:01:11.000Z" itemprop="datePublished">May 10, 2019</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Crypto/">Crypto</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Lucene/">Lucene</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/MVC/">MVC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Search/">Search</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/xDB/">xDB</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>&copy; 2021 Kam Figy</p>
      <p><small>Opinions expressed on this blog are my own, and not necessarily those of my employer.</small></p>
     <p><small>This work is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</small></p>
    </div>
  </div>
</footer>
    


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>