<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2016/1 | Kam&#39;s Idea Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Kam&#39;s Idea Log">
<meta property="og:url" content="https://kamsar.net/blog/archives/2016/01/index.html">
<meta property="og:site_name" content="Kam&#39;s Idea Log">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Kam Figy">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@kamsar">
  
    <link rel="alternative" href="/index.php/feed" title="Kam&#39;s Idea Log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62284328-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo">
        <span class="site-title">Kam&#39;s Idea Log</span>
        <span class="subtitle">C#, Jamstack, and Shenanigans</span>
      </a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=40" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=80 2x" alt="omg the beard"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </td>
      </tr>
    </table>
  </div>
  
  <div id="header-sub" class="header-sub header-inner">
    <div class="outer">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=128" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=256 2x" alt="#sitecorebeard">
      <h2 id="name">Kam Figy</h2>
      <h3 id="title">Principal Platform Architect at</h3>
      <a class="corp-logo" href="https://uniform.dev" target="_blank"><img src="/css/images/uniform-logo.svg" alt="Uniform" width="180"></a>
      <span id="location"><i class="fa fa-map-marker"></i>Vancouver, WA USA</span>
      <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/kamsar">FOLLOW</a>
  	</div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a target="_blank" rel="noopener" href="https://github.com/kamsar" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a target="_blank" rel="noopener" href="https://twitter.com/kamsar" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/index.php/feed" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    <div class="article-info profile-block bio">
      <h2>About</h2>
      <p>Kam has been making websites since 1996, starting out with a 14.4k modem on a <a href="https://en.wikipedia.org/wiki/Party_line_(telephony)" target="_blank">party line</a> in the Hawaiian rainforest. A veteran developer, architect, and speaker, he's been working in the content management space for well over a decade. Kam is the author of <a href="https://github.com/kamsar/Unicorn" target="_blank">Unicorn</a>, <a href="https://github.com/kamsar/Synthesis" target="_blank">Synthesis</a>, <a href="https://github.com/kamsar/Dianoga" target="_blank">Dianoga</a>, and several other open-source libraries.</p>
    </div>
  </div>
</aside>
      <section id="main">
  
  
    
    
      
        <div class="archive-year-wrap">
          <i class="fa fa-calendar"></i>
          <a href="/archives/2016" class="archive-year">2016</a>
        </div>
    
    <article id="post-Unicorn-3-1-Released" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2016/01/Unicorn-3-1-Released/">Unicorn 3.1 Released</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2016/01/Unicorn-3-1-Released/">
    <time datetime="2016-01-27T04:58:31.000Z" itemprop="datePublished">January 26, 2016</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Unicorn/">Unicorn</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Unicorn 3.1 and Rainbow 1.1 are released to NuGet. These updated versions bring several new features and a bunch of fixes. Upgrading is recommended for all users of Unicorn 3.0 due to the fixing of some data issues.</p>
<h2 id="What’s-new"><a href="#What’s-new" class="headerlink" title="What’s new?"></a>What’s new?</h2><h3 id="Configuration-Dependencies"><a href="#Configuration-Dependencies" class="headerlink" title="Configuration Dependencies"></a>Configuration Dependencies</h3><p>Unicorn configurations may now declare dependency relationships between each other. This is useful for example when one configuration may contain templates and another configuration might contain items based on those templates. With a dependency relationship the dependent configurations are guaranteed to always go first when configurations are synced. Transitive relationships (e.g. A -&gt; B -&gt; C) are supported.</p>
<p>Dependencies are defined using <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn/Standard%20Config%20Files/Unicorn.Configs.Dependency.config.example">a dependencies attribute</a> on the configuration.</p>
<p>Dependencies <strong>do not</strong> force dependent configurations to sync. If config <code>A</code> depends on config <code>B</code> and you choose to sync only config <code>A</code>, <code>B</code> will not be synced. However if you sync <em>both</em> <code>A</code> and <code>B</code>, then <code>B</code> will always sync first due to the dependency.</p>
<h3 id="Include-Exclude-Predicate-Enhancements"><a href="#Include-Exclude-Predicate-Enhancements" class="headerlink" title="Include/Exclude Predicate Enhancements"></a>Include/Exclude Predicate Enhancements</h3><p>The predicate system has been significantly overhauled in Unicorn 3.1 to allow more advanced include and exclude scenarios.</p>
<ul>
<li><p>Exclude entries may now use paths relative to the parent <code>&lt;include&gt;</code> by omitting a leading slash. This would exclude <code>/foo/bar</code>: </p>
<pre><code>  &lt;include path=&quot;/foo&quot;&gt;
      &lt;exclude path=&quot;bar&quot; /&gt;
  &lt;/include&gt;
</code></pre>
</li>
</ul>
<ul>
<li><p>A new explicit grammar for excluding all children of an include has been introduced. This replaces the previous implicit grammar of adding a trailing slash (which still works but is deprecated).</p>
<pre><code>  &lt;include path=&quot;/foo&quot;&gt;
      &lt;exclude children=&quot;true&quot; /&gt;
  &lt;/include&gt;
</code></pre>
</li>
<li><p>The explicit children grammar supports <code>&lt;except&gt;</code> syntax to exclude all children <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn.Tests/Predicates/TestConfiguration.xml#L31">except for specific ones</a>.</p>
<pre><code>  &lt;include path=&quot;/somechildren&quot;&gt;
      &lt;exclude children=&quot;true&quot;&gt;
          &lt;except name=&quot;tests&quot; /&gt;
          &lt;except name=&quot;fests&quot; /&gt;
      &lt;/exclude&gt;
  &lt;/include&gt;
</code></pre>
</li>
<li><p>A new explicit grammar for excluding only children of a specific sub-path has been added. This grammar also supports <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn.Tests/Predicates/TestConfiguration.xml#L41"><code>&lt;except&gt;</code> syntax</a> and relative paths.</p>
<pre><code>  &lt;include path=&quot;/foo&quot;&gt;
      &lt;exclude childrenOfPath=&quot;/foo&quot; /&gt;
      &lt;exclude childrenOfPath=&quot;bar&quot;&gt; &lt;!-- /foo/bar/* --&gt;
          &lt;except name=&quot;quux&quot; /&gt; &lt;!-- include /foo/bar/quux --&gt;
      &lt;/exclude&gt;
  &lt;/include&gt;
</code></pre>
</li>
</ul>
<p>Take a look at the <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn.Tests/Predicates/TestConfiguration.xml">test predicate configuration</a> for examples of all available grammars.</p>
<h3 id="Control-Panel-Tool-Authentication"><a href="#Control-Panel-Tool-Authentication" class="headerlink" title="Control Panel Tool Authentication"></a>Control Panel Tool Authentication</h3><p>The method used to authenticate automated tools to Unicorn has been updated to be significantly more secure using a <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Challenge-Handshake_Authentication_Protocol">CHAP</a> implementation. This also comes with a handy <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/tree/master/doc/PowerShell%20Remote%20Scripting">PowerShell module</a> that you can use to simply invoke the handshake from a build script.</p>
<p>Should you require the legacy shared secret method, that is <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn/Standard%20Config%20Files/Unicorn.UI.config#L24">still available but it is not the default</a>. Security is also now pluggable, if you wanted to use your own implementation.</p>
<p>The remote API ships disabled by default and you must activate it by <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn/Standard%20Config%20Files/Unicorn.UI.config#L18">generating a random shared secret and adding it to the config</a>. This same secret must be known to invoke the API, and unlike the legacy API the secret is never transmitted directly.</p>
<h3 id="Breaking-Changes"><a href="#Breaking-Changes" class="headerlink" title="Breaking Changes"></a>Breaking Changes</h3><p>Unicorn 3.1 has some breaking changes compared to Unicorn 3.0, so upgrading requires reserializing your items to get them in a consistent format with the latest version. Unicorn 3.1 does understand Unicorn 3.0-formatted items, but Unicorn 3.0 <em>does not</em> understand Unicorn 3.1-formatted items. There will also be some repeated changes in the logs if you sync 3.0 items with 3.1, so usage with 3.0 items is not recommended.</p>
<p>Introducing breaking changes was a hard decision to make, but I think the saner defaults and new capabilities will justify the slightly more difficult upgrade process. So what’s breaking?</p>
<ul>
<li>The item’s database name is now stored in the serialized data (<a target="_blank" rel="noopener" href="https://github.com/kamsar/Rainbow/pull/7">#7</a>). This enables parsing serialized items in contexts where the database cannot easily be inferred, such as Courier.</li>
<li>Unversioned fields have official support and are nested under the <code>Language</code> instead of under a <code>Version</code> within the language which was incorrect. Prior to reserializing, syncing a 3.0-formatted item with 3.1 may result in messages that the field has been reset to standard values and then set again. <code>IItemData</code> now has an <code>UnversionedFields</code> property to store unversioned fields by language.</li>
<li>The name on serialized fields has been converted from a comment in the YAML into an actual parsed value. Note that this value is just a hint and if a template field is renamed it is NOT updated automatically.</li>
<li>The default setting of <code>Rainbow.SFS.ExtraInvalidFilenameCharacters</code> has been changed to <code>&quot;$&quot;</code> to make Rainbow compatible by default with TFS, and the TFS config example that previously set this has been removed.</li>
<li>The default setting for <code>Rainbow.SFS.SerializationFolderPathMaxLength</code> has been increased from <code>90</code> to <code>110</code> based on real world experience that 90 is too short.</li>
<li>The default setting for <code>Rainbow.SFS.MaxItemNameLengthBeforeTruncation</code> has been reduced from <code>100</code> to <code>30</code> based on real world experience that 100 was long enough to break the path length limitation for items with near 100 length names.</li>
<li>Automated deployment tools calling Unicorn have a new security API. See below for details on this, but it’s now more secure.</li>
</ul>
<h3 id="Other-Improvements"><a href="#Other-Improvements" class="headerlink" title="Other Improvements:"></a>Other Improvements:</h3><ul>
<li>Syncing dictionary items will now cause the dictionary cache to be cleared at the end of the sync, forcing the synced entries to be loaded.</li>
<li>The Unicorn Control Panel is now pipeline-based and extensible so that modules may define their own verbs or alter the UI if needed.</li>
<li>Error messages when serializing and deserializing XML-based fields (layout, rules) have been improved.</li>
<li>Unicorn and Rainbow both now utilize the C# 6.0 syntax and require the <a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/download/details.aspx?id=48159">C# 6.0 compiler</a> to build. They still target .NET 4.5.</li>
<li>Config file comments and documentation have been updated to cover the new features of Unicorn 3.1.</li>
</ul>
<h3 id="Bug-fixes"><a href="#Bug-fixes" class="headerlink" title="Bug fixes:"></a>Bug fixes:</h3><ul>
<li>Renaming or moving items which are serialized on loopback paths will no longer cause the serialized children to be deleted.</li>
<li>Missing field errors on the root item of a tree now result in a retry and non fatal error as expected.</li>
<li>A non fatal warning when syncing multiple configurations will no longer result in the sync stopping at the end of the configuration with the non fatal warning.</li>
<li>When using the New Items Only evaluator, you will no longer receive sync conflict warnings when saving items created by the evaluator.</li>
<li>Copying items when Transparent Sync is enabled and the source item is not in the Sitecore database now works correctly.</li>
<li>Empty field values will no longer cause problems when Transparent Sync is enabled.</li>
<li>XML-based fields (layout, rules) with empty values will no longer cause exceptions. <a target="_blank" rel="noopener" href="https://github.com/kamsar/Rainbow/pull/6">#6</a>, <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/issues/90">#90</a></li>
<li>Items installed by Sitecore packages or update packages into Unicorn configuration areas will no longer lose some field values in the serialized items. <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/issues/92">#92</a></li>
<li>Predicate include entries and SFS trees are no longer confused by paths which are different but start with similar bases, such as <code>/sitecore/content</code> and <code>/sitecore/content monkey</code></li>
<li>Plain text Unicorn logs returned to automated tool calls will no longer include HTML-encoded values such as <code>&amp;gt;</code></li>
<li>Naming items a <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx">Windows reserved file name</a> such as CON or COM1 will no longer result in an error. <a target="_blank" rel="noopener" href="https://github.com/kamsar/Rainbow/issues/8">#8</a></li>
<li>Fields with a blank value in Sitecore that were not included in the serialized item were not being correctly reset to standard values. This has been fixed.</li>
</ul>
<h2 id="Upgrading"><a href="#Upgrading" class="headerlink" title="Upgrading"></a>Upgrading</h2><p>Ok so there are breaking changes, how do I upgrade? Thankfully it’s not too hard.</p>
<ol>
<li><strong>Before</strong> you upgrade, run a full sync of all configurations. If some have Transparent Sync enabled, turn that off during the upgrade. (you can reenable after step 4)</li>
<li>Upgrade your NuGet packages to Unicorn 3.1. (which will also install Rainbow 1.1)</li>
<li>Run a build of your solution, and if you develop out of webroot publish your changes.</li>
<li>Using the Unicorn control panel, <strong>Reserialize</strong> all configurations to flush them to disk as 3.1-format items.</li>
<li>If you use the automated tool API to do automated execution of Unicorn, migrate to the <a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn/tree/master/doc/PowerShell%20Remote%20Scripting">PowerShell module</a> to invoke the new API.</li>
<li>Have fun!</li>
</ol>
<h2 id="Contributors"><a href="#Contributors" class="headerlink" title="Contributors"></a>Contributors</h2><p>Unicorn 3.1 has seen contributions from many community members. Thank you all for your support, testing, bug reports, and contributions!</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/cassidydotdk">Mark Cassidy</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Eldblom">Thomas Eldblom</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/agehrke">Andreas Gerhke</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/OlegJytnik">Oleg Jytnik</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/patoncrispy">Chris Paton</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/drachele">Daniel Rachele</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/divamatrix">Lewanna Rathbun</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/guitarrich">Richard Seal</a></li>
<li><a target="_blank" rel="noopener" href="https://twitter.com/BerserkerDotNET">Andrii Snihyr</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/csteeg">Chris van de Steeg</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/GeorgeKarbyn">George Thomaidis</a></li>
<li><a target="_blank" rel="noopener" href="https://twitter.com/williamsk000">Kevin Williams</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dashkodo">dashkodo</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/devstack">devstack</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/uandrei">uandrei</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2016/01/Unicorn-3-1-Released/" data-id="ckrl9emy9003r98q70jcl0y37" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Benchmark-Show-Precompilation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2016/01/Benchmark-Show-Precompilation/">The Benchmark Show: Sitecore Precompilation</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2016/01/Benchmark-Show-Precompilation/">
    <time datetime="2016-01-05T04:20:35.000Z" itemprop="datePublished">January 4, 2016</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’m <a href="https://kamsar.net/index.php/2015/02/sitecore-8-experience-editor-performance-optimization/">mildly obsessed with Sitecore performance</a>, so when I found a new trick I had to see what it could do: <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/ms229863.aspx"><code>aspnet_compiler.exe</code></a>. This is a really old tool that was designed to compile your .aspx pages into an assembly - and then later your cshtml as well. This improves startup time because no dynamic compilation needs to take place at runtime.</p>
<p>Getting <code>aspnet_compiler</code> to run against Sitecore, by which I mean executing it against an entire deployment ready web root including both your code and the <code>sitecore</code> folder, is a bit of a challenge. Because you cannot tell <code>aspnet_compiler</code> to ignore anything, and because one of the cshtml files in Sitecore 8.1 Update-1 apparently has a compiler error (for the curious, add <code>@using Sitecore.ListManagement.Client.Web.UI.Controls.ImportMapTo</code> to /sitecore/shell/client/Applications/ListManager/Controls/ContactFields/ContactFields.cshtml). You also have to comment out the <code>@Html.Sitecore()</code>s in /sitecore/shell/Templates/layout.cshtml (don’t worry it’s just a template used when you add a new MVC layout).</p>
<p>Once you get the fixes made, running <code>aspnet_compiler</code> is as simple as:</p>
<p><code>&quot;c:\Windows\Microsoft.NET\Framework\v4.0.30319\aspnet_compiler.exe&quot; -v / -p &quot;c:\path\to\deploy\ready\files&quot; &quot;c:\output\path&quot;</code></p>
<p>It will take a while - probably at least a minute - while it compiles every aspx and cshtml in the whole place into assemblies.</p>
<h2 id="Cool-trick-Does-it-work"><a href="#Cool-trick-Does-it-work" class="headerlink" title="Cool trick. Does it work?"></a>Cool trick. Does it work?</h2><p>Let’s look at some hard data. I took my base Sitecore site (which runs <a target="_blank" rel="noopener" href="https://gist.github.com/kamsar/8c9efc80e72e6ada8304">Performance.config</a>) and executed my deployment scripts over it, then precompiled that to a new folder with <code>aspnet_compiler</code>. Then I devised several tests to tease out both the effects of precompilation and whether Sitecore’s built in SPEAK precompilation has improved since its 8.0 days - where it could make startup take 140 seconds. The tests were in most cases run both with a cold <em>ASP.NET Temporary Files</em> folder (where .NET puts compiled Razor caches) and with a warm one for comparison. Cold would be the first startup on a new machine, whereas warm would be after an app pool recycle thereafter.</p>
<h3 id="Test-1-Home-Page"><a href="#Test-1-Home-Page" class="headerlink" title="Test 1: Home Page"></a>Test 1: Home Page</h3><p>This is a simple test of loading the home page, which is a fairly simple Sitecore MVC layout with about 4 view and controller renderings and several partials. All tests begin with the app pool stopped and no <code>w3wp</code> executing.</p>
<h3 id="Test-2-SPEAK-Media-Library-Dialog"><a href="#Test-2-SPEAK-Media-Library-Dialog" class="headerlink" title="Test 2: SPEAK Media Library Dialog"></a>Test 2: SPEAK Media Library Dialog</h3><p>The SPEAK media browser (what you get when browsing from an image field, for example) has been historically a pain point performance wise. For this test I loaded the dialog iframe URL into a Chrome tab and measured the time to finish page load with the Chrome developer tools.</p>
<h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><h3 id="Home-Page-cold"><a href="#Home-Page-cold" class="headerlink" title="Home Page (cold)"></a>Home Page (cold)</h3><p>Baseline (Performance.config): 22.25s<br>SC Precompiler: 24.8s<br>Precompiled: 21.5s</p>
<p>As expected the precompiled is marginally fastest. Sitecore 8.1’s precompilation function, as we’ll see throughout the tests, seems to add 2-4 seconds to startup time. Without preexisting compiled temp files, startup is extremely slow in all cases - unexpectedly so for the supposedly ‘precompiled’ site. My guess is that it copies the precompiled files to the temp folder, which expends I/O, but that’s a guess.</p>
<h3 id="Home-Page-warm"><a href="#Home-Page-warm" class="headerlink" title="Home Page (warm)"></a>Home Page (warm)</h3><p>Baseline: 9.71s<br>SC Precompiler: 13.97s<br>Precompiled: 9.51s</p>
<p>With the temporary files warm, startup gets much faster. Once again the Sitecore precompiler is in last place.</p>
<h3 id="SPEAK-Media-cold"><a href="#SPEAK-Media-cold" class="headerlink" title="SPEAK Media (cold)"></a>SPEAK Media (cold)</h3><p>Baseline: 29.6s<br>SC Precompiler: 33.8s<br>Precompiled: 22.93s</p>
<p>The effects of precompilation are strong when loading the very complex, partial-heavy SPEAK dialog - coming in 47% faster than the Sitecore default.</p>
<h3 id="SPEAK-Media-warm"><a href="#SPEAK-Media-warm" class="headerlink" title="SPEAK Media (warm)"></a>SPEAK Media (warm)</h3><p>Baseline: 12.2s<br>SC Precompiler: 16s<br>Precompiled: 12.82s<br>SC Precompiler (warmed): 13.23s</p>
<p>Performance is nearly identical once the temporary compiled files are cached the first time for SPEAK. In this case there is also a test for having warmed the Sitecore precompiler and allowed it to finish precompiling in the background, then restarted the cold app pool. </p>
<h2 id="Analysis-TL-DR"><a href="#Analysis-TL-DR" class="headerlink" title="Analysis (TL;DR)"></a>Analysis (TL;DR)</h2><p>Overall the effects of using <code>aspnet_compiler</code> prior to deployment are relatively minor in most real world cases. Initial startup is ideally a rare case, and once their caches are heated all options perform quite similarly (as an example, the second hit to the media dialog is ~250ms to finish). For more elastic deployments, such as cloud setups, or for larger clusters it is probably worth the effort since you burn the CPU cycles once and it does significantly improve first hit to SPEAK dialogs as well as marginal overall performance improvements. Rendering heavy Sitecore MVC implementations would also likely see similar gains to SPEAK. In addition to performance, using the <code>aspnet_compiler</code> validates the C# in your Razor views - which is a nice plus in the event of a Razor syntax error which would normally be discovered at runtime.</p>
<p>The big downside of precompiling is that it’s fairly slow (several minutes on fast hardware, probably much slower otherwise or without SSDs), and that it has to re-copy the whole web root to another output location (lots of I/O). So overall build time on CI may increase significantly.</p>
<h3 id="Another-option-Use-the-Sitecore-precompiler"><a href="#Another-option-Use-the-Sitecore-precompiler" class="headerlink" title="Another option: Use the Sitecore precompiler"></a>Another option: Use the Sitecore precompiler</h3><p>If you look at the results, <em>startup time</em> with the Sitecore precompiler is always a bit longer. But once the Sitecore precompiler completes its asynchronous run - usually within a couple minutes after startup - the results are very close to a natively precompiled site (see the warm media dialog results). This is overall a much simpler option. It does mean every instance has to compile for itself, but it does not require adaptation of the build process nor long times spent copying files.</p>
<p>And here’s the best part: <em>you can use it for your own views, too</em>. It’s just a Razor precompiler pipeline processor, and you can add one - or more - for your sites’ MVC views. For example:</p>
<pre><code>&lt;processor type=&quot;Sitecore.Pipelines.Initialize.PrecompileSpeakViews, Sitecore.Speak.Client&quot;&gt;
    &lt;Paths&gt;/Areas/MySite/Views&lt;/Paths&gt; &lt;!-- virtual path to your views --&gt;
&lt;/processor&gt;
</code></pre>
<p>This will cause your views to all get precompiled asynchronously on startup - if they are not already - which writes their assemblies into the <em>Temporary ASP.NET Files</em> folder. So you trade a couple seconds of startup time, and an initial spike of CPU cycles, for consistent performance thereafter. However, you lose the protection against syntax errors provided by build-time precompilation.</p>
<p>Next time on the benchmark show: Common Sitecore development tasks, benchmarked on a variety of hardware.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2016/01/Benchmark-Show-Precompilation/" data-id="ckrl9emy8003n98q78eu654g6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JavaScript/">JavaScript</a></p>
              <p class="item-title"><a href="/index.php/2021/07/Fun-with-async-generators-and-for-await/" class="title">Fun with async generators and for await</a></p>
              <p class="item-date"><time datetime="2021-07-26T23:30:51.000Z" itemprop="datePublished">July 26, 2021</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/Jamstack/">Jamstack</a></p>
              <p class="item-title"><a href="/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/" class="title">Deploying multiple Netlify sites from one monorepo</a></p>
              <p class="item-date"><time datetime="2020-08-21T03:30:32.000Z" itemprop="datePublished">August 20, 2020</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/" class="title">Running JSS headless mode in containers part 2: Build containers</a></p>
              <p class="item-date"><time datetime="2019-09-16T02:14:04.000Z" itemprop="datePublished">September 15, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/" class="title">Running JSS headless mode in containers, part 1</a></p>
              <p class="item-date"><time datetime="2019-09-08T19:00:36.000Z" itemprop="datePublished">September 8, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/C/">C#</a></p>
              <p class="item-title"><a href="/index.php/2019/05/Build-2019-All-the-things/" class="title">Build 2019: All the things</a></p>
              <p class="item-date"><time datetime="2019-05-10T23:01:11.000Z" itemprop="datePublished">May 10, 2019</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Crypto/">Crypto</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Lucene/">Lucene</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/MVC/">MVC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Search/">Search</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/xDB/">xDB</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>&copy; 2021 Kam Figy</p>
      <p><small>Opinions expressed on this blog are my own, and not necessarily those of my employer.</small></p>
     <p><small>This work is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</small></p>
    </div>
  </div>
</footer>
    


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>