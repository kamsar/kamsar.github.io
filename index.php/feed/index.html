<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kam&#39;s Idea Log</title>
  
  <subtitle>C#, Jamstack, and Shenanigans</subtitle>
  <link href="https://kamsar.net/index.php/feed/index.html" rel="self"/>
  
  <link href="https://kamsar.net/"/>
  <updated>2021-07-27T00:35:41.348Z</updated>
  <id>https://kamsar.net/</id>
  
  <author>
    <name>Kam Figy</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Fun with async generators and for await</title>
    <link href="https://kamsar.net/index.php/2021/07/Fun-with-async-generators-and-for-await/"/>
    <id>https://kamsar.net/index.php/2021/07/Fun-with-async-generators-and-for-await/</id>
    <published>2021-07-26T23:30:51.000Z</published>
    <updated>2021-07-27T00:35:41.348Z</updated>
    
    <content type="html"><![CDATA[<p>Async generators (and their close friend <code>for await</code>) are a really cool feature of modern JavaScript that you can use when a loop requires <em>asynchronous iteration</em>. What the heck is that? Well let’s look at a regular <code>for...of</code> loop:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> el <span class="keyword">of</span> array) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>Nothing weird here, we’re looping over an array and printing each element. An array is a synchronous data structure, so we can loop over it very simply. But what about asynchronous data, like say the <code>fetch</code> API to get data from a HTTP endpoint. A simple implementation of looping over that data is not much more complex:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">&quot;https://whatever.com/api&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (res.ok) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> res.json();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> el <span class="keyword">of</span> data) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(el);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We’re still using <code>for...of</code> and being synchronous in our loop so let’s add one more factor: we’re using an API that uses pagination of some sort, which is pretty much every API ever made since it’s expensive to load giant datasets. A simple pagination-based iteration might look something like this:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = [];</span><br><span class="line"><span class="keyword">const</span> pageSize = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> page = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(</span><br><span class="line">    <span class="string">`https://whatever.com/api?pageSize=<span class="subst">$&#123;pageSize&#125;</span>&amp;page=<span class="subst">$&#123;page&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!res.ok) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Badly written error message&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> res.json();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> el <span class="keyword">of</span> data) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(el);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  page++;</span><br><span class="line">&#125; <span class="keyword">while</span> (data.length === pageSize);</span><br></pre></td></tr></table></figure><p>This is sort of async iteration but it suffers from a major shortcoming: you have to comingle the iteration code and the data fetching in the same loop as each page is ephemeral - or else select all the pages and allocate a monster array before you can deal with the data. Neither of those are great options, so let’s try an <em>async generator</em> function instead. An async generator is a function that returns an <em>async iterable</em> that you can loop over. Like other iterable and enumerable types (such as <code>IEnumerable</code> in C#), async iterables in JS are essentially an object with a <code>next</code> function to get the next thing in the iterable. This has several interesting side effects:</p><ul><li>You cannot have random access to an iterable (it is forward-only)</li><li>Because it is forward only, memory need not be allocated for the entire iterable at the same time so it’s easily possible to have an iterable that has a nearly unlimited of iterations without running out of memory.</li><li>If you stop iterating, the rest of the elements in the iterable are never evaluated. For our pagination example, this means that if we stop reading at page 2, but page 3 exists, we’ll never fetch page 3 from the server.</li></ul><p>For my own sanity I’m going to drop into TypeScript here to illustrate the types that we’re passing around :)</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This paginateAsync function implements generic pagination functionality over an arbitrary API,</span></span><br><span class="line"><span class="comment">// using a passed in fetchPage function to tell it how to fetch a new page of data.</span></span><br><span class="line"><span class="comment">// the * means the function is a generator (which returns an iterator)</span></span><br><span class="line"><span class="comment">// and the async means it&#x27;s an async generator, not a sync generator</span></span><br><span class="line"><span class="comment">// (for C# readers, this is really similar to a method returning IEnumerable and using `yield return`)</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span>* <span class="title">paginateAsync</span>&lt;<span class="title">TResult</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  fetchPage: (offset: <span class="built_in">number</span>, limit: <span class="built_in">number</span>) =&gt; <span class="built_in">Promise</span>&lt;TResult[]&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">  pageSize: <span class="built_in">number</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>): <span class="title">AsyncIterableIterator</span>&lt;<span class="title">TResult</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> offset = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> pageData: TResult[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// fetch one page of data</span></span><br><span class="line">    pageData = <span class="keyword">await</span> fetchPage(offset, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// yield each item in the page (lets the async iterator move through one page of data)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> pageData) &#123;</span><br><span class="line">      <span class="keyword">yield</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// increase the offset by the page count so the next iteration fetches fresh data</span></span><br><span class="line">    offset += pageSize;</span><br><span class="line">  &#125; <span class="keyword">while</span> (pageData.length === pageSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// to use this function, we call it (note the lack of `await`; we&#x27;re starting the iterator but requests don&#x27;t occur until we loop over it)</span></span><br><span class="line"><span class="comment">// then using the resulting iterator we can iterate over it using the `for await` loop:</span></span><br><span class="line"><span class="keyword">const</span> iterator = paginateAsync(</span><br><span class="line">  <span class="function">(<span class="params">offset, limit</span>) =&gt;</span></span><br><span class="line">    fetch(<span class="string">`https://whatever.com/api?limit=<span class="subst">$&#123;limit&#125;</span>&amp;offset=<span class="subst">$&#123;offset&#125;</span>`</span>),</span><br><span class="line">  <span class="number">100</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">const</span> item <span class="keyword">of</span> iterator) &#123;</span><br><span class="line">  <span class="comment">// every time 100 iterations are done here,</span></span><br><span class="line">  <span class="comment">// a new API call will be sent for the next page.</span></span><br><span class="line">  <span class="comment">// this is transparent to your iteration.</span></span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// unlike returning a huge array from a single await,</span></span><br><span class="line">  <span class="comment">// this for await construct only ever has 100 items in memory at a time,</span></span><br><span class="line">  <span class="comment">// so you can tune your batch sizes.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// you can also abort the iteration before it&#x27;s complete</span></span><br><span class="line">  <span class="comment">// for example if I break the loop after 199 items no request</span></span><br><span class="line">  <span class="comment">// for page 3 will ever be made.</span></span><br><span class="line">  <span class="comment">// if(index === 199) break;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So now you can call a paginated API and treat the result as if it were a non-paginated loop. Pretty neat, right? Even better, you can use this in all modern browsers. (IE ain’t modern, folks…)</p><p>Again for my C# readers: this is pretty similar conceptually to C#’s <code>IAsyncEnumerable</code> construct and can be used in similar circumstances.</p><h4 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h4><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of#iterating_over_async_generators">for-await…of @ MDN</a></li><li><a href="https://javascript.info/async-iterators-generators">Async iteration and generators @ javascript.info</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Async generators (and their close friend &lt;code&gt;for await&lt;/code&gt;) are a really cool feature of modern JavaScript that you can use when a l</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://kamsar.net/index.php/category/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>Deploying multiple Netlify sites from one monorepo</title>
    <link href="https://kamsar.net/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/"/>
    <id>https://kamsar.net/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/</id>
    <published>2020-08-21T03:30:32.000Z</published>
    <updated>2021-07-26T23:19:02.518Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.netlify.com/">Netlify</a> is an incredibly easy to use and powerful host for static sites. While this blog is not hosted there, I did <a href="https://hilarious-parrot.netlify.app/">deploy it to Netlify</a>, no joke in less than 5 minutes. With automatic deployment of updates on commit. Check em out.</p><p>Anyhow today I had a monorepo that has more than one site that I wanted to deploy to Netlify. The repo looked something like this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MyRepo</span><br><span class="line">└───sites</span><br><span class="line">    ├───charlie.com</span><br><span class="line">    └───nick.org</span><br></pre></td></tr></table></figure><p>Netlify <a href="https://www.netlify.com/blog/2019/10/09/launching-monorepo-support-for-netlify-sites/">supports this</a> but it’s not super well documented how to accomplish it without a little sleuthing.</p><p>Monorepo support works by setting the <code>Base directory</code> of each site’s configuration to point at the relative path to your site root:</p><img src="/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/gui.png" class=""><p>As it says on the tin, this essentially sets the path to <code>cd</code> to before starting the build commands. (Find it here: <code>https://app.netlify.com/sites/&lt;your-site-name-here&gt;/settings/deploys</code>)</p><p>But there’s one cool thing the description forgets to mention: You can also configure Netlify sites using a <a href="https://docs.netlify.com/configure-builds/file-based-configuration/"><code>netlify.toml</code></a> file, making your configuration versioned in Git. This gets really useful to control the whole build stack from one place: configuring the build commands, redirects, setting up lambda functions. Netlify usually expects <code>netlify.toml</code> in the root of the repository. However, the <em>Base directory</em> setting also changes where the <code>netlify.toml</code> is expected to live. If we do this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MyRepo</span><br><span class="line">└───sites</span><br><span class="line">    ├───charlie.com</span><br><span class="line">    │   └───netlify.toml</span><br><span class="line">    └───nick.org</span><br><span class="line">        └───netlify.toml</span><br></pre></td></tr></table></figure><p>…then we get the lovely capability to both monorepo our sites, and also version our Netlify configuration. Awesome!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.netlify.com/&quot;&gt;Netlify&lt;/a&gt; is an incredibly easy to use and powerful host for static sites. While this blog is not ho</summary>
      
    
    
    
    <category term="Jamstack" scheme="https://kamsar.net/index.php/category/Jamstack/"/>
    
    
  </entry>
  
  <entry>
    <title>Running JSS headless mode in containers part 2: Build containers</title>
    <link href="https://kamsar.net/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/"/>
    <id>https://kamsar.net/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/</id>
    <published>2019-09-16T02:14:04.000Z</published>
    <updated>2021-07-26T23:19:02.517Z</updated>
    
    <content type="html"><![CDATA[<p>In <a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/">part 1</a> of this series, we investigated containerizing the JSS headless mode host. But there are some issues with that basic implementation:</p><ul><li>We still have to pre-compile the JSS app to extract the server bundle, before building the container, and this compile step is not necessarily consistent with the production container environment since it depends on the host environment (different Node versions, OSes, etc are possible)</li><li>The standard <a href="https://hub.docker.com/_/node">Node container</a> is pretty large (900MB), and though there are reasonable reasons for this, something smaller would be nice for production</li><li>Because the API key and Sitecore hostname are baked into the server bundle at build time, it would be necessary to maintain a container image for each environment</li></ul><p>So, let’s fix this by using a <em>build container</em> to create a standardized build environment where we can make our server bundle. Basically, </p><img src="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/dawg.jpg" class=""><h2 id="Build-Containers-101"><a href="#Build-Containers-101" class="headerlink" title="Build Containers 101"></a>Build Containers 101</h2><p>When a <code>Dockerfile</code> executes, the state of each intermediate step is stored so that it need not be repeated every time the image rebuilds. But more importantly, you can also create intermediate <em>build containers</em> that live only long enough to perform a build step, then get thrown away except for some artifacts you want to persist on to some future part of the container build. In the case of our JSS image, the idea is something like this:</p><ul><li>Create a full Node container</li><li>Copy the JSS app into it and run <code>jss build</code></li><li>Create a lightweight Node container</li><li>Deploy the artifacts from the full Node container and the JSS headless app into it</li></ul><p>The build container that we use to build the JSS app in is thrown away after the build occurs, leaving only the lightweight production container with its artifacts. In this case, thanks to switching from <code>node:lts</code> to <code>node:lts-alpine</code> as the base container, the built container size shrunk from 921MB to 93MB.</p><blockquote><p>Note that because the base image is stored as a diff, the image size reduction affects the <em>initial download time</em> of the image on a new host, but once the <code>node:lts</code> image is cached it really only changes the amount of static disk space consumed.</p></blockquote><p>Adding a build container step involves adding a few lines to the top of the <code>Dockerfile</code> from <a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/">part 1</a>:</p><pre><code># Create the build container (note aliasing it as &#39;build&#39; so we can get artifacts later)FROM node:lts as build# Install the JSS CLIRUN npm install -g @sitecore-jss/sitecore-jss-cli# Set a working directory in the container, and copy our app&#39;s source files thereWORKDIR /buildCOPY jss-angular /build# Install the app&#39;s dependenciesRUN npm install# Run the buildRUN npm run build# Now, we need to switch contexts into the final container# lts-alpine is a lightweight Node container, only 90MB# When we switch contexts, the build container is supplanted# as the context containerFROM node:lts-alpine# ...# When we copy the app&#39;s source into the final container# we need to use --from=[tag] to get the files from our build container# instead of the local diskCOPY --from=build /build/dist /jss/dist/$&#123;SITECORE_APP_NAME&#125;</code></pre><h2 id="Tokenizing-the-Server-Bundle"><a href="#Tokenizing-the-Server-Bundle" class="headerlink" title="Tokenizing the Server Bundle"></a>Tokenizing the Server Bundle</h2><p>To solve the issue of the Sitecore API URL and API Key being baked into the server and browser bundles by webpack during <code>jss build</code>, we need to use tokenization. These values really do need to be baked into the file at some point, because the browser that executes them does not understand environment variables on your server or how to replace them - but, we should not need to re-run webpack every time a container starts up either.</p><p>We can work around this by baking specific, well-known tokens into the bundle files and then expanding those tokens when the container starts from environment variable values. The approach works something like this:</p><ul><li>When the build container builds the JSS app, we force it to use specific well-known token values for the API host and API key, such as <code>%sitecoreApiHost%</code></li><li>We move all the build output from the build container from <code>*.js</code> files to <code>*.base</code> files. This means the container itself does not contain any JS in its <code>/dist</code>. This is necessary so the container can generate the final files each time it starts up. (Since the same image can start many times with different environment variables present, it has to ‘rebake’ the JS each time)</li></ul><p>Doing this is a bit harder than just doing the build container. First, during the container build in the <code>Dockerfile</code>:</p><pre><code># Before the build container runs the `build` command,# we need to set specific API key and host values to bake# into the build artifacts to replace later.RUN jss setup --layoutServiceHost %layoutServiceHost% --apiKey 309ec3e9-b911-4a0b-aa8d-425045b6dcbd --nonInteractiveRUN npm run build# After the build container runs the `build` command,# we need to move all the .js files it emitted to .base filesRUN find dist/ -name &#39;*.js&#39; | xargs -I % mv % %.base</code></pre><p>With the updated <code>Dockerfile</code> in place, the container we build will now have <code>.base</code> files ready to specialize into the running configuration when the container starts up. But without any changes to the image itself, it would fail because we can’t run an app using <code>.base</code> files! So we need to add a little script to the <code>node-headless-ssr-proxy</code> to perform this specialization when it starts up inside a container. The specialization process:</p><ul><li>Copy all <code>.base</code> files to <code>.js</code> file of the same name (make a runtime copy to use in the browser)</li><li>Search &amp; replace the well-known tokens in the <code>.js</code> files with the current runtime environment variables</li><li>Start the JSS headless proxy, which will now use the generated <code>.js</code> files and run normally</li></ul><p>I used <code>bootstrap.sh</code> for the script name, but any name is fine.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find dist/ -name <span class="string">&#x27;*.base&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> filename; <span class="keyword">do</span> <span class="built_in">export</span> jsname=$(<span class="built_in">echo</span> <span class="variable">$filename</span> | sed -e <span class="string">&#x27;s|.base||&#x27;</span>); cp <span class="variable">$filename</span> <span class="variable">$jsname</span>; sed -i -e <span class="string">&quot;s|%layoutServiceHost%|<span class="variable">$SITECORE_API_HOST</span>|g&quot;</span> -e <span class="string">&quot;s|309ec3e9-b911-4a0b-aa8d-425045b6dcbd|<span class="variable">$SITECORE_API_KEY</span>|g&quot;</span> <span class="variable">$jsname</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>This script is a rather hard to read one-liner so let’s piece it out to understand it:</p><ul><li><code>find dist/ -name &#39;*.base&#39; | while read filename</code> - Finds <code>*.base</code> files anywhere under <code>dist</code>, and reads each found filename into <code>$filename</code> in a loop body</li><li><code>do export jsname=$(echo $filename | sed -e &#39;s|.base||&#39;)</code> - Sets <code>$jsname</code> to the name of the found file, with the extension changed from <code>.base</code> to <code>.js</code></li><li><code>cp $filename $jsname</code> - copies the <code>.base</code> file to the equivalent path, but using the <code>.js</code> extension instead</li><li><code>sed -i -e &quot;s|%layoutServiceHost%|$SITECORE_API_HOST|g&quot; -e &quot;s|309ec3e9-b911-4a0b-aa8d-425045b6dcbd|$SITECORE_API_KEY|g&quot; $jsname</code> - uses <code>sed</code> to perform a regex replace on the known values we baked into the base file, replacing them with the environment variables (<code>$SITECORE_API_HOST</code> and <code>$SITECORE_API_KEY</code>) that form the current runtime configuration for those values</li></ul><p>Finally we need to get this script to run each time the container starts up. There are several ways we could do this, but I elected to add an npm script to the headless proxy’s <code>package.json</code>:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;node index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;docker&quot;</span>: <span class="string">&quot;./bootstrap.sh &amp;&amp; node index.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>…and then changed the entry point in the <code>Dockerfile</code> to call the container entrypoint:</p><pre><code>ENTRYPOINT npm run docker</code></pre><p>The final step is to rebuild the container image so we can start it up, using <code>docker build</code>.</p><h3 id="Using-the-tokenized-container"><a href="#Using-the-tokenized-container" class="headerlink" title="Using the tokenized container"></a>Using the tokenized container</h3><p>The headless proxy Node app has always known how to read environment variables for the Sitecore API host and API key, but those have only applied to the <strong>SSR</strong> execution not the browser-side execution. With the modifications we’ve made, setting those same environment variables will now also apply to the browser. Doing this with Docker is quite trivial when booting the container, for example:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3000:3000 --env SITECORE_API_KEY=[yourkey] --env SITECORE_API_HOST=http://your.site.core [container-image-name]</span><br></pre></td></tr></table></figure><h2 id="Putting-it-together"><a href="#Putting-it-together" class="headerlink" title="Putting it together"></a>Putting it together</h2><p>For more clarity, here’s the full contents of the <code>Dockerfile</code> with all these changes made:</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:lts as build</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install -g @sitecore-jss/sitecore-jss-cli</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /build</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> jss-angular /build</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br><span class="line"><span class="comment"># setup to use static values we&#x27;ll later replace with env vars</span></span><br><span class="line"><span class="comment"># (for values that are baked into the server bundle)</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> jss setup --layoutServiceHost %layoutServiceHost% --apiKey 309ec3e9-b911-4a0b-aa8d-425045b6dcbd --nonInteractive</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm run build</span></span><br><span class="line"><span class="comment"># Rename all .js files to .js.base (so we can bootstrap tokens later)</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> find dist/ -name <span class="string">&#x27;*.js&#x27;</span> | xargs -I % mv % %.base</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:lts-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> SITECORE_API_HOST=http://host.docker.internal</span><br><span class="line"><span class="keyword">ENV</span> SITECORE_API_KEY=MYKEY</span><br><span class="line"><span class="keyword">ENV</span> SITECORE_APP_NAME=jss-angular</span><br><span class="line"><span class="keyword">ENV</span> SITECORE_JSS_SERVER_BUNDLE=./dist/$&#123;SITECORE_APP_NAME&#125;/server.bundle.js</span><br><span class="line"><span class="keyword">ENV</span> SITECORE_ENABLE_DEBUG=false</span><br><span class="line"><span class="keyword">ENV</span> PORT=<span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /jss</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./node-headless-ssr-proxy /jss</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=build /build/dist /jss/dist/<span class="variable">$&#123;SITECORE_APP_NAME&#125;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> npm run docker</span></span><br><span class="line"><span class="keyword">EXPOSE</span> $&#123;PORT&#125;</span><br></pre></td></tr></table></figure><p>In this episode, we have improved the JSS headless container build process by running all of the build inside containers for improved repeatability and tokenized the browser JS bundles so that the same container can be deployed to many environments with different API hosts without needing a rebuild. What’s next? Orchestrating multiple instances with Kubernetes.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;In &lt;a href=&quot;/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/&quot;&gt;part 1&lt;/a&gt; of this series, we investigated containerizing</summary>
      
    
    
    
    <category term="JSS" scheme="https://kamsar.net/index.php/category/JSS/"/>
    
    
  </entry>
  
  <entry>
    <title>Running JSS headless mode in containers, part 1</title>
    <link href="https://kamsar.net/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/"/>
    <id>https://kamsar.net/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/</id>
    <published>2019-09-08T19:00:36.000Z</published>
    <updated>2021-07-26T23:19:02.516Z</updated>
    
    <content type="html"><![CDATA[<p>I’ve been playing with containers lately and as an experiment, containerized <a href="https://jss.sitecore.com/docs/fundamentals/application-modes#headless-server-side-rendering-mode">JSS Headless Mode</a>. Since I had fun doing this, I figured I’d share what I learned. Note that this is my own explorations, and should not be construed as any official statement of container support for JSS, nor is it supported via official Sitecore channels.</p><h2 id="Containers-101-What’s-a-container"><a href="#Containers-101-What’s-a-container" class="headerlink" title="Containers 101: What’s a container?"></a>Containers 101: What’s a container?</h2><p>The best way to understand containers quickly is, of course, a meme.</p><img src="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/works.png" class="if it works on your machine, then ship your machine"><p>Another way to think of a container is a lightweight virtual machine. Unlike a VM, a container <em>shares</em> much of its system with the host OS or node. This means that containers:</p><ol><li>Are much smaller both in disk and memory usage compared to a VM</li><li>Do not provide as strong of an isolation from the host as a VM</li><li>Are more easily <em>based on</em> a standard distribution. For example in this post we won’t be building a container from scratch; we will take the standard <code>node</code> container and deploy JSS to it - thus, we offload the maintenance of the base container to the Node maintainers, and we take on the maintenance of only our app.</li></ol><p>Containers have become incredibly popular as a way to build and deploy applications because of their consistency and low resource usage. Especially as more applications take on more server-based dependencies (i.e. microservice architectures, or even a traditional app that may need a database, search service, etc), containers provide a reasonable way to replicate such a complex IT infrastructure on a developer machine in the same way that it runs in production - without each developer needing to have a 1TB RAM, 28-core server to run all those virtual machines.</p><p>So with that in mind, what if we wanted to containerize Sitecore JSS’ headless mode host?</p><blockquote><p>Note: we’re only containerizing the JSS SSR host in this post; the rest of the Sitecore infrastrucure would still need to be deployed traditionally.</p></blockquote><h2 id="Creating-a-JSS-Docker-container"><a href="#Creating-a-JSS-Docker-container" class="headerlink" title="Creating a JSS Docker container"></a>Creating a JSS Docker container</h2><p>If you’re planning to follow along at home with this build, note that you’ll need to install <a href="https://hub.docker.com/?overlay=onboarding">Docker Desktop</a> in order to be able to locally build and run the containers. You may also need to enable virtualization in your UEFI, if it’s off, or potentially for Windows also enable Hyper-V and Containers features at an OS level. Consult the Docker docs for help with that :)</p><p>When you create a container, there are three main tasks:</p><h3 id="Determine-the-base-container-to-build-from"><a href="#Determine-the-base-container-to-build-from" class="headerlink" title="Determine the base container to build from"></a>Determine the base container to build from</h3><p>Containers are built on top of other containers in an efficient and lightweight way. This means that for example, your container might start with a Windows Server container, or an Ubuntu container…or it might start from a Node container, that was based on an Debian container. You get the idea - containers, like ogres or ‘90s software architecture, have layers. Each layer is built as a diff from the underlying layer. When you make a container, you’re adding a layer.</p><p>In our case, JSS headless SSR is a Node-based application, so we will choose the <a href="https://hub.docker.com/_/node">Node container</a> as our base.</p><h3 id="Define-the-Dockerfile"><a href="#Define-the-Dockerfile" class="headerlink" title="Define the Dockerfile"></a>Define the <code>Dockerfile</code></h3><p>The <a href="https://docs.docker.com/engine/reference/builder/">dockerfile</a> is a file named <code>Dockerfile</code> that defines how to create your container. It defines things like:</p><ul><li>What your base container is (<code>FROM node:lts</code>)</li><li>How to modify the base container to turn it into your container (scripts and file copying)</li><li>Defaults, like which TCP/UDP ports the container can expose</li></ul><p>In our case we want to start from the <a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/"><code>node</code> container</a>:</p><pre><code>FROM node:lts</code></pre><p>Then we want to tell Docker how to deploy our JSS app on top of the Node container. We do this by telling it which files we want to copy into the container image and where to put them, as well as any commands that need to be run to complete the setup:</p><pre><code># We want to place our app at /jss on the container filesystem# (this is a fairly arbitrary choice; # use something app-specific and don&#39;t use &#39;/&#39;)# Subsequent commands and copies are relative to this directory.WORKDIR /jss# Specify the _local_ files to copy into the container;# in this case a copy of the headless SSR proxy: https://github.com/Sitecore/jss/tree/dev/samples/node-headless-ssr-proxyCOPY ./node-headless-ssr-proxy /jss# Run shell commands _inside the container_ to set up the app;# in this case, to install npm packages for the headless Node app.# NOTE: the container is built on the Docker server, not locally!# Commands you run here run inside the container, and thus # cannot for example reference local file paths!RUN npm install# To run JSS in headless mode, we also need to deploy # the JSS app&#39;s server build artifacts into the container# for the headless mode proxy to execute. This is another copy.COPY my-jss-app-name/dist /jss/dist/my-jss-app-name# When the container starts, we have to make it do something# aside from start - in this case, start the JSS app.# The command is run in the context of the WORKDIR we set earlier.ENTRYPOINT npm run start# The JSS headless proxy is configured using environment variables,# which allow us to configure it at runtime. In this case,# we need to configure the port, app bundle, etcENV SITECORE_APP_NAME=my-jss-app-name# Relative to /jss path to the server bundle built by the JSS app build# Note: this path should be identical to the path deployed for integrated# mode, so that path references work correctly.ENV SITECORE_JSS_SERVER_BUNDLE=./dist/$&#123;SITECORE_APP_NAME&#125;/server.bundle.js# Hostname of the Sitecore instance to retrieve layout data from.# host.docker.internal == DNS name of the docker host machine, # i.e. to hit non-container localhost Sitecore dev instanceENV SITECORE_API_HOST=http://host.docker.internalENV SITECORE_API_KEY=GUID-VALUE-HERE# Enable or disable debug console output (dont use in prod)ENV SITECORE_ENABLE_DEBUG=false# Set the _local_ port to run JSS on, within the container# (this does not expose it publicly)ENV PORT=3000# Tell Docker that we expose a port, but this is for documentation;# the port must be mapped when we start the container to be exposed.EXPOSE $&#123;PORT&#125;</code></pre><h3 id="Build-the-container"><a href="#Build-the-container" class="headerlink" title="Build the container"></a>Build the container</h3><p>Once we have defined the steps necessary to create the container image, we need to <em>build</em> the container. Building the container:</p><ul><li>Collects all the files in the <code>Dockerfile</code> directory and uploads them to the Docker host (unless listed in a <code>.dockerignore</code> file)</li><li>Acquires the base image, if it’s not already on the Docker host</li><li>Creates a container based on the base image and starts it</li><li>Executes your <code>Dockerfile</code> script within the container to configure it</li><li>Captures your Docker image and stores it for reuse</li></ul><blockquote><p>The <code>Dockerfile</code> does not execute locally, so make sure you don’t make that assumption when using <code>EXEC</code> directives; execution also occurs within the container being built, so it occurs in the context of the container (in this case, Debian) and the dependencies that are part of the container.</p></blockquote><p>To build your JSS container, within the same folder as your <code>Dockerfile</code> run:</p><pre><code>docker build -t your-image-name .</code></pre><p>Once the build is done, you can find your image on Docker using:</p><pre><code>docker images</code></pre><h2 id="Using-the-JSS-Docker-container"><a href="#Using-the-JSS-Docker-container" class="headerlink" title="Using the JSS Docker container"></a>Using the JSS Docker container</h2><p>Up to this point we have collected and built the container, but nothing has been run. To create a new instance of your container and start it up, run</p><pre><code>docker run -p 3000:3000 --name &lt;pick-a-name-for-container-instance&gt; &lt;imagename&gt;</code></pre><p>The <code>-p</code> maps your localhost port 3000 to the container port 3000 (which we specified the Node host to run on previously using an environment variable).</p><p>Once you start the container, visiting <code>http://localhost:3000</code> should run the app in the JSS headless host container. </p><h3 id="Container-Debugging-Tips"><a href="#Container-Debugging-Tips" class="headerlink" title="Container Debugging Tips"></a>Container Debugging Tips</h3><ul><li>Viewing running containers - list running containers using the <code>docker ps</code> command. If a container was started without an explicit <code>--name</code>, this can help find it.</li><li>Opening a shell in a container - to run diagnostic shell commands, you can open a root shell to a running container. The <code>docker exec</code> command lets you run commands, including starting a shell - for example, <code>docker exec -it &lt;container-name&gt; bash</code>. The <code>-it</code> says you want an interactive TTY (in other words an ongoing shell, not a one-off command execution and exit)</li></ul><h2 id="What’s-Next"><a href="#What’s-Next" class="headerlink" title="What’s Next?"></a>What’s Next?</h2><p>In this post, we’ve created and run a Docker container of the JSS headless mode. This works great for a single container, but for production scenarios we would likely need to orchestrate <em>multiple</em> instances of the container to handle heavy load and provide redundancy. Next time, we will improve our container build script using a build container, then finally the series will end with orchestrating the container using Kubernetes.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;I’ve been playing with containers lately and as an experiment, containerized &lt;a href=&quot;https://jss.sitecore.com/docs/fundamentals/applicat</summary>
      
    
    
    
    <category term="JSS" scheme="https://kamsar.net/index.php/category/JSS/"/>
    
    
  </entry>
  
  <entry>
    <title>Build 2019: All the things</title>
    <link href="https://kamsar.net/index.php/2019/05/Build-2019-All-the-things/"/>
    <id>https://kamsar.net/index.php/2019/05/Build-2019-All-the-things/</id>
    <published>2019-05-10T23:01:11.000Z</published>
    <updated>2021-07-26T23:19:02.515Z</updated>
    
    <content type="html"><![CDATA[<p>I spent the first part of this week out at <a href="https://www.microsoft.com/en-us/build">Build 2019</a>, and I learned a lot! Here’s all the news I saw fit to print from Build in a concise, notesy format.</p><h2 id="NET-Core-3"><a href="#NET-Core-3" class="headerlink" title=".NET Core 3"></a>.NET Core 3</h2><p>The next version of .NET Core will be released in September 2019. It will feature a raft of improvements, notably WPF/desktop app support (Windows only), .NET Standard 2.1 (<em>not going to be supported by .NET 4.x ever</em>), and C# 8 (<em>.NET Standard 2.1 required</em>).</p><p>Coinciding with the release of .NET Core 3 will be <a href="https://www.dotnetconf.net/">dotnetconf</a> from September 23-25, a virtual conference highlighting .NET Core 3.</p><p>.NET Core 3.1, the long term support version, is slated to ship in November.</p><h2 id="NET-5-and-the-Unified-BCL"><a href="#NET-5-and-the-Unified-BCL" class="headerlink" title=".NET 5 and the Unified BCL"></a>.NET 5 and the Unified BCL</h2><p>After .NET Core 3 ships, .NET Core is dead. Instead .NET 5 will ship, and it will unify the abstraction of .NET Standard into a universal BCL that can run on any .NET 5 compatible runtime (i.e. Xamarin, Mono, Windows .NET). It will also gain Java and Swift interop capabilities (from Mono/Xamarin) on all platforms. The idea is that .NET 5 will be a singular platform that runs anywhere from mobile devices, to IoT/Raspberry Pi, to desktop apps, to cloud server(less).</p><p>Web Forms and WCF will never be ported to .NET Core/.NET 5. Specifically for Web Forms, Blazor will be the recommended migration path.</p><p>Following .NET 5, the .NET platform will have yearly releases (.NET 6, 7, 8, …). Alternating years will be LTS versions, in other words 2020’s .NET 5 will be supplanted by the LTS .NET 6 in 2021.</p><p><a href="https://devblogs.microsoft.com/dotnet/introducing-net-5/">More on .NET 5 here</a></p><h2 id="C-8"><a href="#C-8" class="headerlink" title="C# 8"></a>C# 8</h2><p><em>Note: C# 8 requires compiler changes that need .NET Standard 2.1+. In other words, C# 8 can only be used with .NET Core 3 and later as a consumer!</em></p><p>The main focus of C# 8 is “robustness.” There are a number of new features that support this goal:</p><h4 id="Async-Enumerable"><a href="#Async-Enumerable" class="headerlink" title="Async Enumerable"></a>Async Enumerable</h4><p>Ever since async/await was shipped in C#, it’s been problematic to use it with enumerables because you must await either <code>Task&lt;IEnumerable&lt;T&gt;&gt;</code> (thus awaiting the WHOLE enumerable, which loses its lazy enumeration advantages), or <code>IEnumerable&lt;Task&lt;T&gt;&gt;</code> which potentially requires awaiting in a loop, which is also suboptimal. It also prevents the use of <code>yield return</code> in async methods, which makes them significantly less pretty.</p><p>In C# 8, this is fixed by introducing <code>IAsyncEnumerable&lt;T&gt;</code>, an asynchronously enumerable enumerable type. This type is enumerated using <code>await foreach</code>, i.e. <code>await foreach(var t in asyncEnumerable) &#123; /* where t is not a task */ &#125;</code>. The implementation of <code>IAsyncEnumerable</code> is simply allowed to <code>yield return</code> values, giving the enumerator control over its own internal asynchrony needs, batching, etc.</p><h4 id="Nullable-Reference-Types"><a href="#Nullable-Reference-Types" class="headerlink" title="Nullable Reference Types"></a>Nullable Reference Types</h4><p>The <code>NullReferenceException</code> is everyone’s favorite C# bugbear, and solutions good and bad abound for asserting that method arguments are not null to avoid throwing them (my favorite is <code>var x = arg ?? throw new ArgumentNullException(nameof(arg));</code>). In C# 8, you can explicitly declare reference types as nullable, explicitly stating that a method can return - or accept - a null value. Doing this allows the compiler to remove the need for all those assertions, as it can warn you at compile time if you’re not checking a nullable type for null before using it. This is an opt-in feature either with <code>#nullable enable</code> in a file, or it can be turned on per-project.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Item? GetItem() &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void DoStuff() &#123;</span><br><span class="line">    // with nullable reference types on, this will throw a compiler warning</span><br><span class="line">    // because GetItem declared explicitly that it can return null</span><br><span class="line">    var troll = GetItem().Axes.GetDescendants();</span><br><span class="line"></span><br><span class="line">    // you can bypass the warning if you know what you&#x27;re doing (lol) with !</span><br><span class="line">    var explodingTroll = GetItem()!.Axes.GetDescendants();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Range-Expressions"><a href="#Range-Expressions" class="headerlink" title="Range Expressions"></a>Range Expressions</h4><p>A common need is to parse a string or array and split it up into pieces by index; for example “this string’s last two characters” or “the first 5 elements in this array.” This sort of code is quite vulnerable to naughty data input causing exceptions, for example <code>&quot;a&quot;.Substring(5)</code> will throw because it isn’t 5 characters long.</p><p>C# 8 range expressions allow you to concisely and safely (they won’t throw if the array is shorter than the slice) express this sort of problem. They work using <code>^</code> to anchor the range to “length - x” or “start + x”, a spread, and an optional endpoint. A few examples:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var str = &quot;hello world&quot;;</span><br><span class="line">var a = str[0..5]; // &#x27;hello&#x27;</span><br><span class="line">var b = str[^1]; // &#x27;d&#x27;</span><br><span class="line">var c = str[^1..^4]; // &#x27;ello w&#x27;</span><br></pre></td></tr></table></figure><h4 id="Switch-Expressions"><a href="#Switch-Expressions" class="headerlink" title="Switch Expressions"></a>Switch Expressions</h4><p>The <code>switch</code> statement receives an upgrade in C# 8 with the ability to assign it directly to a variable, eliminating the need for clumsy <code>break</code> statements in every case. It’s also possible to use pattern matching with this format (not pictured).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var result = &quot;hello&quot; switch &#123;</span><br><span class="line">&quot;hello&quot; =&gt; true,</span><br><span class="line">&quot;goodbye&quot; =&gt; false,</span><br><span class="line">_ =&gt; false // default case via a discard</span><br><span class="line">&#125;;</span><br><span class="line">// result = true</span><br></pre></td></tr></table></figure><h4 id="Default-Interface-Implementations"><a href="#Default-Interface-Implementations" class="headerlink" title="Default Interface Implementations"></a>Default Interface Implementations</h4><p>Interfaces can have default implementations for members. This is not intended to kill IoC containers as much as be a tool for API creators to ship additions to public interfaces without breaking existing consumers of that interface. The additional members need only be optionally implemented by downstream consumers, with the defaults used if not overridden.</p><h4 id="Using-Declarations"><a href="#Using-Declarations" class="headerlink" title="Using Declarations"></a>Using Declarations</h4><p>The <code>using</code> statement gets an overhaul to avoid needing a block scope. A using statement is used to prevent forgetting to dispose <code>IDisposable</code> resources, but before C# 8 it required a block scope of its own which especially in nested usings made things hard to read. In C# 8, you can define a variable with the <code>using</code> keyword and no block scope, and it is implicitly disposed at the end of the current block scope. For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void Foo() &#123;</span><br><span class="line">    using var file = new FileStream(@&quot;c:\foo.txt&quot;);</span><br><span class="line">    // file will be disposed when the Foo() block exits</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8">More on C# 8 here</a></p><h2 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h2><p>In TypeScript 3.4 - currently RC - you can enable <em>incremental builds</em> (via tsconfig, or <code>--incremental</code> to the CLI), which allows TS to cache the output of the last build/watch run and essentially ‘rehydrate’ it during the next build to avoid rebuilding unchanged modules. The upshot of this on the VS Code codebase is that warm build times went from <strong>47 seconds</strong> to <strong>11 seconds</strong>.</p><p>On larger TypeScript codebases, using <a href="https://www.typescriptlang.org/docs/handbook/project-references.html">project references</a> can allow TypeScript to partition compilation units, enabling it to only rebuild changed units in the dependency tree (about like projects and solutions in Visual Studio). This can be used to avoid needing to recompile an entire TypeScript project every time even without incremental builds.</p><p>New modernized TypeScript documentation, with content oriented around current TypeScript practices and improved clarity, is in process. Current target is late 2019 to release the new docs.</p><p><a href="https://devblogs.microsoft.com/typescript/announcing-typescript-3-4-rc/">More on TypeScript 3.4 here</a></p><h2 id="Live-Share"><a href="#Live-Share" class="headerlink" title="Live Share"></a>Live Share</h2><p>Using Live Share developers can collaborate effectively while remote, with either Visual Studio, VS Code, or both. It’s a bit like a code-specific combination of screen sharing and collaborative editing. This includes things like:</p><ul><li>Editing code in a Google Docs-like collaborative realtime editor</li><li>Setting breakpoints, controlling debugger execution that executes on the host’s computer</li><li>Reviewing the other dev’s localhost ports</li><li>VS Code can live share with Visual Studio</li><li>The viewer need not have a SDK, debugger, or plugins for the host’s code to participate - or even the same CPU architecture.</li><li>Works across platforms too, so you could connect using Code on a Mac to VS on Windows and control debugging a windows service, for example.</li></ul><p><a href="https://visualstudio.microsoft.com/services/live-share/">More on Live Share here</a></p><h2 id="Visual-Studio-Code-Remote-Editing"><a href="#Visual-Studio-Code-Remote-Editing" class="headerlink" title="Visual Studio Code Remote Editing"></a>Visual Studio Code Remote Editing</h2><p>Code can now connect to a remote system (via SSH or directly to a container) and edit the remote instance as if it were local files. This includes things like installing Code plugins <em>on the remote environment</em> - it’s basically connecting to a “headless” VS Code service. For example, you could write Ruby code on a Docker container in AKS from a windows machine running Code…without needing to set up a Ruby dev environment locally or install any Ruby plugins into Code. Or, do .NET Core dev on a remote VM without needing to install the .NET Core SDK locally.</p><p>Remote editing really shines when combined with Azure Dev Spaces (read on…).</p><p><a href="https://code.visualstudio.com/docs/remote/remote-overview">More on remote editing here</a></p><h2 id="Visual-Studio-Online-not-to-be-confused-with-the-old-name-for-Azure-DevOps"><a href="#Visual-Studio-Online-not-to-be-confused-with-the-old-name-for-Azure-DevOps" class="headerlink" title="Visual Studio Online (not to be confused with the old name for Azure DevOps)"></a>Visual Studio Online (not to be confused with the old name for Azure DevOps)</h2><ul><li>Visual Studio Code in a browser</li><li>Edit code, review PRs, connect to remote development environments (SSH, Containers)</li><li>Works on any browser. Want to review PRs on an iPad? Sure!</li><li>In private preview at the moment</li></ul><p><a href="https://devblogs.microsoft.com/visualstudio/intelligent-productivity-and-collaboration-from-anywhere/">More on VSO here</a></p><h2 id="VS-Code-and-VS-Tips"><a href="#VS-Code-and-VS-Tips" class="headerlink" title="VS Code and VS Tips"></a>VS Code and VS Tips</h2><ul><li>There were excellent sessions on getting more out of Visual Studio and VS Code. If you want to learn something about your tools, these were pretty great. For example:</li><li>You can configure Code to attach multiple debuggers at launch (i.e. Chrome + Node debuggers)</li><li>F1 opens the Code palette, in addition to Ctrl-P</li><li>You can quickly open files in Code from the command palette by removing the &gt; prompt and typing a filename or expression</li><li>Jump to outlined functions, tags, etc the current file, in Code, by entering <code>@:</code> in the command palette (i.e. <code>@:myfunc</code>)</li><li>IntelliCode (available in Code and VS 16.1+) applies ML models to predict the most commonly used code completions for a given state. For example <code>if(arrayVar.</code> might suggest <code>Length</code> but <code>stringVar.</code> might suggest <code>Split</code>. The suggestions model was trained on 2000 of the most popular open source codebases on GitHub, so they’re based on actual community practices.</li><li>Visual Studio is aggressively rendering R# irrelevant in current previews. You really might not need it at all in the future. Tons of new refactorings, code cleanup improvements, ability to infer .editorconfig files, et al.</li></ul><p><a href="https://mybuild.techcommunity.microsoft.com/sessions/77039">Code tips session</a><br><a href="https://mybuild.techcommunity.microsoft.com/sessions/77044">Visual Studio tips session</a><br><a href="https://mybuild.techcommunity.microsoft.com/sessions/77042">Visual Studio debugger/diags tips</a></p><h2 id="Azure-Dev-Spaces"><a href="#Azure-Dev-Spaces" class="headerlink" title="Azure Dev Spaces"></a>Azure Dev Spaces</h2><p>It’s no secret that microservice architectures can be pretty difficult to develop locally. Especially if they tend towards the distributed monolith antipattern ;) Well, Azure decided to do something about that. Probably the coolest demo of the whole event.</p><p>Dev Spaces is a prebuilt microservice-oriented workflow for developers based on Azure Kubernetes Service (AKS). The basic concept is that a dev team would share an AKS cluster across their whole team - because developers would probably be working on a few microservices, not the whole galaxy of the system, they can then basically “branch” specific microservices out for personal development, while referencing the rest of the system built from the latest CI build. In other words, there’s no need to mock or setup local microservices that you don’t care about, because yours runs in AKS and refers to the master build.</p><p>Even more bonkers, you can use remote development to debug and auto-deploy files to your personal microservices running in AKS. Pull requests can be made to similarly build in their own namespace, giving faster and more efficient use of build time. Seems like a pretty darn nice experience, with most of the orchestration issues no longer your problem.</p><p><a href="https://mybuild.techcommunity.microsoft.com/sessions/77060">Watch the session</a><br><a href="https://docs.microsoft.com/en-us/azure/dev-spaces">Documentation on Dev Spaces</a></p><h2 id="YAML-Builds-amp-Releases-for-Azure-DevOps-Pipelines"><a href="#YAML-Builds-amp-Releases-for-Azure-DevOps-Pipelines" class="headerlink" title="YAML Builds &amp; Releases for Azure DevOps Pipelines"></a>YAML Builds &amp; Releases for Azure DevOps Pipelines</h2><p>You can define your Azure DevOps build and release pipelines using YAML files that can be committed to the repository. This allows the build system to be versioned and stable across branches and enables proper testing of changes to the build via PRs. In preview now, release pipelines (in addition to builds) can be defined in YAML. There is also a visual editor that allows generation of YAML for common tasks using a GUI.</p><p>Coming soon, pipelines will be able to automatically generate a Kubernetes manifest and Helm chart for any project with a Dockerfile. This will also generate appropriate build YAML to allow building docker images, deploying them to Azure Container Registry, and spinning up the Kubernetes cluster from those images on Azure Kubernetes Service. Looks really easy to use, and a definite lowering of the barrier to entry to Kubernetes deployment. The pipeline doesn’t only support Azure k8s either; it can deploy to other container registries or k8s clusters on premise or in other clouds.</p><h2 id="Azure-Cognitive-Search"><a href="#Azure-Cognitive-Search" class="headerlink" title="Azure Cognitive Search"></a>Azure Cognitive Search</h2><p>Azure search is gaining the ability to apply cognitive services to data being indexed; for example it can index the contents of images as detected by cognitive services, etc. Also the 1000-field limit that Sitecore users love is being investigated and may be raised or eliminated in a near term time frame.</p><h2 id="ML-NET-1-0-amp-AutoML"><a href="#ML-NET-1-0-amp-AutoML" class="headerlink" title="ML.NET 1.0 &amp; AutoML"></a>ML.NET 1.0 &amp; AutoML</h2><p>A library to build and run machine learning models from within .NET. Can consume several trained model formats, including TensorFlow, which lets you integrate ML models built by a data scientist using Python et al into .NET runtimes. Microsoft is also working on the <a href="https://onnx.ai/">ONNX</a> model format for interoperable models. While it’s capable of training its own models too, it is interesting to see the model promoted where data scientists do their modeling using mainstream ML tools (i.e. Python), and deploy only the trained model to the .NET application. Promising in terms of integrating .NET with mainstream data scientists.</p><p>The AutoML toolkit was also announced. AutoML is a nice looking tool for non-data-scientists to take a dataset and automatically discover a good ML algorithm and hyperparameter set to produce an accurate model. Definitely aimed at the backend developer looking to add a splash of ML to their toolset, as opposed to data scientists, but this seems like it could significantly lower the barrier to ML entry for .NET developers.</p><p><a href="https://dotnet.microsoft.com/apps/machinelearning-ai/ml-dotnet#automl">More on ML.NET and AutoML here</a></p><p>Go forth and code, me hearties.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;I spent the first part of this week out at &lt;a href=&quot;https://www.microsoft.com/en-us/build&quot;&gt;Build 2019&lt;/a&gt;, and I learned a lot! Here’s al</summary>
      
    
    
    
    <category term="C#" scheme="https://kamsar.net/index.php/category/C/"/>
    
    
  </entry>
  
  <entry>
    <title>Routing Sitecore links with JSS</title>
    <link href="https://kamsar.net/index.php/2018/09/Routing-Sitecore-links-with-JSS/"/>
    <id>https://kamsar.net/index.php/2018/09/Routing-Sitecore-links-with-JSS/</id>
    <published>2018-09-12T18:59:43.000Z</published>
    <updated>2021-07-26T23:19:02.515Z</updated>
    
    <content type="html"><![CDATA[<p>When building a single-page app with <a href="https://jss.sitecore.net/">Sitecore JSS</a> and defining internal links in Sitecore content, you may notice that clicking the link in the JSS app does not act like a <em>single</em> page app. Instead the link click causes a full page refresh to occur, because the routing library used by the app is not aware that the link emitted by JSS can be treated as a route link.</p><p>Maybe you don’t want that to happen, because you like the fluidity of single-page apps or want to reduce bandwidth. Excellent! You’ve come to the right place.</p><p>The following examples use React, but the same architectural principles will translate well to Vue or Angular apps and the JSS field data schema is identical.</p><p>There are two places where we can receive links back from Sitecore:</p><h2 id="Link-Fields"><a href="#Link-Fields" class="headerlink" title="Link Fields"></a>Link Fields</h2><p>Sitecore supports content fields that are explicitly hyperlinks (usually <em>General Link</em> fields, also referred to as <code>CommonFieldTypes.GeneralLink</code> in JSS disconnected data). When returned these fields contain link data (a <code>href</code>, optionally body text, CSS class, target, etc). In JSS apps, these are rendered using the <code>Link</code> component like so:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&#x27;@sitecore-jss/sitecore-jss-react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyJSSComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">field</span>=<span class="string">&#123;props.fields.externalLink&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>This gives us normal anchor tag output in the DOM:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/path&quot;</span>&gt;</span>Link Text<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>But in <code>react-router</code>, a link needs to be rendered using <code>react-router-dom</code>‘s <code>Link</code> component instead, for example:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RouterLinkComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/path&quot;</span>&gt;</span>Link Text<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>To make JSS general links render using <code>react-router</code> links for internal links, we can create a component that conditionally chooses the link component like this:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">&#x27;@sitecore-jss/sitecore-jss-react&#x27;</span>;</span><br><span class="line"><span class="comment">// note we&#x27;re aliasing the router&#x27;s link component name, since it conflicts with JSS&#x27; link component</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link <span class="keyword">as</span> RouterLink &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** React component that turns Sitecore link values that start with / into react-router route links */</span></span><br><span class="line"><span class="keyword">const</span> RoutableSitecoreLink = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> hasValidHref = props.field &amp;&amp; props.field.value &amp;&amp; props.field.value.href;</span><br><span class="line">  <span class="keyword">const</span> isEditing = props.editable &amp;&amp; props.field.editable;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// only want to apply the routing link if not editing (if editing, need to render editable link value)</span></span><br><span class="line">  <span class="keyword">if</span>(hasValidHref &amp;&amp; !isEditing) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = props.field.value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// determine if a link is a route or not. This logic may not be appropriate for all usages.</span></span><br><span class="line">    <span class="keyword">if</span>(value.href.startsWith(<span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&#123;value.href&#125;</span> <span class="attr">title</span>=<span class="string">&#123;value.title&#125;</span> <span class="attr">target</span>=<span class="string">&#123;value.target&#125;</span> <span class="attr">className</span>=<span class="string">&#123;value.class&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;props.children || value.text || value.href&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Link</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage - drop-in replacement for JSS&#x27; Link component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyJSSComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">RoutableSitecoreLink</span> <span class="attr">field</span>=<span class="string">&#123;props.fields.externalLink&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>With this component, now your internal link values will be turned into router links and result in only a new fetch of route data instead of a page refresh!</p><h2 id="Rich-Text-Fields"><a href="#Rich-Text-Fields" class="headerlink" title="Rich Text Fields"></a>Rich Text Fields</h2><p>Rich Text fields are a more interesting proposition because they contain free text that is placed into the DOM, and we cannot inject <code>RouterLink</code> components directly into the HTML blob. Instead we can use React’s DOM access to attach an event handler to the rich text markup after it’s rendered by React that will trigger route navigation.</p><p>Similar to the general link field handling, we can wrap the JSS default <code>RichText</code> component with our own component that selects whether to bind the route handling events based on whether we’re editing the page or not:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RichText &#125; <span class="keyword">from</span> <span class="string">&#x27;@sitecore-jss/sitecore-jss-react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Binds route handling to internal links within a rich text field */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouteLinkedRichText</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.routeHandler = <span class="built_in">this</span>.routeHandler.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handler function called on click of route links</span></span><br><span class="line">  <span class="comment">// pushes the click into the router history thus changing the route</span></span><br><span class="line">  <span class="comment">// props.history comes from the react-router withRouter() higher order component.</span></span><br><span class="line">  <span class="function"><span class="title">routeHandler</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    <span class="built_in">this</span>.props.history.push(event.target.pathname);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// rebinds event handlers to route links within this component</span></span><br><span class="line">  <span class="comment">// fired both on mount and update</span></span><br><span class="line">  <span class="function"><span class="title">bindRouteLinks</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hasText = <span class="built_in">this</span>.props.field &amp;&amp; <span class="built_in">this</span>.props.field.value;</span><br><span class="line">    <span class="keyword">const</span> isEditing = <span class="built_in">this</span>.props.editable &amp;&amp; <span class="built_in">this</span>.props.field.editable;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(hasText &amp;&amp; !isEditing) &#123;</span><br><span class="line">      <span class="keyword">const</span> node = ReactDOM.findDOMNode(<span class="built_in">this</span>);</span><br><span class="line">      <span class="comment">// selects all links that start with &#x27;/&#x27; - this logic may be inappropriate for some advanced uses</span></span><br><span class="line">      <span class="keyword">const</span> internalLinks = node.querySelectorAll(<span class="string">&#x27;a[href^=&quot;/&quot;]&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      internalLinks.forEach(<span class="function">(<span class="params">link</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// the component can be updated multiple times during its lifespan,</span></span><br><span class="line">        <span class="comment">// and we don&#x27;t want to bind the same event handler several times so unbind first</span></span><br><span class="line">        link.removeEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="built_in">this</span>.routeHandler, <span class="literal">false</span>);</span><br><span class="line">        link.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="built_in">this</span>.routeHandler, <span class="literal">false</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// called once when component is created</span></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.bindRouteLinks();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// called if component data changes _after_ created</span></span><br><span class="line">  <span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.bindRouteLinks();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// strip the &#x27;staticContext&#x27; prop from withRouter() </span></span><br><span class="line">    <span class="comment">// to avoid confusing React before we pass it down</span></span><br><span class="line">    <span class="keyword">const</span> &#123; staticContext, ...props &#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">RichText</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// augment the component with the react-router context using withRouter()</span></span><br><span class="line"><span class="comment">// this gives us props.history to push new routes</span></span><br><span class="line">RouteLinkedRichText = withRouter(RouteLinkedRichText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage - drop-in replacement for JSS&#x27; RichText component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyJSSComponent = <span class="function">(<span class="params">props</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">RouteLinkedRichText</span> <span class="attr">field</span>=<span class="string">&#123;props.fields.richText&#125;</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure><p>Now internal links entered in rich text fields will also be treated as route links.</p><h2 id="Advanced-Usages"><a href="#Advanced-Usages" class="headerlink" title="Advanced Usages"></a>Advanced Usages</h2><p>These examples use simple internal link detection that consists of “starts with <code>/</code>.” There are some edge cases that can defeat simple link detection, such as:</p><ul><li>Scheme-insensitive links (<code>//google.com</code>) that are HTTP or HTTPS depending on the current page. These are an antipattern; encrypt all your resources.</li><li>Links to static files (i.e. media files).</li></ul><p>For use cases such as this, more advanced detection of internal links may be required that is situational for your implementation.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;When building a single-page app with &lt;a href=&quot;https://jss.sitecore.net/&quot;&gt;Sitecore JSS&lt;/a&gt; and defining internal links in Sitecore content</summary>
      
    
    
    
    <category term="JSS" scheme="https://kamsar.net/index.php/category/JSS/"/>
    
    
  </entry>
  
  <entry>
    <title>Code splitting with Sitecore JSS + React</title>
    <link href="https://kamsar.net/index.php/2018/08/Code-splitting-with-Sitecore-JSS-React/"/>
    <id>https://kamsar.net/index.php/2018/08/Code-splitting-with-Sitecore-JSS-React/</id>
    <published>2018-08-01T15:43:31.000Z</published>
    <updated>2021-07-26T23:19:02.514Z</updated>
    
    <content type="html"><![CDATA[<p>Page weight - how much data a user needs to download to view your website - is a big deal in JavaScript applications. The more script that an application loads, the longer it takes to render for a user - especially in critical mobile scenarios. The longer it takes an app to render, the less happy the users of that app are. JavaScript is especially important to keep lightweight, because JS is not merely downloaded like an image - it also has to be <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/javascript-startup-optimization/">parsed and compiled by the browser</a>. Especially on slower mobile devices, this parsing can take longer than the download! So less script is a very good thing.</p><p>Imagine a large Sitecore JSS application, with a large number of JavaScript components. With the default JSS applications the entire app JS must be deployed to the user when any page in the application loads. This is simple to reason about and performs well with smaller sites, but on a large site it is detrimental to performance if the home page must load 40 components that are not used on that route in order to render.</p><h2 id="Enter-Code-Splitting"><a href="#Enter-Code-Splitting" class="headerlink" title="Enter Code Splitting"></a>Enter Code Splitting</h2><p><a href="https://webpack.js.org/guides/code-splitting/"><em>Code Splitting</em></a> is a term for breaking up your app’s JS into several chunks, usually via <a href="https://webpack.js.org/">webpack</a>. There are many ways that code splitting can be set up, but we’ll focus on two popular automatic techniques: route-level code splitting, and component-level code splitting.</p><p>Route-level code splitting creates a JS bundle for each route in an application. Because of this, it relies on the app using <em>static routing</em> - in other words knowing all routes in advance, and having static components on those routes. This is probably the most widespread code splitting technique, but it is fundamentally incompatible with JSS because the app’s structure and layout is defined by Sitecore. We do not know all of the routes that an app has at build time, nor do we know which components are on those routes because that is also defined by Sitecore.</p><p>Component-level code splitting creates a JS bundle for each component in an application. This results in quite granular bundles, but overall excellent compatibility with JSS because it works great with dynamic routing - we only need to load the JS for the components that an author has added to a given route, and they’re individually cacheable by the browser providing great caching across routes too.</p><h2 id="Component-level-Code-Splitting-with-React"><a href="#Component-level-Code-Splitting-with-React" class="headerlink" title="Component-level Code Splitting with React"></a>Component-level Code Splitting with React</h2><p>The <a href="https://github.com/jamiebuilds/react-loadable">react-loadable</a> library provides excellent component-level code splitting capabilities to React apps. Let’s add it to the JSS React app and split up our components!</p><h3 id="Step-1-Add-react-loadable"><a href="#Step-1-Add-react-loadable" class="headerlink" title="Step 1: Add react-loadable"></a>Step 1: Add <code>react-loadable</code></h3><p>We need some extra npm packages to make this work.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// yarn</span><br><span class="line">yarn add react-loadable</span><br><span class="line">yarn add babel-plugin-syntax-dynamic-import babel-plugin-dynamic-import-node --dev</span><br><span class="line"></span><br><span class="line">// npm</span><br><span class="line">npm i react-loadable</span><br><span class="line">npm i babel-plugin-syntax-dynamic-import babel-plugin-dynamic-import-node --save-dev</span><br></pre></td></tr></table></figure><h3 id="Step-2-Make-the-componentFactory-use-code-splitting"><a href="#Step-2-Make-the-componentFactory-use-code-splitting" class="headerlink" title="Step 2: Make the componentFactory use code splitting"></a>Step 2: Make the <code>componentFactory</code> use code splitting</h3><p>In order to use code splitting, we have to tell <code>create-react-app</code> (which uses <code>webpack</code>) how to split our output JS. This is pretty easy using <a href="https://reactjs.org/docs/code-splitting.html#import">dynamic <code>import</code></a>, which works like a normal <code>import</code> or <code>require</code> but loads the module lazily at runtime. <a href="https://github.com/jamiebuilds/react-loadable">react-loadable</a> provides a simple syntax to wrap any React component in a lazy-loading shell.</p><p>In JSS applications, the <em>Component Factory</em> is a mapping of the names of components into the implementation of those components - for example to allow the JSS app to resolve the component named <code>&#39;ContentBlock&#39;</code>, provided by the Sitecore Layout Service, to a React component defined in <code>ContentBlock.js</code>. The Component Factory is a perfect place to put component-level code splitting.</p><p>In a JSS React app, the Component Factory is generated code by default - inferring the components to register based on filesystem conventions. The <code>/scripts/generate-component-factory.js</code> file defines how the code is generated. The generated code - created when a build starts - is emitted to <code>/src/temp/componentFactory.js</code>. Before we alter the code generator to generate split components, let’s compare registering a component in each way:</p><h5 id="JSS-React-standard-componentFactory-js"><a href="#JSS-React-standard-componentFactory-js" class="headerlink" title="JSS React standard componentFactory.js"></a>JSS React standard componentFactory.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// static import</span></span><br><span class="line"><span class="keyword">import</span> ContentBlock <span class="keyword">from</span> <span class="string">&#x27;../components/ContentBlock&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create component map (identical code)</span></span><br><span class="line"><span class="keyword">const</span> components = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">components.set(<span class="string">&#x27;ContentBlock&#x27;</span>, ContentBlock);</span><br></pre></td></tr></table></figure><h5 id="react-loadable-componentFactory-js"><a href="#react-loadable-componentFactory-js" class="headerlink" title="react-loadable componentFactory.js"></a>react-loadable componentFactory.js</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">&#x27;react-loadable&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// loadable dynamic import component - lazily loads the component implementation when it is first used</span></span><br><span class="line"><span class="keyword">const</span> ContentBlock = Loadable(&#123;</span><br><span class="line">  <span class="comment">// setting webpackChunkName lets us have a nice chunk filename like ContentBlock.hash.js instead of 1.hash.js</span></span><br><span class="line">  <span class="attr">loader</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;ContentBlock&quot; */</span> <span class="string">&#x27;../components/ContentBlock&#x27;</span>),</span><br><span class="line">  <span class="comment">// this is a react component shown while lazy loading. See the react-loadable docs for guidance on making a good one.</span></span><br><span class="line">  <span class="attr">loading</span>: <span class="function">() =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">  <span class="comment">// this module name should match the webpackChunkName that was set. This is used to determine dependency during server-side rendering.</span></span><br><span class="line">  modules: [<span class="string">&#x27;ContentBlock&#x27;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create component map (identical code)</span></span><br><span class="line"><span class="keyword">const</span> components = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">components.set(<span class="string">&#x27;ContentBlock&#x27;</span>, ContentBlock);</span><br></pre></td></tr></table></figure><h4 id="Updating-the-Component-Factory-Code-Generation"><a href="#Updating-the-Component-Factory-Code-Generation" class="headerlink" title="Updating the Component Factory Code Generation"></a>Updating the Component Factory Code Generation</h4><p>In order to have our component factory use splitting, let’s update the code generator to emit <code>react-loadable</code> component definitions. </p><p>Modify <code>/scripts/generate-component-factory.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add this function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoadableComponent</span>(<span class="params">importVarName, componentFolder</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`const <span class="subst">$&#123;importVarName&#125;</span> = Loadable(&#123;</span></span><br><span class="line"><span class="string">    loader: () =&gt; import(/* webpackChunkName: &quot;<span class="subst">$&#123;componentFolder&#125;</span>&quot; */ &#x27;../components/<span class="subst">$&#123;componentFolder&#125;</span>&#x27;),</span></span><br><span class="line"><span class="string">    loading: () =&gt; &lt;div&gt;Loading...&lt;/div&gt;,</span></span><br><span class="line"><span class="string">    modules: [&#x27;<span class="subst">$&#123;componentFolder&#125;</span>&#x27;],</span></span><br><span class="line"><span class="string">    &#125;);`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// modify generateComponentFactory()...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// after const imports = [];</span></span><br><span class="line">imports.push(<span class="string">`import React from &#x27;react&#x27;;`</span>);</span><br><span class="line">imports.push(<span class="string">`import Loadable from &#x27;react-loadable&#x27;;`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// change imports.push(``import $&#123;importVarName&#125; from &#x27;../components/$&#123;componentFolder&#125;&#x27;;``); to</span></span><br><span class="line">imports.push(LoadableComponent(importVarName, componentFolder));</span><br></pre></td></tr></table></figure><p>You can find a completed <a href="https://gist.github.com/kamsar/9a616dffdb2dc1d76772cc796d716b03">gist of these changes here</a>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the loader.</p><h5 id="Try-it"><a href="#Try-it" class="headerlink" title="Try it!"></a>Try it!</h5><p>Start your app up with <code>jss start</code>. At this point Code Splitting should be working: you should see a JS file get loaded for each component on a route, and a short flash of <code>Loading...</code> when the route initially loads.</p><p>But it still has some issues that could make it more usable. If the app is server-side rendered in <a href="https://jss.sitecore.net/docs/fundamentals/application-modes">headless or integrated modes</a> none of the content will be present because the dynamic imports are asynchronous and have not resolved before the SSR completes. We’d also love to avoid that flash of loading text if the page was server-side rendered, too. Well guess what, we can do all of that!</p><h3 id="Step-3-Configure-code-splitting-for-Server-Side-Rendering"><a href="#Step-3-Configure-code-splitting-for-Server-Side-Rendering" class="headerlink" title="Step 3: Configure code splitting for Server-Side Rendering"></a>Step 3: Configure code splitting for Server-Side Rendering</h3><p>Server-side rendering with code splitting is a bit more complex. There are several pieces that the app needs to support:</p><ul><li>Preload all lazy loaded components, so that they render immediately during server-side rendering instead of starting to load async and leaving a loading message in the SSR HTML.</li><li>Determine which lazy loaded components were used during rendering, so that we can preload the same components’ JS files on the client-side to avoid the flash of loading text.</li><li>Emit <code>&lt;script&gt;</code> tags to preload the used components’ JS files on the client side into the SSR HTML.</li></ul><h4 id="3-1-Configure-SSR-Webpack-to-understand-dynamic-import"><a href="#3-1-Configure-SSR-Webpack-to-understand-dynamic-import" class="headerlink" title="3.1: Configure SSR Webpack to understand dynamic import"></a>3.1: Configure SSR Webpack to understand dynamic import</h4><p>The build of the server-side JS bundle is separate from the client bundle. We need to teach the server-side build how to compile the dynamic import expressions. Open <code>/server/server.webpack.config.js</code>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add these after other imports</span></span><br><span class="line"><span class="keyword">const</span> dynamicImport = <span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-syntax-dynamic-import&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dynamicImportNode = <span class="built_in">require</span>(<span class="string">&#x27;babel-plugin-dynamic-import-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> loadableBabel = <span class="built_in">require</span>(<span class="string">&#x27;react-loadable/babel&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// add the plugins to your babel-loader section</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">use: &#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">  <span class="attr">babelrc</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">presets</span>: [env, stage0, reactApp],</span><br><span class="line">  <span class="comment">// [CS] ADDED FOR CODE SPLITTING</span></span><br><span class="line">  <span class="attr">plugins</span>: [dynamicImport, dynamicImportNode, loadableBabel],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>You can find a completed <a href="https://gist.github.com/kamsar/016b591148325d7de9260042d8113286">gist of these changes here</a>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the webpack config.</p><h4 id="3-2-Configure-server-js"><a href="#3-2-Configure-server-js" class="headerlink" title="3.2: Configure server.js"></a>3.2: Configure server.js</h4><p>The <code>/server/server.js</code> is the entry point to the JSS React app when it’s rendered on the server-side. We need to teach this entry point how to successfully execute SSR with lazy loaded components, and to emit preload script tags for used components.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add to the top</span></span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">&#x27;react-loadable&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> manifest <span class="keyword">from</span> <span class="string">&#x27;../build/asset-manifest.json&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertLoadableModulesToScripts</span>(<span class="params">usedModules</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.keys(manifest)</span><br><span class="line">    .filter(<span class="function">(<span class="params">chunkName</span>) =&gt;</span> usedModules.indexOf(chunkName.replace(<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) &gt; -<span class="number">1</span>)</span><br><span class="line">    .map(<span class="function">(<span class="params">k</span>) =&gt;</span> <span class="string">`&lt;script src=&quot;<span class="subst">$&#123;manifest[k]&#125;</span>&quot;&gt;&lt;/script&gt;`</span>)</span><br><span class="line">    .join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add after const graphQLClient...</span></span><br><span class="line"><span class="keyword">const</span> loadableModules = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// add after initializei18n()...</span></span><br><span class="line">.then(<span class="function">() =&gt;</span> Loadable.preloadAll())</span><br><span class="line"></span><br><span class="line"><span class="comment">// wrap the `&lt;AppRoot&gt;` component with the loadable used-component-capture component</span></span><br><span class="line">&lt;Loadable.Capture report=&#123;<span class="function">(<span class="params"><span class="built_in">module</span></span>) =&gt;</span> loadableModules.push(<span class="built_in">module</span>)&#125;&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">AppRoot</span> <span class="attr">path</span>=<span class="string">&#123;path&#125;</span> <span class="attr">Router</span>=<span class="string">&#123;StaticRouter&#125;</span> <span class="attr">graphQLClient</span>=<span class="string">&#123;graphQLClient&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/Loadable.Capture&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// append another .replace() to the rendered HTML transformations</span></span><br><span class="line">.replace(<span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">`<span class="subst">$&#123;convertLoadableModulesToScripts(loadableModules)&#125;</span>&lt;script&gt;`</span>);</span><br></pre></td></tr></table></figure><p>You can find a completed <a href="https://gist.github.com/kamsar/29370b58f7a4fb15bed74521e01ad6bc">gist of these changes here</a> <strong>with better explanatory comments</strong>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the entry point.</p><h4 id="3-3-Configure-client-side-index-js"><a href="#3-3-Configure-client-side-index-js" class="headerlink" title="3.3: Configure client-side index.js"></a>3.3: Configure client-side index.js</h4><p>The <code>/src/index.js</code> is the entry point to the JSS React app when it’s rendered on the browser-side. We need to teach this entry point how to wait to ensure that all preloaded components that SSR may have emitted to the page are done loading before we render the JSS app the first time to avoid a flash of loading text.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add to the top</span></span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">&#x27;react-loadable&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add after i18ninit()</span></span><br><span class="line">.then(<span class="function">() =&gt;</span> Loadable.preloadReady())</span><br></pre></td></tr></table></figure><p>You can find a completed <a href="https://gist.github.com/kamsar/ecbc0a50fdb877eb598ef9c3a385aff9">gist of these changes here</a>. Search in it for <code>[CS]</code> to see each change in context. Don’t copy the whole file, in case of future changes to the rest of the entry point.</p><h3 id="Step-4-Try-it-out"><a href="#Step-4-Try-it-out" class="headerlink" title="Step 4: Try it out"></a>Step 4: Try it out</h3><p>With the code changes to enable splitting complete, deploy your app to Sitecore and try it in integrated mode. You should see the SSR HTML include a script tag for every component used on the route, and the rendering will wait until the components have preloaded before showing the application. This preloading means the browser does not have to wait for React to boot up before beginning load of the components, resulting in a much faster page load time.</p><img src="/index.php/2018/08/Code-splitting-with-Sitecore-JSS-React/ssr-trace.png" class=""><p>The ideal component loading technique for each app will be different depending on the number and size of each component. Using the standard JSS styleguide sample app, enabling component code-splitting like this resulted in transferring almost 40k less data when loading the home page (which has a single component) vs the styleguide page (which has many components). This difference increases with the total number of components in a JSS app - but for most apps, code splitting is a smart idea if the app has many components that are used on only a few pages.</p><h2 id="Sources"><a href="#Sources" class="headerlink" title="Sources"></a>Sources</h2><ul><li><a href="https://medium.com/bucharestjs/upgrading-a-create-react-app-project-to-a-ssr-code-splitting-setup-9da57df2040a">Upgrading a create-react-app project to a SSR + code splitting setup</a></li><li><a href="https://serverless-stack.com/chapters/code-splitting-in-create-react-app.html">Code Splitting in Create React App</a></li><li><a href="https://github.com/jamiebuilds/react-loadable">react-loadable</a></li><li><a href="https://webpack.js.org/guides/code-splitting/">Webpack Code Splitting Guide</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Page weight - how much data a user needs to download to view your website - is a big deal in JavaScript applications. The more script tha</summary>
      
    
    
    
    <category term="JSS" scheme="https://kamsar.net/index.php/category/JSS/"/>
    
    
  </entry>
  
  <entry>
    <title>Deploying Disconnected JSS Apps</title>
    <link href="https://kamsar.net/index.php/2018/07/Deploying-Disconnected-JSS-Apps/"/>
    <id>https://kamsar.net/index.php/2018/07/Deploying-Disconnected-JSS-Apps/</id>
    <published>2018-07-27T15:16:07.000Z</published>
    <updated>2021-07-26T23:19:02.514Z</updated>
    
    <content type="html"><![CDATA[<p>It’s possible to deploy server-side rendered <a href="https://jss.sitecore.net/">Sitecore JSS</a> sites in <a href="https://jss.sitecore.net/docs/fundamentals/application-modes">disconnected mode</a>. When deployed this way, the JSS app will run using disconnected layout and content data, and will not use a Sitecore backend.</p><h2 id="Why-would-I-want-this"><a href="#Why-would-I-want-this" class="headerlink" title="Why would I want this?"></a>Why would I want this?</h2><p>In a word, <em>previewing</em>. Imagine during early development and prototyping of a JSS implementation. There’s a team of designers, UX architects, and frontend developers who are designing the app and its interactions. In most cases, Sitecore developers may not be involved yet - or if they are involved, there is no Sitecore instance set up.</p><p>This is one of the major advantages of JSS - using disconnected mode, a team like this can develop non-throwaway frontend for the final JSS app. But stakeholders will want to review the in-progress JSS app somewhere other than <code>http://localhost:3001</code>, so how do we put a JSS site somewhere shared without having a Sitecore backend?</p><blockquote><p>Wondering about real-world usage?<br>The <a href="https://jss.sitecore.net/">JSS docs</a> use this technique.</p></blockquote><h2 id="How-does-it-work"><a href="#How-does-it-work" class="headerlink" title="How does it work?"></a>How does it work?</h2><p>Running a disconnected JSS app is a lot like <a href="https://jss.sitecore.net/docs/fundamentals/application-modes">headless mode</a>: a reverse proxy is set up that proxies incoming requests to Layout Service, then transforms the result of the LS call into HTML using JS server-side rendering and returns it. In the case of disconnected deployment instead of the proxy sending requests to the Sitecore hosted Layout Service, the requests are proxied to the disconnected layout service.</p><h2 id="Setting-up-a-disconnected-app-step-by-step"><a href="#Setting-up-a-disconnected-app-step-by-step" class="headerlink" title="Setting up a disconnected app step by step"></a>Setting up a disconnected app step by step</h2><p>To deploy a disconnected app you’ll need a Node-compatible host. This is easiest with something like Heroku or another PaaS Node host, but it can also be done on any machine that can run Node. For our example, we’ll use <a href="https://www.heroku.com/">Heroku</a>.</p><h3 id="Configuring-the-app-for-disconnected-deployment"><a href="#Configuring-the-app-for-disconnected-deployment" class="headerlink" title="Configuring the app for disconnected deployment"></a>Configuring the app for disconnected deployment</h3><p>Any of the JSS sample templates will work for this technique. <a href="https://jss.sitecore.net/docs/getting-started/quick-start">Create yourself a JSS app with the CLI in 5 minutes</a> if you need one to try.</p><ol><li>Ensure the app has no <code>scjssconfig.json</code> in the root. This will make the build use the local layout service.</li><li>Create a build of the JSS app with <code>jss build</code>. This will build the artifacts that the app needs to run.</li><li>Install npm packages necessary to host a disconnected server: <code>yarn add @sitecore-jss/sitecore-jss-proxy express</code> (substitute <code>npm i --save</code> if you use npm instead of yarn)</li><li>Deploy the following code to <code>/scripts/disconnected-ssr.js</code> (or similar path). Note: this code is set up for React, and will require minor tweaks for Angular or Vue samples (<code>build</code> -&gt; <code>dist</code>) <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const &#123; appName, language, sitecoreDistPath &#125; = require(&#x27;../package.json&#x27;).config;</span><br><span class="line">const scProxy = require(&#x27;@sitecore-jss/sitecore-jss-proxy&#x27;).default;</span><br><span class="line">const &#123; createDefaultDisconnectedServer &#125; = require(&#x27;@sitecore-jss/sitecore-jss-dev-tools&#x27;);</span><br><span class="line">const app = require(&#x27;../build/server.bundle&#x27;);</span><br><span class="line"></span><br><span class="line">const server = express();</span><br><span class="line"></span><br><span class="line">// the port the disconnected app will run on</span><br><span class="line">// Node hosts usually pass a port to run on using a CLI argument</span><br><span class="line">const port = process.argv[2] || 8080;</span><br><span class="line"></span><br><span class="line">// create a JSS disconnected-mode server</span><br><span class="line">createDefaultDisconnectedServer(&#123;</span><br><span class="line">  port,</span><br><span class="line">  appRoot: __dirname,</span><br><span class="line">  appName,</span><br><span class="line">  language,</span><br><span class="line">  server,</span><br><span class="line">  afterMiddlewareRegistered: (expressInstance) =&gt; &#123;</span><br><span class="line">    // to make disconnected SSR work, we need to add additional middleware (beyond mock layout service) to handle</span><br><span class="line">    // local static build artifacts, and to handle SSR by loopback proxying to the disconnected</span><br><span class="line">    // layout service on the same express server</span><br><span class="line"></span><br><span class="line">    // Serve static app assets from local /build folder into the sitecoreDistPath setting</span><br><span class="line">    // Note: for Angular and Vue samples, change /build to /dist to match where they emit build artifacts</span><br><span class="line">    expressInstance.use(</span><br><span class="line">      sitecoreDistPath,</span><br><span class="line">      express.static(&#x27;build&#x27;, &#123;</span><br><span class="line">        fallthrough: false, // force 404 for unknown assets under /dist</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    const ssrProxyConfig = &#123;</span><br><span class="line">      // api host = self, because this server hosts the disconnected layout service</span><br><span class="line">      apiHost: `http://localhost:$&#123;port&#125;`,</span><br><span class="line">      layoutServiceRoute: &#x27;/sitecore/api/layout/render/jss&#x27;,</span><br><span class="line">      apiKey: &#x27;NA&#x27;,</span><br><span class="line">      pathRewriteExcludeRoutes: [&#x27;/dist&#x27;, &#x27;/build&#x27;, &#x27;/assets&#x27;, &#x27;/sitecore/api&#x27;, &#x27;/api&#x27;],</span><br><span class="line">      debug: false,</span><br><span class="line">      maxResponseSizeBytes: 10 * 1024 * 1024,</span><br><span class="line">      proxyOptions: &#123;</span><br><span class="line">        headers: &#123;</span><br><span class="line">          &#x27;Cache-Control&#x27;: &#x27;no-cache&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // For any other requests, we render app routes server-side and return them</span><br><span class="line">    expressInstance.use(&#x27;*&#x27;, scProxy(app.renderView, ssrProxyConfig, app.parseRouteUrl));</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li>Test it out. From a console in the app root, run <code>node ./scripts/disconnected-ssr.js</code>. Then in a browser, open <code>http://localhost:8080</code> to see it in action!</li></ol><h3 id="Deploying-the-disconnected-app-to-Heroku"><a href="#Deploying-the-disconnected-app-to-Heroku" class="headerlink" title="Deploying the disconnected app to Heroku"></a>Deploying the disconnected app to Heroku</h3><p>Heroku is a very easy to use PaaS Node host, but you can also deploy to Azure App Service or any other service that can host Node. To get started, sign up for a Heroku account and install and configure the <a href="https://devcenter.heroku.com/articles/heroku-cli">Heroku CLI</a>.</p><ol><li>We need to tell Heroku to build our app when it’s deployed.<ul><li>Locate the <code>scripts</code> section in the <code>package.json</code></li><li>Add the following script: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;postinstall&quot;: &quot;npm run build&quot;`</span><br></pre></td></tr></table></figure></li></ul></li><li>We need to tell Heroku the command to use to start our app.<ul><li>Create a file in the app root called <code>Procfile</code></li><li>Place the following contents: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web: node ./scripts/disconnected-ssr.js $PORT</span><br></pre></td></tr></table></figure></li></ul></li><li>To deploy to Heroku, we’ll use Git. Heroku provides us a Git remote that we can push to that will deploy our app. To use Git, we need to make our app a Git repository: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add -A</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br></pre></td></tr></table></figure></li><li>Create the Heroku app. This will create the app in Heroku and configure the Git remote to deploy to it. Using a console in your app root: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroku create &lt;your-heroku-app-name&gt;</span><br></pre></td></tr></table></figure></li><li>Configure Heroku to install node <code>devDependencies</code> (which we need to start the app in disconnected mode). Run the following command: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroku config:set NPM_CONFIG_PRODUCTION=false YARN_PRODUCTION=false</span><br></pre></td></tr></table></figure></li><li>Deploy the JSS app to Heroku: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u heroku master</span><br></pre></td></tr></table></figure></li><li>Your JSS app should be running at <code>https://&lt;yourappname&gt;.herokuapp.com</code>!</li></ol><blockquote><p>In case it’s not obvious, do not use this setup in production. The JSS disconnected server is not designed to handle heavy production load.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;It’s possible to deploy server-side rendered &lt;a href=&quot;https://jss.sitecore.net/&quot;&gt;Sitecore JSS&lt;/a&gt; sites in &lt;a href=&quot;https://jss.sitecore.</summary>
      
    
    
    
    <category term="JSS" scheme="https://kamsar.net/index.php/category/JSS/"/>
    
    
  </entry>
  
  <entry>
    <title>Announcing Sitecore JSS XSLT Support</title>
    <link href="https://kamsar.net/index.php/2018/04/Announcing-Sitecore-JSS-XSLT-Support/"/>
    <id>https://kamsar.net/index.php/2018/04/Announcing-Sitecore-JSS-XSLT-Support/</id>
    <published>2018-04-01T07:07:06.000Z</published>
    <updated>2021-07-26T23:19:02.513Z</updated>
    
    <content type="html"><![CDATA[<p>Sitecore Team X is proud to announce the final public release of Sitecore JavaScript Services (JSS) with full XSLT 3.0 support!</p><h2 id="Why-XSLT-3-0"><a href="#Why-XSLT-3-0" class="headerlink" title="Why XSLT 3.0?"></a>Why XSLT 3.0?</h2><p>XSLT 3.0 allows for <a href="https://www.xml.com/articles/2017/02/14/why-you-should-be-using-xslt-30/">JSON transformations</a>, so you can use the full power of modern JSS while retaining the XSLT developer experience that Site Core developers know and love.</p><p>Our XSLT 3.0 engine allows for client-side rendering by transforming hard-to-read JSON into plain, sensible XML using XSLT 3.0 standards-compliant JSON-to-XML transformations. Instead of ugly JSON, your JSS renderings can simple, easy to read XML like this:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">j:map</span> <span class="attr">xmlns:j</span>=<span class="string">&quot;http://www.w3.org/2013/XSL/json&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">j:map</span> <span class="attr">key</span>=<span class="string">&quot;fields&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">j:map</span> <span class="attr">key</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">j:map</span> <span class="attr">key</span>=<span class="string">&quot;value&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;editable&quot;</span>&gt;</span>SiteCore Experience Platform + JSS + XSLT<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;value&quot;</span>&gt;</span>SiteCore Experience Platform + JSS + XSLT<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It’s just as simple to make a JSS XSLT to transform your rendering output. Check out this super simple “hello world” sample:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:math</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions/math&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xd</span>=<span class="string">&quot;http://www.oxygenxml.com/ns/doc/xsl&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:SiteCore</span>=<span class="string">&quot;http://www.SiteCore.com/demandMore/xslt&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:h</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:fn</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:j</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">exclude-result-prefixes</span>=<span class="string">&quot;xs math xd h SiteCore&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">&quot;3.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">expand-text</span>=<span class="string">&quot;yes&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:output</span>  <span class="attr">method</span>=<span class="string">&quot;text&quot;</span> <span class="attr">indent</span>=<span class="string">&quot;yes&quot;</span> <span class="attr">media-type</span>=<span class="string">&quot;text/json&quot;</span> <span class="attr">omit-xml-declaration</span>=<span class="string">&quot;yes&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-a&quot;</span> <span class="attr">select</span>=<span class="string">&quot;json-to-xml(/)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-b&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">xsl:apply-templates</span> <span class="attr">select</span>=<span class="string">&quot;$fields-a/*&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">xsl:variable</span>&gt;</span></span><br><span class="line">       &#123;xml-to-json($fields-b,map&#123;&#x27;indent&#x27;:true()&#125;)&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/j:map&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">j:array</span> <span class="attr">key</span>=<span class="string">&quot;fields&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">xsl:apply-templates</span> <span class="attr">select</span>=<span class="string">&quot;j:map[@key=&#x27;fields&#x27;]/j:map&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;rendering&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">j:array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;j:map&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;rendering&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;j:string[@key=&#x27;title:value&#x27;]||&#x27; &#x27;||j:string</span><br><span class="line">[@key=&#x27;title:editable&#x27;]&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">&quot;j:boolean [@key=&#x27;experienceEditor&#x27;]&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;editable&quot;</span>&gt;</span>&#123;j:string</span><br><span class="line">[@key=&#x27;editable&#x27;]/text()&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JSON transformations allow XSLT 3.0 to be a transformative force on the modern web. Expect to see recruiters demand 10 years of XSLT 3.0 experience for Site-core candidates within the next year - this is a technology you will not want to miss out on learning.</p><h2 id="Dynamic-XSLT-with-VBScript"><a href="#Dynamic-XSLT-with-VBScript" class="headerlink" title="Dynamic XSLT with VBScript"></a>Dynamic XSLT with VBScript</h2><p>Modern JavaScript is way too difficult, so we’ve implemented a feature that lets you define dynamic XSLT templates using ultra-modern VBScript:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:math</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions/math&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xd</span>=<span class="string">&quot;http://www.oxygenxml.com/ns/doc/xsl&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:SiteCore</span>=<span class="string">&quot;http://www.SiteCore.com/demandMore/xslt&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:h</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:fn</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:j</span>=<span class="string">&quot;http://www.w3.org/2005/xpath-functions&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">exclude-result-prefixes</span>=<span class="string">&quot;xs math xd h SiteCore&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">&quot;3.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">expand-text</span>=<span class="string">&quot;yes&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:output</span>  <span class="attr">method</span>=<span class="string">&quot;text&quot;</span> <span class="attr">indent</span>=<span class="string">&quot;yes&quot;</span> <span class="attr">media-type</span>=<span class="string">&quot;text/json&quot;</span> <span class="attr">omit-xml-declaration</span>=<span class="string">&quot;yes&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-a&quot;</span> <span class="attr">select</span>=<span class="string">&quot;json-to-xml(/)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">xsl:variable</span> <span class="attr">name</span>=<span class="string">&quot;fields-b&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">xsl:apply-templates</span> <span class="attr">select</span>=<span class="string">&quot;$fields-a/*&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">xsl:variable</span>&gt;</span></span><br><span class="line">       &#123;xml-to-json($fields-b,map&#123;&#x27;indent&#x27;:true()&#125;)&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/j:map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/vbscript&quot;</span>&gt;</span></span><br><span class="line">      Dim txtValue = xmlns.SiteCore.rendering.title.value</span><br><span class="line">      Dim txtEditable = xmlns.SiteCore.rendering.title.value</span><br><span class="line"></span><br><span class="line">      Sub xsltRender(txtVBProgrammers, txtAreDim)</span><br><span class="line">        document.write(txtVBProgrammers)</span><br><span class="line">      End Sub</span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;j:map&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;rendering&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">j:map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;j:string[@key=&#x27;title:value&#x27;]||&#x27; &#x27;||j:string</span><br><span class="line">[@key=&#x27;title:editable&#x27;]&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsl:if</span> <span class="attr">test</span>=<span class="string">&quot;j:boolean [@key=&#x27;experienceEditor&#x27;]&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">j:string</span> <span class="attr">key</span>=<span class="string">&quot;editable&quot;</span>&gt;</span>&#123;j:string</span><br><span class="line">[@key=&#x27;editable&#x27;]/text()&#125;<span class="tag">&lt;/<span class="name">j:string</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsl:if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">j:map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>With a quick piece of simple VBScript like that, you’ll be making awesome JSS pages like this one in no time!</p><img src="/index.php/2018/04/Announcing-Sitecore-JSS-XSLT-Support/xslt.png" class=""><h2 id="How-can-I-get-this-XSLT-goodness"><a href="#How-can-I-get-this-XSLT-goodness" class="headerlink" title="How can I get this XSLT goodness?"></a>How can I get this XSLT goodness?</h2><p>Glad you asked. Download it <a href="https://goo.gl/EpcFui">right here</a>!</p><h2 id="What’s-next-for-JSS"><a href="#What’s-next-for-JSS" class="headerlink" title="What’s next for JSS"></a>What’s next for JSS</h2><p>The Sitecore JSS team is always looking for opportunities to improve JSS and make it compatible with the most modern technologies. Experimentation is already under way to add ColdFusion scripting support for XSLT 3 JSS renderings, and enable PHP server-side rendering for your SiteCore solutions.</p><p>Just another way that we help you succeed in your Site core implementations.</p><p><a href="https://goo.gl/2jTvPX">Send us feedback on our roadmap</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Sitecore Team X is proud to announce the final public release of Sitecore JavaScript Services (JSS) with full XSLT 3.0 support!&lt;/p&gt;
&lt;h2 i</summary>
      
    
    
    
    <category term="JSS" scheme="https://kamsar.net/index.php/category/JSS/"/>
    
    
  </entry>
  
  <entry>
    <title>The lazy developer&#39;s way to install Sitecore 9</title>
    <link href="https://kamsar.net/index.php/2017/11/The-lazy-way-to-install-Sitecore-9/"/>
    <id>https://kamsar.net/index.php/2017/11/The-lazy-way-to-install-Sitecore-9/</id>
    <published>2017-11-02T00:37:11.000Z</published>
    <updated>2021-07-26T23:19:02.512Z</updated>
    
    <content type="html"><![CDATA[<p>Since Sitecore 9 was released, there’s been a lot of talk about the new installation techniques that it necessitates - namely, the move towards infrastructure as code and the Sitecore Install Framework (SIF). It’s no secret that installing Sitecore 9 can be a bit more difficult than previous versions, but it really doesn’t have to be.</p><p>This is the part where you might be expecting me to announce some crazy script I wrote, but not this time because someone else already did the work. So let’s address the elephant in the room.</p><h2 id="Solr-the-easy-way"><a href="#Solr-the-easy-way" class="headerlink" title="Solr the easy way"></a>Solr the easy way</h2><p>Back in the day <a href="https://kamsar.net/index.php/2016/03/The-Solr-Cannon/">I wrote some scripts to install Solr</a> using Bitnami. It worked, but I’d always wanted to find the time to make it simpler and less dependent on Bitnami and their notoriously hard to find older versions. Well <a href="https://jermdavis.wordpress.com/2017/10/30/low-effort-solr-installs/">Jeremy Davis did exactly what I wanted to do</a> and scripted the whole Solr install, locally trusted SSL certificate, and installation as a service. You can also just <a href="https://gist.github.com/jermdavis/8d8a79f680505f1074153f02f70b9105">skip straight to the gist of the PowerShell you need to run</a>.</p><p>Seriously, it’s awesome and you should use it especially for local dev setups.</p><p>A few things I noted when I used it:</p><ul><li>Change the download URLs for Solr and NSSM to be https (encrypted). They work fine that way.</li><li>You must install the Java Runtime Environment (JRE) first and plug in the right version - it won’t do it for you</li><li>Make sure to add the <code>$SolrHost</code> value to your hosts file before you run the script so that it can resolve with the SSL certificate correctly (it will be bound to that name; don’t use <code>localhost</code>).</li></ul><h2 id="SIF-the-easy-way-with-SIFless"><a href="#SIF-the-easy-way-with-SIFless" class="headerlink" title="SIF the easy way with SIFless"></a>SIF the easy way with SIFless</h2><p>SIF is a pretty amazing tool, but it has two shortcomings: one, that it’s great for automated infrastructure but not so great for a quick local setup and two, that it doesn’t yet have an uninstall feature. Well <a href="http://www.rockpapersitecore.com/2017/10/introducing-sif-less-for-easy-sitecore-9-installation/">Rob Ahnemann wrote a handy GUI for SIF called SIFless</a> that fixes both of those issues, making quick setups with mostly default settings easy <em>and</em> generating hackable SIF PowerShell scripts that let you do whatever advanced things you want after using the GUI to get started. And it generates uninstall scripts too that get rid of the windows services, solr cores, and other artifacts that are left when you want to tear down that test site.</p><p>A few things to be aware of with SIFless:</p><ul><li>Despite the amusing name, SIFless <em>does</em> require SIF to be installed!</li><li>The Solr URL needs to be the path to the Solr admin panel (e.g. not <code>https://mysolr:8983</code>, but <code>https://mysolr:8983/solr</code>)</li><li>The Solr physical path needs to be to the root of the Solr instance (if it’s the right place you’ll see ‘bin’ and ‘server’ folders; if you used the script above with defaults this would be <code>C:\solr\solr-6.6.2</code>)</li></ul><h2 id="Go-forth-and-use-Sitecore-9"><a href="#Go-forth-and-use-Sitecore-9" class="headerlink" title="Go forth and use Sitecore 9"></a>Go forth and use Sitecore 9</h2><p>Using these two tools I went from having no Solr and no Sitecore installations to having a fully operational <del>battle station</del> Sitecore 9 instance with xConnect in about 45 minutes. And that includes debugging my own silly mistakes. I bet you can do it faster. Get thee to a PowerShell console!</p><p><img src="https://media.giphy.com/media/cCba2gQCxNpsc/giphy.gif" alt="time to get SIFty"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Since Sitecore 9 was released, there’s been a lot of talk about the new installation techniques that it necessitates - namely, the move t</summary>
      
    
    
    
    <category term="Sitecore" scheme="https://kamsar.net/index.php/category/Sitecore/"/>
    
    
  </entry>
  
  <entry>
    <title>I&#39;m a Sitecorian!</title>
    <link href="https://kamsar.net/index.php/2017/10/I-m-a-Sitecorian/"/>
    <id>https://kamsar.net/index.php/2017/10/I-m-a-Sitecorian/</id>
    <published>2017-10-23T20:01:58.000Z</published>
    <updated>2021-07-26T23:19:02.512Z</updated>
    
    <content type="html"><![CDATA[<p>I am excited to announce that I am joining the Sitecore product team as a Platform Architect! </p><p><img src="https://media.giphy.com/media/1jnyRP4DorCh2/giphy.gif" alt="wth"></p><p>Now normally this wouldn’t merit a whole blog post, and we’d just let the recruiters find out about it on LinkedIn. But I’m sure many folks’ next question would be around all the libraries that I maintain and what will happen to them. So let’s address the elephant in the room:</p><p><img src="https://media.giphy.com/media/y63H09ZvHJdf2/giphy.gif" alt="not a thing"></p><h2 id="Unicorn-Rainbow-and-Dianoga"><a href="#Unicorn-Rainbow-and-Dianoga" class="headerlink" title="Unicorn, Rainbow, and Dianoga"></a><a href="https://github.com/kamsar/Unicorn">Unicorn</a>, <a href="https://github.com/kamsar/Rainbow">Rainbow</a>, and <a href="https://github.com/kamsar/Dianoga">Dianoga</a></h2><p>These will continue exactly as they are today as independent, community driven projects. I will still be the maintainer. The license will remain MIT.</p><p>This also includes the dependency libraries that these projects use (e.g. <a href="https://github.com/kamsar/Configy">Configy</a>, <a href="https://github.com/kamsar/Kamsar.WebConsole">WebConsole</a>, <a href="https://github.com/kamsar/MicroCHAP">MicroCHAP</a>).</p><h2 id="Synthesis-amp-Leprechaun"><a href="#Synthesis-amp-Leprechaun" class="headerlink" title="Synthesis &amp; Leprechaun"></a><a href="https://github.com/kamsar/Synthesis">Synthesis</a> &amp; <a href="https://github.com/kamsar/Leprechaun">Leprechaun</a></h2><p>Ok hold up: let’s first define what Leprechaun <em>is</em> because I haven’t publicly spoken about it yet. It’s a stable command-line code generator that works from Rainbow serialized items. Kinda like the T4 templates that a lot of people use except that it’s better because:</p><ul><li>Uses Roslyn and C# Scripting, so it can run outside Visual Studio (e.g. on a CI server)</li><li>Ridiculously faster than T4</li><li>Has a watch mode that provides instant regeneration when saving templates in Sitecore</li><li>Uses the same configuration system as Unicorn does, so it’s familiar and simple to configure</li></ul><p>Leprechaun is currently working in production on a couple sites, but does not have complete documentation so it may require a bit more spelunking to use. Currently it supports Synthesis out of the box, but it’s easy to add or change code generation templates.</p><p>Ok back to what’s happening to these projects. For the last year or so it’s been difficult to come up with the time and inclination to give Synthesis and Leprechaun the love they deserve. In order to get them that love, I am ceding maintainership to the excellent <a href="https://twitter.com/bllipson">Ben Lipson</a>. Ben is talented developer and Sitecore MVP with a lot of good ideas about where to take these tools. He’ll do a great job.</p><p>Aside from transferring the repositories to Ben, nothing else is changing.</p><h2 id="Will-you-be-disappearing-from-the-community"><a href="#Will-you-be-disappearing-from-the-community" class="headerlink" title="Will you be disappearing from the community?"></a>Will you be disappearing from the community?</h2><p><img src="https://media.giphy.com/media/O9BPkYr89lK2A/giphy.gif" alt="nope"></p><p>No. <code>#venting</code> 4lyfe.</p><h2 id="What-will-you-be-working-on-at-Sitecore"><a href="#What-will-you-be-working-on-at-Sitecore" class="headerlink" title="What will you be working on at Sitecore?"></a>What will you be working on at Sitecore?</h2><p>I’ll be on Team X, led by the illustrious <a href="https://twitter.com/alexshyba">Alex Shyba</a>. In other words, if I told you I’d have to kill you.</p><p><img src="https://media.giphy.com/media/u4DnvVypp0q8U/giphy.gif" alt="actually it&#39;s JSS"></p><h2 id="giphy-magic8ball-quot-Will-this-be-awesome-quot"><a href="#giphy-magic8ball-quot-Will-this-be-awesome-quot" class="headerlink" title="/giphy #magic8ball &quot;Will this be awesome?&quot;"></a><code>/giphy #magic8ball &quot;Will this be awesome?&quot;</code></h2><p><img src="https://media.giphy.com/media/3o7abB06u9bNzA8lu8/giphy.gif" alt="yes"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;I am excited to announce that I am joining the Sitecore product team as a Platform Architect! &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://media.giphy.com/m</summary>
      
    
    
    
    <category term="Sitecore" scheme="https://kamsar.net/index.php/category/Sitecore/"/>
    
    
  </entry>
  
  <entry>
    <title>Quickly add SSL to Solr</title>
    <link href="https://kamsar.net/index.php/2017/10/Quickly-add-SSL-to-Solr/"/>
    <id>https://kamsar.net/index.php/2017/10/Quickly-add-SSL-to-Solr/</id>
    <published>2017-10-23T15:20:39.000Z</published>
    <updated>2021-07-26T23:19:02.512Z</updated>
    
    <content type="html"><![CDATA[<p>There have been several people recently who I’ve seen having trouble setting up SSL for their Solr in order to use it with Sitecore 9. So, I present the following gist to you. It’s designed to automate the complete setup process of adding SSL to Solr with a self-signed certificate, and trusting that self-signed certificate. For production setups with a real certificate, it should be quite easy to modify.</p><p>It’s been tested on standalone as well as Bitnami Solr. The script requires Windows 10 to use the <code>Import-PfxCertificate</code> cmdlet; if you don’t have that you can remove the trust scripting and do it manually.</p><script src="//gist.github.com/c3c8322c1ec40eac64c7dd546e5124de.js"></script><p><img src="https://media.giphy.com/media/IB9foBA4PVkKA/giphy.gif" alt="giphy"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;There have been several people recently who I’ve seen having trouble setting up SSL for their Solr in order to use it with Sitecore 9. So</summary>
      
    
    
    
    <category term="Sitecore" scheme="https://kamsar.net/index.php/category/Sitecore/"/>
    
    
  </entry>
  
  <entry>
    <title>All about xConnect Security</title>
    <link href="https://kamsar.net/index.php/2017/10/All-about-xConnect-Security/"/>
    <id>https://kamsar.net/index.php/2017/10/All-about-xConnect-Security/</id>
    <published>2017-10-22T20:57:18.000Z</published>
    <updated>2021-07-26T23:19:02.507Z</updated>
    
    <content type="html"><![CDATA[<p>Sitecore 9 introduces the new xConnect server to the ecosystem. xConnect is an abstracted service layer that Sitecore uses for all its analytics and marketing automation features. If you’re using Sitecore XP (aka xDB), you’ll need an xConnect server if you upgrade to Sitecore 9.</p><p>xConnect is noteworthy because it introduces client certificate authentication for the Sitecore XP server to communicate with xConnect. Certificates are a complex subject, and can fail in any number of less than helpful ways. This post aims to help you understand how certificates work in Sitecore 9, and provide you some tools to diagnose what’s wrong when they are not working right. </p><h2 id="What-is-TLS"><a href="#What-is-TLS" class="headerlink" title="What is TLS?"></a>What is TLS?</h2><p>In order to understand how xConnect works, it’s important to understand what’s going on: <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security</a> (TLS). You may also think of this as “SSL” or “HTTPS.”</p><p>TLS is a protocol for establishing secure encrypted connections between a <em>server</em> and a <em>client</em>. The key aspect of TLS is that the client and server can securely exchange encryption keys in such a way that they cannot be observed by malicious parties that may be watching the exchange.</p><h2 id="Asymmetric-vs-Symmetric-Encryption"><a href="#Asymmetric-vs-Symmetric-Encryption" class="headerlink" title="Asymmetric vs Symmetric Encryption"></a>Asymmetric vs Symmetric Encryption</h2><p>To understand how TLS works, it’s important to understand the distinction between Asymmetric (also called Public Key) Encryption, and Symmetric Encryption.</p><p>If you ever made secret codes as a kid, you’ve probably used <a href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm"><em>symmetric encryption</em></a>. This is where the sender and receiver both need to know a key to decrypt the message, for example a simple <a href="https://en.wikipedia.org/wiki/Caesar_cipher">shift cipher</a> where <code>D</code> = <code>A</code>, <code>E</code> = <code>B</code>, and so forth. Julius Caesar famously sent secret messages by shifting letters three places forward like this. Symmetric encryption does have one major downfall, however: posession of the secret key lets you read any encrypted message even if not the intended recipient.</p><p><a href="https://en.wikipedia.org/wiki/Public-key_cryptography">Asymmetric encryption</a> on the other hand uses two different keys: a <em>public key</em> and a <em>private key</em>. The public key can be shared with anyone without compromising anything. However a client can use the public key to encrypt a message in such a way that it can only be decrypted <em>with the server’s private key</em>. In this way, you can receive private encrypted messages from clients you don’t share any secrets with - but they can still send the server private messages.</p><p>TLS uses <em>asymmetric encryption</em> to transfer an encryption key for <em>symmetric encryption</em>, which is used for ongoing data transfer over the encrypted connection. This is done because asymmetric encryption is much much slower than symmetric.</p><p>It’s important to understand the difference between public and private keys when you set up Sitecore 9, because they need to be deployed to different servers in your infrastructure. A <em>certificate</em> generally includes both a public and private key, however it can also include only a public key.</p><h2 id="xConnect-Setup"><a href="#xConnect-Setup" class="headerlink" title="xConnect Setup"></a>xConnect Setup</h2><p>xConnect uses <a href="https://en.wikipedia.org/wiki/Mutual_authentication">mutual authentication</a> to secure the connections between it and the Sitecore XP server. This is accomplished using <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Client-authenticated_TLS_handshake">TLS client certificates</a>.</p><p>If you’ve worked with SSL certificates before, this is a stronger form of SSL where not only does the client have to trust the server, but the server also has to trust a second certificate issued to the client. In this case, the client is the Sitecore XP server, and the server is the xConnect server. Let’s take a look at how this works:</p><h2 id="SSL-Server-Certificate-Negotiation"><a href="#SSL-Server-Certificate-Negotiation" class="headerlink" title="SSL Server Certificate Negotiation"></a>SSL Server Certificate Negotiation</h2><p>All SSL connections go through this process, whether xConnect or otherwise. In a standard Sitecore 9 XP installation, the xConnect server will have the <em>server certificate</em> installed. The Sitecore XP server will only have a server certificate if access to Sitecore itself, e.g. for administration, is done via SSL (in which case it will likely be a separate server certificate from xConnect’s).</p><ol><li>Client prepares to make a HTTPS request (e.g. you ask for <code>https://xconnect</code>)</li><li>Client sends a <em>ClientHello</em> message to the server. This proposes encryption standards, among other things.</li><li>The server replies with a <em>ServerHello</em> message back to the client. This includes the server’s <em>public key</em>, and the encryption standards that the server has selected from what the client proposed in the <em>ClientHello</em>.</li><li>The client <em>validates</em> the server certificate (e.g. must have correct domain and trusted issuer)</li><li>A symmetric encryption key is generated and exchanged using the server’s public key</li><li>Now that an encrypted connection is established, a normal HTTP request is sent over the encrypted channel</li></ol><h3 id="What-can-go-wrong-with-server-certificate-negotiation"><a href="#What-can-go-wrong-with-server-certificate-negotiation" class="headerlink" title="What can go wrong with server certificate negotiation"></a>What can go wrong with server certificate negotiation</h3><p>The most common issues are domain mismatches and untrusted certificates. Generally you can diagnose issues with server certificates using a web browser - request the site over HTTPS and review the error shown in the browser. Make sure you request the xConnect server URL, <strong>not</strong> the Sitecore XP URL if you are diagnosing an xConnect connectivity issue.</p><h4 id="Domain-Mismatches"><a href="#Domain-Mismatches" class="headerlink" title="Domain Mismatches"></a>Domain Mismatches</h4><p>A domain mismatch occurs when a certificate’s domain does not match the domain being requested. For example, a certificate issued to <code>sitecore.net</code> will fail this validation if the site you’re requesting is <code>https://foo.local</code>. Certificates may also be issued using <em>wildcards</em> (e.g. <code>*.sitecore.net</code>). Note that wildcards apply to one level of subdomains only - so in the previous example <code>sitecore.net</code> or <code>foo.sitecore.net</code> would be valid, but <code>bar.foo.sitecore.net</code> would <em>not</em> be.</p><p>Domain matching is done based on the host header the server receives. For example if the xConnect server is <code>https://xconnect</code> but can also be accessed via <code>https://127.0.0.1</code>, the certificate will be invalid if the IP address is used because the certificate was not issued for <code>127.0.0.1</code>.</p><p>If you have a domain mismatch issue, you will need to either get a new certificate (and update the xConnect IIS site(s) to use the new certificate) or change the domain for xConnect to one that is valid for the certificate.</p><h4 id="Untrusted-Certificates"><a href="#Untrusted-Certificates" class="headerlink" title="Untrusted Certificates"></a>Untrusted Certificates</h4><p>To understand trust issues, it’s important to understand how certificates are issued. Certificates are issued by other certificates.</p><img src="/index.php/2017/10/All-about-xConnect-Security/cert-issuer.jpg" class=""><p>In fact, certificates can be issued in <em>chains</em> (Xzibit would definitely approve). Trust issues occur when the certificate that issued the <em>server</em> certificate is not considered to be trusted by the <em>client</em>. On Windows, trust is established by being included in the <em>Trusted Root Certification Authorities</em> in the machine certificates:</p><img src="/index.php/2017/10/All-about-xConnect-Security/trusted-certs.png" class=""><p>Note that to trust a certificate, only the <em>public key</em> for the server certificate must be imported here. If you’re using self-signed certificates that issued themselves - like <code>localhost</code> in the screenshot - you can add the certificate itself to the trusted root certificates by exporting it and reimporting it into the root certificates. If using a commercially issued certificate, that certification authority’s root certificates must be added to the trusted root - in most cases, they are already present.</p><h4 id="More-esoteric-errors"><a href="#More-esoteric-errors" class="headerlink" title="More esoteric errors"></a>More esoteric errors</h4><p>There are some less common issues that can also cause server certificate negotiation errors. Servers will be commonly secured against supporting vulnerable <a href="https://en.wikipedia.org/wiki/RC4">ciphers</a>, <a href="https://en.wikipedia.org/wiki/SHA-1">hash algorithms</a> or <a href="https://en.wikipedia.org/wiki/POODLE">SSL protocol versions</a>. You might have heard of Heartbleed or POODLE vulnerabilities, or had to support TLS 1.2 if working with some web APIs such as SalesForce. This is a good idea, but if the server and client cannot mutually agree on a supported cipher, hash, and protocol version the connection will fail. If the certificate is trusted and has the correct domain, this would be the next thing to check.</p><p>If you’ve never heard of this before, you can secure your IIS servers using a tool like <a href="https://www.nartac.com/Products/IISCrypto">IISCrypto</a>. Go do it now, this post will wait.</p><p>Note that the .NET HTTP client with framework versions prior to 4.6.2 defaults to only supporting TLS up to 1.1. Many modern security scripts will disable all TLS protocol versions except for 1.2, which will cause HTTP requests from clients with earlier versions of the .NET framework installed to fail.</p><h2 id="SSL-Client-Certificate-Negotiation"><a href="#SSL-Client-Certificate-Negotiation" class="headerlink" title="SSL Client Certificate Negotiation"></a>SSL Client Certificate Negotiation</h2><p>Hopefully now you have a decent idea of how <em>server</em> certificates work. But xConnect also uses <em>client certificates</em>. A client certificate enables <a href="https://en.wikipedia.org/wiki/Mutual_authentication"><em>mutual authentication</em></a>. With only a server certificate, the client must decide to trust the server but the server has no way to know if it should trust the client. Enter client certificates.</p><p>A client certificate is essentially the opposite of the server certificate. When using a client certificate, the negotiation works similarly to the server certificate, except that when the server sends the <code>ServerHello</code> (#3 above) it requests a client certificate in addition to sending its public key. The client then sends the public key of its <em>client certificate</em> back to the server - and then <em>the server decides whether it should trust the client certificate</em>.</p><p>If the client certificate is not trusted, it is rejected. The rules for validating a client certificate are up to the server and do not necessarily follow the same validation rules as a server certificate on the client. In the case of xConnect:</p><ul><li>The domain/subject on the client certificate does not seem to matter to xConnect</li><li>The trusting of the certificate is done using the <em>thumbprint</em> of the certificate (a hash of the certficate which uniquely identifies it). Note that the thumbprint will change when an expired certificate is renewed, so you will need to reconfigure xConnect after renewing a client certificate so that it trusts the newer thumbprint.</li><li>The xConnect server must trust the issuer of the client certificate</li></ul><h3 id="What-can-go-wrong-with-client-certificate-negotiation"><a href="#What-can-go-wrong-with-client-certificate-negotiation" class="headerlink" title="What can go wrong with client certificate negotiation"></a>What can go wrong with client certificate negotiation</h3><p>There are a lot of things that can go wrong with the client certificate, moreso than the server certificate. When troubleshooting, make your first step the Sitecore XP logs - they generally have some basic information about a bad client cert.</p><h4 id="If-you’re-receiving-HTTP-4xx-responses"><a href="#If-you’re-receiving-HTTP-4xx-responses" class="headerlink" title="If you’re receiving HTTP 4xx responses"></a>If you’re receiving HTTP 4xx responses</h4><p>Chances are your client certificate validation failed. This could mean:</p><ul><li>The client certificate is not installed on both the Sitecore XP server and the xConnect server (the xConnect server would only need the public key)</li><li>The client certificate is not considered trusted on the xConnect server</li><li>The certificate <em>thumbprint</em> configured in the xConnect server’s <code>App_Config\ConnectionStrings.config</code> is missing or incorrect. Note that the thumbprint must be all uppercase with no spaces or colons. If copied from certificate manager, an unprintable character might prefix the thumbprint - check for a hidden character there.</li><li>The certificate <em>location</em> configured in the xConnect server’s <code>App_Config\ConnectionStrings.config</code> is incorrect. Normally the certificate should be stored in local machine certificates and have a connection string similar to <code>StoreName=My;StoreLocation=LocalMachine;FindType=FindByThumbprint;FindValue=THUMBPRINTVALUE</code>.</li></ul><h4 id="“The-certificate-was-not-found”"><a href="#“The-certificate-was-not-found”" class="headerlink" title="“The certificate was not found”"></a>“The certificate was not found”</h4><p>This indicates one of two things:</p><ul><li>The <em>thumbprint</em> is incorrect in the Sitecore XP server’s <code>App_Config\ConnectionStrings.config</code> file. Note that the thumbprint must be all uppercase with no spaces or colons. If copied from certificate manager, an unprintable character might prefix the thumbprint - check for a hidden character there.</li><li>The certificate <em>location</em> configured in the Sitecore XP server’s <code>App_Config\ConnectionStrings.config</code> is incorrect. Normally the certificate should be stored in local machine certificates and have a connection string similar to <code>StoreName=My;StoreLocation=LocalMachine;FindType=FindByThumbprint;FindValue=THUMBPRINTVALUE</code>.</li></ul><h4 id="System-Net-WebException-The-request-was-aborted-Could-not-create-SSL-TLS-secure-channel"><a href="#System-Net-WebException-The-request-was-aborted-Could-not-create-SSL-TLS-secure-channel" class="headerlink" title="System.Net.WebException: The request was aborted: Could not create SSL/TLS secure channel."></a>System.Net.WebException: The request was aborted: Could not create SSL/TLS secure channel.</h4><p><em>As long as the server certificate is valid</em>, this message is most likely that the Sitecore XP server’s IIS app pool user account does not have read access to the client certificate’s private key. This access is needed so that the Sitecore XP server can encrypt communications using its client certificate.</p><p>To remedy this issue, open the local machine certificates (“Manage computer certificates” in a start menu search) on the Sitecore XP server. Find the client certificate (normally under <code>Personal\Certificates</code>). Right click it, choose <code>All Tasks</code>, then <code>Manage Private Keys...</code>. You should get a security assignment window like this:</p><img src="/index.php/2017/10/All-about-xConnect-Security/pkey-security.png" class=""><p>Next, add your IIS app pool user to the ACLs and grant it <code>Read</code> permissions (as above). Remember if you’re using AppPoolIdentity (you should be, unless using a domain account for windows auth to SQL), you must select the account by choosing <code>Local Computer</code> as the search location, and enter <code>IIS APPPOOL\MyAppPoolsName</code> as the account name to find.</p><p>Still having issues? Well, you can also use the security audit log to find out which account is failing to get access, then add that account in the key ACLs above:</p><img src="/index.php/2017/10/All-about-xConnect-Security/key-security-audit-failure.png" class=""><h2 id="Local-Development-Tip"><a href="#Local-Development-Tip" class="headerlink" title="Local Development Tip"></a>Local Development Tip</h2><p>If you work at a Sitecore partner and will have multiple copies of Sitecore 9 running locally, this can cause issues if you issue a dedicated SSL server certificate to each site. This is because a given TCP port (e.g. 443, the default) can only have one SSL certificate bound to it. This precludes having multiple Sitecore 9 instances running together locally <em>unless they share the same SSL certificate</em>.</p><p>Wildcard certificates are perfect for this job. As long as you use the same top level suffix for all your dev sites (e.g. <code>*.local.dev</code>), you can use the same wildcard certificate for your server certificate for all dev sites. Note that IIS’ self-signed certificate generator will not create a wildcard certificate for you. You’ll have to use something else, like <a href="https://technet.microsoft.com/en-us/itpro/powershell/windows/pkiclient/new-selfsignedcertificate">New-SelfSignedCertificate</a>, to create one.</p><p>Important note: You must issue a wildcard for at least two segments of domain for it to be trusted. For example <code>*.dev</code> is bad, but <code>*.local.dev</code> is good.</p><p>Note that <em>client</em> certificates should be unique on each site, only the server certificate should be shared.</p><p>In the release version of Sitecore 9, you can also disable the requirement to use encryption with xConnect which can bypass a lot of debugging. Do not do this in production or else a herd of elephants will destroy you.</p><h2 id="Advanced-Debugging-with-Wireshark"><a href="#Advanced-Debugging-with-Wireshark" class="headerlink" title="Advanced Debugging with Wireshark"></a>Advanced Debugging with Wireshark</h2><p>It’s possible to watch the SSL negotiation at a TCP/IP level using a network monitor such as <a href="https://www.wireshark.org/">Wireshark</a>. This can provide insights on why your setup is failing when error messages are less than optimal. For example I spent a couple days diagnosing what turned out to be private key security issues. I figured this out by using Wireshark and observing that the client was never sending its client certificate after the server requested it, and figuring out why that was.</p><p>To use Wireshark to watch SSL traffic, you’ll have to set it up to decrypt traffic. <a href="https://blogs.technet.microsoft.com/nettracer/2013/10/12/decrypting-ssltls-sessions-with-wireshark-reloaded/">This guide</a> walks you through setting up decryption on Windows with an exported private key.</p><p>If you’re tracing local dev traffic (e.g. from <code>localhost</code> to <code>localhost</code>, including using your machine’s DNS name) Wireshark will not capture that unless you install <a href="https://nmap.org/npcap/">npcap</a> instead of the default <code>pcap</code> packet capture software. Once <code>npcap</code> is installed, tell Wireshark to bind to the <code>Npcap Loopback Adapter</code> to see local traffic.</p><p>Here is a screenshot of the Wireshark capture where I diagnosed the client certificate security issue:</p><img src="/index.php/2017/10/All-about-xConnect-Security/wireshark-trace.png" class=""><h2 id="Good-luck"><a href="#Good-luck" class="headerlink" title="Good luck!"></a>Good luck!</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Sitecore 9 introduces the new xConnect server to the ecosystem. xConnect is an abstracted service layer that Sitecore uses for all its an</summary>
      
    
    
    
    <category term="Sitecore" scheme="https://kamsar.net/index.php/category/Sitecore/"/>
    
    
  </entry>
  
  <entry>
    <title>Where to find Sitecore documentation</title>
    <link href="https://kamsar.net/index.php/2017/10/Where-to-find-Sitecore-documentation/"/>
    <id>https://kamsar.net/index.php/2017/10/Where-to-find-Sitecore-documentation/</id>
    <published>2017-10-22T19:29:29.000Z</published>
    <updated>2021-07-26T23:19:02.511Z</updated>
    
    <content type="html"><![CDATA[<img src="/index.php/2017/10/Where-to-find-Sitecore-documentation/keep-calm-and-rtfm.jpg" class=""><p>The land of Sitecore documentation is becoming a bit crowded these days. While at Symposium, I heard some people say they didn’t know how to keep up on new documentation - so here’s what I know. No doubt I missed some resources too, but these are the ones I usually use and follow.</p><h1 id="Official-Docs"><a href="#Official-Docs" class="headerlink" title="Official Docs"></a>Official Docs</h1><h2 id="Sitecore-Doc-Site"><a href="#Sitecore-Doc-Site" class="headerlink" title="Sitecore Doc Site"></a><a href="https://doc.sitecore.net/">Sitecore Doc Site</a></h2><p>This is the main place to find documentation for Sitecore, as well as Sitecore modules. It has a handy <a href="https://doc.sitecore.net/~/link.aspx?_id=C12C95F2683A4AF98BABA504B4701DD7&_z=z">RSS feed</a> of updated articles you should subscribe to.</p><p>Unfortunately the RSS feed is not entirely complete due to documentation microsites being proxied in under the main doc site (for example <a href="http://commercesdn.sitecore.net/SitecoreCommerce/UsersGuide/en-us/index.html">Commerce</a> and the <a href="https://doc.sitecore.net/developers/scaling-guide/">v9 Scaling Guide</a>). These statically generated sites generally do not provide their own RSS feeds, and are thus harder to track updates to.</p><h2 id="Sitecore-Knowledge-Base"><a href="#Sitecore-Knowledge-Base" class="headerlink" title="Sitecore Knowledge Base"></a><a href="https://kb.sitecore.net/">Sitecore Knowledge Base</a></h2><p>The Sitecore KB lists known issues, support resolutions, security bulletins, and other support information. Like the main doc site, it has its own <a href="https://kb.sitecore.net/en/Articles_RSS_Feed.aspx">RSS feed</a> of updated articles that is absolutely worth subscribing to.</p><h2 id="Sitecore-Helix-Docs"><a href="#Sitecore-Helix-Docs" class="headerlink" title="Sitecore Helix Docs"></a><a href="http://helix.sitecore.net/">Sitecore Helix Docs</a></h2><p>Sitecore’s official architecture guidance has its own website. Unfortunately, no RSS feed of updates.</p><h2 id="Sitecore-JSS-Docs"><a href="#Sitecore-JSS-Docs" class="headerlink" title="Sitecore JSS Docs"></a><a href="https://jss.sitecore.net/">Sitecore JSS Docs</a></h2><p>The JavaScript Services module has its own separate documentation site. Unfortunately, no RSS feed of updates.</p><h2 id="Sitecore-Dev-Site"><a href="#Sitecore-Dev-Site" class="headerlink" title="Sitecore Dev Site"></a><a href="https://dev.sitecore.net/">Sitecore Dev Site</a></h2><p>Where to go to actually download Sitecore releases and official modules such as SXA and PXM. There’s no RSS feed of new releases and updates, unfortunately.</p><h1 id="Community-run-Docs"><a href="#Community-run-Docs" class="headerlink" title="Community-run Docs"></a>Community-run Docs</h1><h2 id="Sitecore-Blog-Feed"><a href="#Sitecore-Blog-Feed" class="headerlink" title="Sitecore Blog Feed"></a><a href="http://feeds.sitecore.net/">Sitecore Blog Feed</a></h2><p>A Sitecore-run blog aggregator that serves up a fresh helping of most major Sitecore blogs. Worth subscribing to via its <a href="http://feeds.sitecore.net/Feed/LatestPosts">RSS feed</a>.</p><h2 id="Sitecore-StackExchange"><a href="#Sitecore-StackExchange" class="headerlink" title="Sitecore StackExchange"></a><a href="https://sitecore.stackexchange.com/">Sitecore StackExchange</a></h2><p>A community-driven Q&amp;A site that’s part of <a href="https://stackexchange.com/">StackExchange</a>. If you have a question about Sitecore, there are many highly active members who are happy to help here.</p><h2 id="Sitecore-Slack"><a href="#Sitecore-Slack" class="headerlink" title="Sitecore Slack"></a><a href="https://www.akshaysura.com/2015/10/27/how-to-join-sitecore-slack-community-chat/">Sitecore Slack</a></h2><p><a href="https://slack.com/">Slack</a> is a group messaging/discussion tool. The Sitecore Community Slack group has over 2,700 Sitecore developers with very active participation. If you do Sitecore, you should be here.</p><h2 id="Unofficial-Sitecore-Training"><a href="#Unofficial-Sitecore-Training" class="headerlink" title="Unofficial Sitecore Training"></a><a href="http://www.akshaysura.com/2016/02/03/unofficial-sitecore-8-training-webinar-series-full-curriculum/">Unofficial Sitecore Training</a></h2><p>Community run unofficial training videos that cover development practices that are commonly used, but not covered in official Sitecore training. More opinionated, influenced heavily by real-world implementation experiences.</p><h2 id="Sitecore-Community-Docs"><a href="#Sitecore-Community-Docs" class="headerlink" title="Sitecore Community Docs"></a><a href="https://sitecore-community.github.io/docs/">Sitecore Community Docs</a></h2><p>Unofficial documentation. Not updated that often any longer but still some good information, especially the article on <a href="http://sitecore-community.github.io/docs/documentation/Sitecore%20Fundamentals/Patch%20Files/">config patching</a>.</p><h2 id="Sitecore-Powershell-Extensions-Docs"><a href="#Sitecore-Powershell-Extensions-Docs" class="headerlink" title="Sitecore Powershell Extensions Docs"></a><a href="https://sitecorepowershell.gitbooks.io/sitecore-powershell-extensions/">Sitecore Powershell Extensions Docs</a></h2><p>The SPE documentation is so complete that it’s worth mentioning even though it’s for a single Sitecore module.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/index.php/2017/10/Where-to-find-Sitecore-documentation/keep-calm-and-rtfm.jpg&quot; class=&quot;&quot;&gt;

&lt;p&gt;The land of Sitecore documentation i</summary>
      
    
    
    
    <category term="Sitecore" scheme="https://kamsar.net/index.php/category/Sitecore/"/>
    
    
  </entry>
  
  <entry>
    <title>Unicorn 4 Released</title>
    <link href="https://kamsar.net/index.php/2017/06/Unicorn-4-Released/"/>
    <id>https://kamsar.net/index.php/2017/06/Unicorn-4-Released/</id>
    <published>2017-06-22T19:57:43.000Z</published>
    <updated>2021-07-26T23:19:02.506Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://kamsar.net/nuget/unicorn/logo.png" alt="unicorn"></p><p>I’m happy to announce the final release of Unicorn 4.0! Unicorn 4 comes with significant performance and developer experience improvements, along with bug fixes. Unicorn 4 is available from NuGet or <a href="https://github.com/kamsar/Unicorn/releases/tag/4.0.0">GitHub</a>.</p><h1 id="Project-Dilithium-and-Performance"><a href="#Project-Dilithium-and-Performance" class="headerlink" title="Project Dilithium and Performance"></a>Project Dilithium and Performance</h1><p>Unicorn 4 is faster - a lot faster. Check out these benchmarks:</p><p><img src="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Project-Dilithium/perf.png" alt="performance benchmarks"></p><p>The speed increase is due to optimized caching routines, as well as the <em>Dilithium</em> batch processors. Dilithium is an optional feature that is off by default: because of its newness, it’s still experimental. I’m using it in production though. Give it a try - it can always be turned off without hurting anything.</p><p>For more detail into how Unicorn 4 is faster, and what Dilithium does, <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Project-Dilithium/">check out this detailed blog post</a>.</p><h1 id="Improved-Modular-Configuration"><a href="#Improved-Modular-Configuration" class="headerlink" title="Improved Modular Configuration"></a>Improved Modular Configuration</h1><p>Unicorn 4 features a refactored configuration system that is designed to support <a href="http://helix.sitecore.net/">Sitecore Helix</a> projects with an improved configuration experience. The new config system is completely backwards-compatible, but now enables <em>configuration inheritance</em>, <em>configuration variables</em>, and <em>configuration extension</em> so that modular projects can encode their conventions (e.g. paths to include, physical paths) into one base config and all the module configs can extend it.</p><p>This drastically reduces the verbosity of the module configurations, and improves their maintainability by allowing conventions to be <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>. Here’s a very simple example of a base conventions configuration:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">name</span>=<span class="string">&quot;Habitat.Feature.Base&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">targetDataStore</span> <span class="attr">physicalRootPath</span>=<span class="string">&quot;$(sourceFolder)\$(layer)\$(module)\serialization&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">predicate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;$(layer).$(module).Templates&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/templates/$(layer)/$(module)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">predicate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>And here’s a module configuration that extends it:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> </span></span><br><span class="line"><span class="tag"><span class="attr">name</span>=<span class="string">&quot;Feature.News&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">extends</span>=<span class="string">&quot;Habitat.Feature.Base&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- automatically stores items at $(sourceFolder)\Feature\News\serialization --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- automatically includes /sitecore/templates/Feature/News --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>There’s a lot more that you can do with the configuration enhancements in Unicorn 4 too. For additional details, <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Part-III-Configuration-Enhancements/">read this extensive blog post</a>.</p><h1 id="Sitecore-PowerShell-Extensions-Support"><a href="#Sitecore-PowerShell-Extensions-Support" class="headerlink" title="Sitecore PowerShell Extensions Support"></a>Sitecore PowerShell Extensions Support</h1><p><img src="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/spe.png" alt="unicorn + spe"></p><p>Just about anything you can do with Unicorn can now be automated using Sitecore PowerShell Extensions in Unicorn 4. You can now run Unicorn SPE cmdlets to…</p><ul><li>Run a sync</li><li>Serialize an item or tree of items</li><li>Dump an item to YAML in the console</li><li><a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-5-Generating-Packages-with-SPE/">Create a Sitecore package of all the items in a Unicorn configuration</a></li><li>And there’s more, all <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/">in this blog post</a> - and <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-5-Generating-Packages-with-SPE/">this one, about packaging</a></li></ul><h1 id="Console-Output-Scaling"><a href="#Console-Output-Scaling" class="headerlink" title="Console Output Scaling"></a>Console Output Scaling</h1><p>The Unicorn console has received a serious upgrade in Unicorn 4. If you’ve ever run a sync that changed a large number of items from the Unicorn Control Panel, you may have noticed the browser slow to a crawl and the sync seem to almost stop. The console that underpins Unicorn 3 and earlier started to choke at around 500 lines.</p><p>No longer! Unicorn 4’s upgraded console has spit out 100,000 lines without a hitch, and it should scale beyond that.</p><p>The automated tool console (PowerShell API) has also received an upgrade. Previously the tool console buffered all the output of a sync before sending it back. This caused problems in certain environments, namely Azure, where TCP connections that don’t send any data for more than four minutes are terminated. This would cause long-running syncs in Azure to die unexpectedly.</p><p>In Unicorn 4 the automated tool console emits data in a stream just like the control panel console. There’s also a heartbeat timer where if no new console entries are made for 30 seconds, a <code>.</code> will be sent to make sure the connection is kept active.</p><p>The streaming tool console also requires updating your <code>Unicorn.psm1</code> file - not only will you get defense against TCP timeouts, you’ll also be able to see the sync occur in real time using the PSAPI just like you would from the control panel. No more waiting until it’s done to see how things are going :)</p><h1 id="Predicates-can-Exclude-by-Template-ID-or-Name"><a href="#Predicates-can-Exclude-by-Template-ID-or-Name" class="headerlink" title="Predicates can Exclude by Template ID or Name"></a>Predicates can Exclude by Template ID or Name</h1><p>Unicorn 4 can now exclude items from a configuration by template ID, thanks to <a href="https://alan-null.github.io/2017/03/custom-unicorn-predicate">Alan Płócieniak</a>. See also <a href="https://alan-null.github.io/2017/03/custom-unicorn-predicate">Alan’s original post</a> on the technique.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Template ID&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/allowed&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclude</span> <span class="attr">templateId</span>=<span class="string">&quot;&#123;3B4F2B85-778D-44F3-9B2D-BEFF1F3575E6&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure><p>You can also exclude items by a regular expression of their name. This enables scenarios such as wanting to include all templates, but exclude all <code>__Standard values</code> items.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Name pattern&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/namepattern&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclude</span> <span class="attr">namePattern</span>=<span class="string">&quot;^__Standard values$&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure><p>The complete grammar for predicates is always in the <a href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn.Tests/Predicates/TestConfiguration.xml#L32">predicate test config</a>.</p><h1 id="Breaking-Changes"><a href="#Breaking-Changes" class="headerlink" title="Breaking Changes"></a>Breaking Changes</h1><p>Unicorn 4’s breaking changes do not break any common use-cases of Unicorn, but review them to see if they affect you.</p><ul><li>The <code>__Originator</code> field is now <a href="https://github.com/kamsar/Unicorn/commit/f7d073b255891ec487e9a092fb2fa172ea77b9ac">serialized by default</a>. This enables proper tracking of the origin of items instantiated from branch templates.</li><li>Multithreaded sync support has been removed due to Sitecore bugs preventing realistic use. This was disabled by default already. Dilithium is faster than multithread sync ever was.</li><li>The Rainbow <code>UseLegacyAttributeFormatting</code> (formats items in Unicorn &lt; 3.1 format) setting has been removed. The new format is now always used. This has always been off by default.</li><li>Rainbow <code>FieldComparer</code>s are no longer activated using the Sitecore Factory, so they only support parameterless constructors (this would only affect custom comparers; the stock ones have always been parameterless)</li><li>Due to the console upgrades, a new <code>Unicorn.psm1</code> is required if you are using Unicorn’s PowerShell API. This file also now ships in the NuGet package, so you can be sure you’re getting the right version for your Unicorn.</li></ul><h1 id="Bug-Fixes"><a href="#Bug-Fixes" class="headerlink" title="Bug Fixes"></a>Bug Fixes</h1><ul><li>Transparent sync misc fixes (to renaming, saving display names, instantiating branch templates into TpSync areas)</li><li>Renaming an item and changing fields on it in one operation (only possible with Sitecore API) now no longer loses the additional field data in the serialized item</li><li>Improved output and logging, clarified messaging, improved developer experience</li><li>Content editor warnings now handle items in more than one configuration correctly</li><li>Control panel now displays which paths are invalid when initial serialization is blocked due to invalid include paths</li><li>The required password length for user serialization is now configurable, should you really really want to use <code>b</code></li><li>Using Fast Query while any Transparent Sync configuration is active will now log a warning to the Sitecore logs (fast query cannot find transparent sync items, so items may not be returned as expected). This can be disabled if your logs start to fill with spam and you understand the issue.</li><li>PowerShell API now defaults to not write secrets to the console (debug is off by default) for secure-by-default-ness</li><li>Fixed a background exception that could occur when modifying serialized items on disk in rare cases, which could cause the app pool to terminate <a href="https://github.com/kamsar/Unicorn/issues/222">#222</a></li><li>The Rainbow data cache now correctly invalidates if an item is moved or renamed on disk after being added to the cache</li><li>Choosing many configurations to sync will no longer push the sync button off the page <a href="https://github.com/kamsar/Unicorn/pull/232">#232</a></li><li>The default console logging level for interactive syncing has been changed from Info to Debug, since there is no longer a scaling issue with the console output. This provides better insights into what has been changed on items without needing to see the Sitecore logs</li></ul><h1 id="Upgrading"><a href="#Upgrading" class="headerlink" title="Upgrading"></a>Upgrading</h1><p>If you’re coming from classical Unicorn 3.1 or later, upgrading is actually really simple: just upgrade your NuGet package. Unicorn 4 changes nothing about storage or formatting (except that the <code>__Originator</code> field is no longer ignored by default), so all existing serialized items are compatible.</p><p>If you’re invoking Unicorn via its remote PowerShell API, make sure to upgrade your <code>Unicorn.psm1</code> to the Unicorn 4 version to ensure correct error handling with the streaming console.</p><h1 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h1><p>Thank you to the community members who contributed code and bug reports to this release.</p><ul><li><a href="https://github.com/chemaxa">chemaxa</a></li><li><a href="https://github.com/Rclemens">Raymond Clemens</a></li><li><a href="https://github.com/niles11">Niles11</a></li><li><a href="https://github.com/lordstyx">Luuk Ostendorf</a></li><li><a href="https://github.com/alan-null">Alan Płócieniak</a></li><li><a href="https://github.com/JamesSkemp">James Skemp</a></li><li><a href="https://github.com/t00ki">t00ki</a></li><li><a href="https://github.com/WimVergouwe">Wim Vergouwe</a></li></ul><h1 id="Address"><a href="#Address" class="headerlink" title="Address"></a>Address</h1><img src="/index.php/2017/06/Unicorn-4-Released/Elephant.jpg" class="" title="early design for Unicorn 5">]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://kamsar.net/nuget/unicorn/logo.png&quot; alt=&quot;unicorn&quot;&gt;&lt;/p&gt;
&lt;p&gt;I’m happy to announce the final release of Unicorn 4.0! Unicor</summary>
      
    
    
    
    <category term="Unicorn" scheme="https://kamsar.net/index.php/category/Unicorn/"/>
    
    
  </entry>
  
  <entry>
    <title>Simplifying Contact Facets with C# 6</title>
    <link href="https://kamsar.net/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/"/>
    <id>https://kamsar.net/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/</id>
    <published>2017-06-02T17:04:08.000Z</published>
    <updated>2021-07-26T23:19:02.506Z</updated>
    
    <content type="html"><![CDATA[<p>Contact Facets allow you to persist information about visitors into the Sitecore xDB. We’re not going to get into the theory behind them in this post; for that go read Pete Navarra’s <a href="https://sitecorehacker.com/2016/09/03/creating-custom-sitecore-xdb-contact-facets/">great blog post</a> that summarizes current practices and how to add facets.</p><p>Today we’re going to discuss how to syntactically improve the declaration of a contact facet class using syntaxes available in C# 6.0 (VS 2015) and C# 7.0 (VS 2017). It’s important to note that the C# version is decoupled from the .NET framework version: the C# 7.0 compiler is perfectly capable of emitting C# 7 syntax to a .NET 4.5-targeted assembly, for instance. So you can use these modern language features as long as you’ve got the right version of MSBuild or Visual Studio :)</p><p>Here’s the example Pete uses in his post, which follows <a href="https://community.sitecore.net/technical_blogs/b/getting_to_know_sitecore/posts/introducing-contact-facets">other examples</a> out there as well:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SitecoreHacker.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> CUSTOMER_ID = <span class="string">&quot;CustomerId&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> SEGEMENT = <span class="string">&quot;Segment&quot;</span>; <span class="comment">// sic :p</span></span><br><span class="line"> </span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Properties</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(CUSTOMER_ID); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(CUSTOMER_ID, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(SEGEMENT); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(SEGEMENT, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(CUSTOMER_ID);</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(SEGEMENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As you can see, the facet API requires string keys for the facet values - in this case stored as <code>const string</code> - to get and set them. Further, as Pete notes:</p><blockquote><p>I found out the hard way that the constants defined, the value must equal the actual name of the class property for the same attribute.</p></blockquote><p>Well in C# 6 (VS 2015), there’s a syntax for that. The <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/nameof"><code>nameof</code></a> statement allows you to get the string name of a variable or property. This essentially hands off the management and maintenance of the <code>const</code> value to the compiler, instead of the developer.</p><p>So we can clean up this example by using <code>nameof</code> instead of constants - and get as a bonus refactoring support and compile-time validation of the names:</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Elephant.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId)); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(<span class="keyword">nameof</span>(CustomerId), <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment)); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(<span class="keyword">nameof</span>(Segment), <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Finally if you have C# 7.0 (VS 2017), you can also utilize <a href="https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/">expression bodied members</a> to further clean up the property syntax:</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Rhino.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// expression bodied members turn the single-expression get </span></span><br><span class="line">            <span class="comment">// into a lamdba-style syntax, removing the need for braces</span></span><br><span class="line">            <span class="keyword">get</span> =&gt; GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            <span class="keyword">set</span> =&gt; SetAttribute(<span class="keyword">nameof</span>(CustomerId), <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> =&gt; GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">            <span class="keyword">set</span> =&gt; SetAttribute(<span class="keyword">nameof</span>(Segment), <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So there - now go forth and put your data in the xDB :)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Contact Facets allow you to persist information about visitors into the Sitecore xDB. We’re not going to get into the theory behind them </summary>
      
    
    
    
    <category term="Sitecore" scheme="https://kamsar.net/index.php/category/Sitecore/"/>
    
    <category term="xDB" scheme="https://kamsar.net/index.php/category/Sitecore/xDB/"/>
    
    
  </entry>
  
  <entry>
    <title>Unicorn 4 Part III: Configuration Enhancements</title>
    <link href="https://kamsar.net/index.php/2017/02/Unicorn-4-Part-III-Configuration-Enhancements/"/>
    <id>https://kamsar.net/index.php/2017/02/Unicorn-4-Part-III-Configuration-Enhancements/</id>
    <published>2017-02-28T03:03:31.000Z</published>
    <updated>2021-07-26T23:19:02.505Z</updated>
    
    <content type="html"><![CDATA[<p>TL;DR: <a href="https://www.nuget.org/packages/Unicorn.Core/4.0.0-pre03">Unicorn 4 prerelease</a> is on NuGet right now!</p><p>Now that that’s out of the way, let’s talk about another new Unicorn 4 feature: <a href="http://helix.sitecore.net/">modular architecture</a> friendly configurations. </p><img src="/index.php/2017/02/Unicorn-4-Part-III-Configuration-Enhancements/everywhere.jpg" class=""><p>When <a href="https://github.com/Sitecore/Habitat">Habitat</a> first launched, I was mildly incredulous at the amount of duplication in its Unicorn configurations. Tons of tiny modules, all of which shared similar but not identical configurations (such as custom root folders) was not really a consideration when multiple configurations were originally conceived. Fast forward to today, and that’s a major use case that is more difficult than it needs to be.</p><p>Here’s an example of a Habitat Unicorn configuration:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">xmlns:patch</span>=<span class="string">&quot;http://www.sitecore.net/xmlconfig/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">sitecore</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">unicorn</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configurations</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;Feature.News&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">description</span>=<span class="string">&quot;Feature News&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">dependencies</span>=<span class="string">&quot;Foundation.Serialization,Foundation.Indexing&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">patch:after</span>=<span class="string">&quot;configuration[@name=&#x27;Foundation.Serialization&#x27;]&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">targetDataStore</span> <span class="attr">physicalRootPath</span>=<span class="string">&quot;$(sourceFolder)\feature\news\serialization&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">type</span>=<span class="string">&quot;Rainbow.Storage.SerializationFileSystemDataStore, Rainbow&quot;</span> <span class="attr">useDataCache</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">singleInstance</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">predicate</span> <span class="attr">type</span>=<span class="string">&quot;Unicorn.Predicates.SerializationPresetPredicate, Unicorn&quot;</span> <span class="attr">singleInstance</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Feature.News.Templates&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/templates/Feature/News&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Feature.News.Renderings&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/layout/renderings/Feature/News&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Feature.News.Media&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/media library/Feature/News&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">predicate</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">roleDataStore</span> <span class="attr">type</span>=<span class="string">&quot;Unicorn.Roles.Data.FilesystemRoleDataStore, Unicorn.Roles&quot;</span> <span class="attr">physicalRootPath</span>=<span class="string">&quot;$(sourceFolder)\feature\news\serialization\Feature.News.Roles&quot;</span> <span class="attr">singleInstance</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">rolePredicate</span> <span class="attr">type</span>=<span class="string">&quot;Unicorn.Roles.RolePredicates.ConfigurationRolePredicate, Unicorn.Roles&quot;</span> <span class="attr">singleInstance</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">domain</span>=<span class="string">&quot;modules&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;^Feature News .*$&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">rolePredicate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configurations</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">unicorn</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">sitecore</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It’s long and it has a ton of boilerplate that is either identical in every module, or else defined by system conventions (e.g. physicalRootPath). We don’t need to be that verbose when using Unicorn 4. When we setup a modular, convention-based system using Unicorn 4 we can start by using <em>abstract configurations</em> to define the conventions of our system:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">name</span>=<span class="string">&quot;Habitat.Feature.Base&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">targetDataStore</span> <span class="attr">physicalRootPath</span>=<span class="string">&quot;$(sourceFolder)\$(layer)\$(module)\serialization&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">predicate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;$(layer).$(module).Templates&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/templates/$(layer)/$(module)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;$(layer).$(module).Renderings&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/layout/renderings/$(layer).$(module)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;$(layer).$(module).Media&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/media library/$(layer).$(module)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">predicate</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">roleDataStore</span> <span class="attr">type</span>=<span class="string">&quot;Unicorn.Roles.Data.FilesystemRoleDataStore, Unicorn.Roles&quot;</span> <span class="attr">physicalRootPath</span>=<span class="string">&quot;$(sourceFolder)\$(layer)\$(module)\serialization\$(layer).$(module).Roles&quot;</span> <span class="attr">singleInstance</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rolePredicate</span> <span class="attr">type</span>=<span class="string">&quot;Unicorn.Roles.RolePredicates.ConfigurationRolePredicate, Unicorn.Roles&quot;</span> <span class="attr">singleInstance</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">domain</span>=<span class="string">&quot;modules&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;^$(layer) $(module) .*$&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">rolePredicate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>This configuration defines a configuration that other configurations can <em>extend</em>. Because of its <code>abstract</code>-ness it is not a Unicorn configuration itself, only a template. Non-abstract configurations may also be extended.</p><p>This abstract configuration is also making use of Unicorn 4’s ability to do <em>variable replacement</em> in configurations. The <code>$(layer)</code> and <code>$(module)</code> variables are expanded in the extending configuration and are based on the convention of naming your configurations <code>Layer.Module</code>. You can also expand <a href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn/Standard%20Config%20Files/Unicorn.CustomSerializationFolder.config.example#L42">more than one config per module</a> and <a href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn/Standard%20Config%20Files/Unicorn.config#L190">use your own variables</a>. Using our abstract <code>Habitat.Feature.Base</code> configuration above, the same <code>Feature.News</code> configuration we started with can now be expressed much more simply:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> </span></span><br><span class="line"><span class="tag"><span class="attr">name</span>=<span class="string">&quot;Feature.News&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">description</span>=<span class="string">&quot;Feature News&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">dependencies</span>=<span class="string">&quot;Foundation.Serialization,Foundation.Indexing&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">extends</span>=<span class="string">&quot;Habitat.Feature.Base&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Nice huh? But what if you want to extend or replace a dependency in the inherited configuration? You can do that, too - and using Unicorn 4’s element inheritance system you can also do it very cleanly. Unicorn configurations have always been architecturally a set of independent IoC containers. The <code>&lt;defaults&gt;</code> node in <code>Unicorn.config</code> sets up the defaults, and then each configuration’s nodes override and replace the defaults if they exist. This is how you can <a href="https://github.com/kamsar/Unicorn/blob/master/src/Unicorn/Standard%20Config%20Files/Unicorn.Configs.NewItemsOnly.example">deploy only new items</a> with the <code>NewItemsOnlyEvaluator</code> - you’re replacing the default evaluator with a different dependency implementation.</p><p>Unicorn 4 takes this a step further: with config inheritance, dependencies can be partially extended at an element level. You might have noticed this already in the <code>Habitat.Feature.Base</code> configuration, when we did this:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">targetDataStore</span> <span class="attr">physicalRootPath</span>=<span class="string">&quot;$(sourceFolder)\$(layer)\$(module)\serialization&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>In Unicorn 3, this would have required a <code>type</code> attribute. In Unicorn 4, <em>unless</em> you specify a <code>type</code> attribute, any attributes you add either replace or add to the default (or inherited) implementation. So instead this kept the same default dependency definition and <em>changed</em> an attribute on it - the <code>physicalRootPath</code>. </p><p>If you <em>do</em> specify a <code>type</code>, nothing is inherited and it works like Unicorn 3. Thus existing configurations will also work without modification :)</p><p>But what about things that have more than just attributes, like the <code>predicate</code>‘s <code>include</code> nodes? You can <em>append</em> elements in the inherited configuration in that case. If we take our <code>Habitat.Feature.Base</code> configuration above and extend it like this:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">predicate</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Foo&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/Foo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">predicate</span>&gt;</span></span><br></pre></td></tr></table></figure><p>The end result is effectively:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">predicate</span> <span class="attr">type</span>=<span class="string">&quot;Unicorn.Predicates.SerializationPresetPredicate, Unicorn&quot;</span> <span class="attr">singleInstance</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Feature.News.Templates&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/templates/Feature/News&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Feature.News.Renderings&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/layout/renderings/Feature/News&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Feature.News.Media&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/media library/Feature/News&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">&quot;Foo&quot;</span> <span class="attr">database</span>=<span class="string">&quot;master&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/sitecore/Foo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">predicate</span>&gt;</span></span><br></pre></td></tr></table></figure><p>You cannot remove inherited predicate nodes (or other dependencies that use children like <code>fieldFilter</code>), so plan accordingly: adding elements only.</p><p>And there you have it: with Unicorn 4 you can reasonably simply create serialization conventions for your modules and avoid configuration duplication - or if you’re not ready to go modular, you can at least enjoy not needing to have a <code>type</code> on most configuration nodes.</p><h2 id="But-Wait-There’s-More-🐘-The-Console-No-Longer-Sucks"><a href="#But-Wait-There’s-More-🐘-The-Console-No-Longer-Sucks" class="headerlink" title="But Wait, There’s More 🐘: The Console No Longer Sucks"></a>But Wait, There’s More 🐘: The Console No Longer Sucks</h2><h3 id="In-the-Control-Panel…"><a href="#In-the-Control-Panel…" class="headerlink" title="In the Control Panel…"></a>In the Control Panel…</h3><p>The Unicorn console has also received a serious upgrade in Unicorn 4. If you’ve ever run a sync that changed a large number of items from the Unicorn Control Panel, you may have noticed the browser slow to a crawl and the sync seem to almost stop. The console that underpins Unicorn 3 and earlier started to choke at around 500 lines. </p><p>No longer! Unicorn 4’s console has spit out <strong>100,000</strong> lines without a hitch.</p><h3 id="Automated-Tools-PowerShell-API"><a href="#Automated-Tools-PowerShell-API" class="headerlink" title="Automated Tools (PowerShell API)"></a>Automated Tools (PowerShell API)</h3><p>The automated tool console has also received an upgrade. Previously the tool console buffered all the output of a sync before sending it back. This caused problems in certain environments, namely Azure, where TCP connections that don’t send any data for more than 4 minutes are terminated. This would cause any long-running syncs in Azure to die unexpectedly.</p><p>In Unicorn 4 the automated tool console emits data in a stream just like the control panel console. There’s also a heartbeat timer where if no new console entries are made for 30 seconds, a <code>.</code> will be sent to make sure the connection is kept active. </p><p>The streaming console also requires updating your <code>Unicorn.psm1</code> file - not only will you get defense against TCP timeouts, you’ll also be able to see the sync occur in real-time using the PSAPI just like you would from the control panel. No more waiting until it’s done to see how things are going :)</p><h2 id="Can-I-have-it-yet"><a href="#Can-I-have-it-yet" class="headerlink" title="Can I have it yet?"></a>Can I have it yet?</h2><p>Absolutely. You can find <a href="https://www.nuget.org/packages/Unicorn/4.0.0-pre03">Unicorn 4.0.0-pre03</a> on NuGet right now!</p><h3 id="How-stable-is-this"><a href="#How-stable-is-this" class="headerlink" title="How stable is this?"></a>How stable is this?</h3><p>More stable than you might think. Unicorn 4 is largely additions, fixes, and enhancements to the already stable codebase behind Unicorn 3. The core pieces have not changed very much, unless you enable Dilithium and that’s optional. The new config inheritance stuff has 97% code coverage. That’s not to say it’s bug free either. If you find bugs <a href="https://github.com/kamsar/Unicorn/issues">let me know</a> and I’ll fix them :)</p><h3 id="What-about-installing-it"><a href="#What-about-installing-it" class="headerlink" title="What about installing it?"></a>What about installing it?</h3><p>Installation is just like Unicorn 3: Install the <code>Unicorn</code> NuGet package, and follow the directions in the README that will launch on installation to set up configuration(s).</p><p>NOTE: <a href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Project-Dilithium/">Dilithium</a> ships disabled by default. If you want to enable it, make a <em>copy</em> of <code>Unicorn.Dilithium.config.example</code> and enable it.</p><h3 id="What-about-upgrading-to-it"><a href="#What-about-upgrading-to-it" class="headerlink" title="What about upgrading to it?"></a>What about upgrading to it?</h3><p>If you’re coming from classical Unicorn 3.1 or later, upgrading is actually really simple: just upgrade your NuGet package. Unicorn 4 changes nothing about storage or formatting (<em>except</em> that the <code>__Originator</code> field is no longer ignored by default), so all existing serialized items are compatible.</p><p>Taking advantage of the config enhancements detailed above is also entirely optional: Unicorn 3 configurations are totally readable by Unicorn 4.</p><p>If you’re invoking Unicorn via its PowerShell API, make sure to upgrade your <code>Unicorn.psm1</code> to the Unicorn 4 version to ensure correct error handling with the streaming console.</p><p>Have fun!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;TL;DR: &lt;a href=&quot;https://www.nuget.org/packages/Unicorn.Core/4.0.0-pre03&quot;&gt;Unicorn 4 prerelease&lt;/a&gt; is on NuGet right now!&lt;/p&gt;
&lt;p&gt;Now that </summary>
      
    
    
    
    <category term="Unicorn" scheme="https://kamsar.net/index.php/category/Unicorn/"/>
    
    
  </entry>
  
  <entry>
    <title>Unicorn 4 Preview Part 2.5: Generating Unicorn Packages with SPE</title>
    <link href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-5-Generating-Packages-with-SPE/"/>
    <id>https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-5-Generating-Packages-with-SPE/</id>
    <published>2017-02-12T05:09:02.000Z</published>
    <updated>2021-07-26T23:19:02.504Z</updated>
    
    <content type="html"><![CDATA[<p><a href="/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/">Last time</a> we talked about how Sitecore PowerShell Extensions support was coming to Unicorn 4. This time, we’ve got a new cmdlet to share.</p><p>Over time, many people have asked if there was a way to generate Sitecore packages from Unicorn. The answer has always been no, for many good reasons: packages install slowly, cannot ignore specific fields, or process advanced exclusions like a Unicorn predicate can. This makes them much less safe (and much slower) for deployment purposes compared to a remotely invoked Sync using deployed serialized items.</p><p>But there is a great use case for generating packages from Unicorn: authoring modules. As a module author, a method is needed to track the items that belong to your module and also to reliably create Sitecore packages for distribution of your module which contain those items. Unicorn is a natural fit for simply tracking module items, but it has lacked the ability to automatically push updates to release packages like it can to serialized items. This unnecessarily complicates things and reduces release reliability. That’s bad.</p><p>So when <a href="https://twitter.com/MichaelWest101">Michael West</a> and <a href="https://twitter.com/adamnaj">Adam Najmanowicz</a>, the authors of Sitecore PowerShell Extensions, asked if there was a way we could export Unicorn configurations to packages my answer was <em>absolutely.</em></p><p>SPE has long had <a href="https://doc.sitecorepowershell.com/appendix/commands/Export-Package.html#examples">packaging support</a> built into it, and in fact SPE’s release packages are built using SPE. Unicorn packaging support is also implemented through SPE, and here’s how it works:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a new Sitecore Package (SPE cmdlet)</span></span><br><span class="line"><span class="variable">$pkg</span> = <span class="built_in">New-Package</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the Unicorn Configuration(s) we want to package</span></span><br><span class="line"><span class="variable">$configs</span> = <span class="built_in">Get-UnicornConfiguration</span> <span class="string">&quot;Foundation.*&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Pipe the configs into New-UnicornItemSource </span></span><br><span class="line"><span class="comment"># to process them and add them to the package project</span></span><br><span class="line"><span class="comment"># (without -Project, this would emit the source object(s) </span></span><br><span class="line"><span class="comment">#   which can be manually added with $pkg.Sources.Add())</span></span><br><span class="line"><span class="variable">$configs</span> | <span class="built_in">New-UnicornItemSource</span> <span class="literal">-Project</span> <span class="variable">$pkg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Export the package to a zip file on disk</span></span><br><span class="line"><span class="built_in">Export-Package</span> <span class="literal">-Project</span> <span class="variable">$pkg</span> <span class="literal">-Path</span> <span class="string">&quot;C:\foo.zip&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>And when you’re done with that, <code>c:\foo.zip</code> would contain a package that when installed will contain the entire contents of any Unicorn configuration matching <code>Foundation.*</code>.</p><p><code>New-UnicornItemSource</code> also accepts parameters to specify package installation options, exactly like SPE’s <a href="https://doc.sitecorepowershell.com/appendix/commands/New-ExplicitItemSource.html">New-ExplicitItemSource</a>. This cmdlet is also very similar to how <code>New-UnicornItemSource</code> works: each item that is included in the configuration is added to the package as an explicit item source. Doing this also means that the exported package completely respects the Unicorn Predicate, including exclusions of child paths (note that if you specify <code>-InstallMode Overwrite</code>, excluded children may be deleted by the package).</p><h2 id="Questions"><a href="#Questions" class="headerlink" title="Questions?"></a>Questions?</h2><h3 id="Are-the-packaged-items-pulled-directly-from-the-serialized-items"><a href="#Are-the-packaged-items-pulled-directly-from-the-serialized-items" class="headerlink" title="Are the packaged items pulled directly from the serialized items?"></a>Are the packaged items pulled directly from the serialized items?</h3><p>No, they are pulled from the Sitecore database because the Sitecore packaging APIs work in <code>Item</code>s. So make sure to <em>sync</em> before you generate a package. Unless you’re using Transparent Sync in which case the items will already be up to date.</p><h3 id="Should-I-use-this-to-deploy-my-site"><a href="#Should-I-use-this-to-deploy-my-site" class="headerlink" title="Should I use this to deploy my site?"></a>Should I use this to deploy my site?</h3><p>No. As mentioned above, packages are a slower and more dangerous method to deploy item updates to your site.</p><h3 id="Does-this-mean-modules-will-start-requiring-Unicorn-🐘"><a href="#Does-this-mean-modules-will-start-requiring-Unicorn-🐘" class="headerlink" title="Does this mean modules will start requiring Unicorn? 🐘"></a>Does this mean modules will start requiring Unicorn? 🐘</h3><p>No. Unicorn would only be used in the development of the module, and the build process used to generate plain old Sitecore Packages for module releases. The module itself would need depend on neither Unicorn, Rainbow, or SPE.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/&quot;&gt;Last time&lt;/a&gt; we talked about how Sitecore PowerShell Extensions suppo</summary>
      
    
    
    
    <category term="Unicorn" scheme="https://kamsar.net/index.php/category/Unicorn/"/>
    
    
  </entry>
  
  <entry>
    <title>Where&#39;s the comments?</title>
    <link href="https://kamsar.net/index.php/2017/02/Where-s-the-comments/"/>
    <id>https://kamsar.net/index.php/2017/02/Where-s-the-comments/</id>
    <published>2017-02-07T03:20:50.000Z</published>
    <updated>2021-07-26T23:19:02.504Z</updated>
    
    <content type="html"><![CDATA[<p>Because of low utilization and the fact that Disqus is about to start <a href="http://www.daedtech.com/im-quitting-disqus/">spamming you with wonderful ads</a>, I’ve decided to turn comments off on my blog. </p><p>That’s not to say you’re not allowed to comment, because you can <a href="https://twitter.com/kamsar">tweet</a> your comments or join <a href="https://www.akshaysura.com/2015/10/27/how-to-join-sitecore-slack-community-chat/">Sitecore Community Slack</a> and comment all day.</p><p>In other news the blog is now fully SSL enabled, courtesy of <a href="https://www.cloudflare.com/">CloudFlare</a>.</p><p>Happy hacking!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Because of low utilization and the fact that Disqus is about to start &lt;a href=&quot;http://www.daedtech.com/im-quitting-disqus/&quot;&gt;spamming you </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Unicorn 4 Preview, Part 2: SPE Support</title>
    <link href="https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/"/>
    <id>https://kamsar.net/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/</id>
    <published>2017-02-06T23:16:03.000Z</published>
    <updated>2021-07-26T23:19:02.501Z</updated>
    
    <content type="html"><![CDATA[<p>Unicorn 4 will feature full support for <a href="https://www.gitbook.com/book/sitecorepowershell/sitecore-powershell-extensions/details">Sitecore PowerShell Extensions</a> (SPE) to perform Unicorn actions. If you’ve ever wanted deep programmatic control over Unicorn (for example “I want to sync Foundation.*”), or if you’ve got an existing deployment process that’s already using SPE Remoting to perform deployment tasks - this is for you.</p><img src="/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/spe.png" class=""><p>To use Unicorn cmdlets in SPE, all that is necessary is to install the SPE package along with Unicorn. Unicorn 4 comes with configuration that remains quiescent until SPE is installed that will automatically enable the Unicorn cmdlets. In case that’s not clear enough: SPE is an optional addition and will not be required to use Unicorn 4.</p><p>So what can we do with Unicorn cmdlets for SPE?</p><h2 id="Configurations"><a href="#Configurations" class="headerlink" title="Configurations"></a>Configurations</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get one</span></span><br><span class="line"><span class="built_in">Get-UnicornConfiguration</span> <span class="string">&quot;Foundation.Foo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get by filter</span></span><br><span class="line"><span class="built_in">Get-UnicornConfiguration</span> <span class="string">&quot;Foundation.*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get all</span></span><br><span class="line"><span class="built_in">Get-UnicornConfiguration</span></span><br></pre></td></tr></table></figure><p>The result of <code>Get-UnicornConfiguration</code> is an array of <code>IConfiguration</code> objects, which you can spelunk (e.g. with their <code>Name</code> property) or pass to other cmdlets. Configurations are read only.</p><h2 id="Syncing"><a href="#Syncing" class="headerlink" title="Syncing"></a>Syncing</h2><p>Sync cmdlets make use of <a href="https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.utility/write-progress">Write-Progress</a> to provide a similar progress bar experience to the Control Panel, albeit a bit less responsive.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sync one</span></span><br><span class="line"><span class="built_in">Sync-UnicornConfiguration</span> <span class="string">&quot;Foundation.Foo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sync multiple by name</span></span><br><span class="line"><span class="built_in">Sync-UnicornConfiguration</span> <span class="selector-tag">@</span>(<span class="string">&quot;Foundation.Foo&quot;</span>, <span class="string">&quot;Foundation.Bar&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sync multiple from pipeline</span></span><br><span class="line"><span class="built_in">Get-UnicornConfiguration</span> <span class="string">&quot;Foundation.*&quot;</span> | <span class="built_in">Sync-UnicornConfiguration</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sync all, except transparent sync-enabled configurations</span></span><br><span class="line"><span class="built_in">Get-UnicornConfiguration</span> | <span class="built_in">Sync-UnicornConfiguration</span> <span class="literal">-SkipTransparent</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Optionally set log output level (Debug, Info, Warn, Error)</span></span><br><span class="line"><span class="built_in">Sync-UnicornConfiguration</span> <span class="literal">-LogLevel</span> Warn</span><br></pre></td></tr></table></figure><p>For example:</p><img src="/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/sync.png" class=""><h2 id="Partial-Syncing"><a href="#Partial-Syncing" class="headerlink" title="Partial Syncing"></a>Partial Syncing</h2><p>Sometimes you want to only sync a portion of a configuration. You can do that with PowerShell using <code>Sync-UnicornItem</code>.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sync a single item (note: must be under Unicorn control)</span></span><br><span class="line"><span class="built_in">Get-Item</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">Sync-UnicornItem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sync multiple single items (note: all must be under Unicorn control)</span></span><br><span class="line"><span class="built_in">Get-ChildItem</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">Sync-UnicornItem</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Sync an entire item tree, show only warnings and errors</span></span><br><span class="line"><span class="built_in">Get-Item</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">Sync-UnicornItem</span> <span class="literal">-Recurse</span> <span class="literal">-LogLevel</span> Warn</span><br></pre></td></tr></table></figure><h2 id="Reserializing"><a href="#Reserializing" class="headerlink" title="Reserializing"></a>Reserializing</h2><p>The cmdlet to reserialize is called <code>Export-UnicornConfiguration</code> because <code>Reserialize</code> is not an <a href="https://msdn.microsoft.com/en-us/powershell/reference/5.0/microsoft.powershell.core/functions/get-verb">approved verb</a> for a cmdlet :)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Reserialize one</span></span><br><span class="line"><span class="built_in">Export-UnicornConfiguration</span> <span class="string">&quot;Foundation.Foo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reserialize multiple by name</span></span><br><span class="line"><span class="built_in">Export-UnicornConfiguration</span> <span class="selector-tag">@</span>(<span class="string">&quot;Foundation.Foo&quot;</span>, <span class="string">&quot;Foundation.Bar&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reserialize from pipeline</span></span><br><span class="line"><span class="built_in">Get-UnicornConfiguration</span> <span class="string">&quot;Foundation.*&quot;</span> | <span class="built_in">Export-UnicornConfiguration</span></span><br></pre></td></tr></table></figure><h2 id="Partial-Reserializing"><a href="#Partial-Reserializing" class="headerlink" title="Partial Reserializing"></a>Partial Reserializing</h2><p>Sometimes you want to only reserialize a portion of a configuration. You can do that with PowerShell using <code>Export-UnicornItem</code>.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Reserialize a single item (note: must be under Unicorn control)</span></span><br><span class="line"><span class="built_in">Get-Item</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">Export-UnicornItem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reserialize multiple single items (note: all must be under Unicorn control)</span></span><br><span class="line"><span class="built_in">Get-ChildItem</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">Export-UnicornItem</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Reserialize an entire item tree</span></span><br><span class="line"><span class="built_in">Get-Item</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">Export-UnicornItem</span> <span class="literal">-Recurse</span></span><br></pre></td></tr></table></figure><h2 id="Converting-to-Raw-YAML"><a href="#Converting-to-Raw-YAML" class="headerlink" title="Converting to Raw YAML"></a>Converting to Raw YAML</h2><p>You can also dump out the raw YAML for an item - or items. The output of <code>ConvertTo-RainbowYaml</code> is either a string or array of strings depending on how many items were passed to it. Note that unless <code>-Raw</code> is specified, the default field formatters and excluded fields Unicorn ships with are used. These are non-customizable and do not follow Unicorn defaults if changed.</p><img src="/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/enyaml.png" class=""><p>This capability enables casual use of YAML serialization without having to use Unicorn or set up a configuration. It’s not a good solution for general purpose synchronization though simply because the nuances of storing trees of items in files are many. Very many. But I’m curious what uses people will find for this :)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Convert an item to YAML format (always uses default excludes and field formatters)</span></span><br><span class="line"><span class="built_in">Get-Item</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">ConvertTo-RainbowYaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert many items to YAML strings</span></span><br><span class="line"><span class="built_in">Get-ChildItem</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">ConvertTo-RainbowYaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable all field formats and field filtering</span></span><br><span class="line"><span class="comment"># (e.g. disable XML pretty printing,</span></span><br><span class="line"><span class="comment"># and don&#x27;t ignore the Revision and Modified fields, etc)</span></span><br><span class="line"><span class="built_in">Get-Item</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">ConvertTo-RainbowYaml</span> <span class="literal">-Raw</span></span><br></pre></td></tr></table></figure><h2 id="Converting-from-Raw-YAML"><a href="#Converting-from-Raw-YAML" class="headerlink" title="Converting from Raw YAML"></a>Converting from Raw YAML</h2><img src="/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/convertfrom.png" class=""><p>In Rainbow the <code>IItemData</code> interface is the internal unit of an Item. The <code>ConvertFrom-RainbowYaml</code> cmdlet converts raw YAML string(s) into <code>IItemData</code> which you can then spelunk as objects or deserialize as needed.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get IItemDatas from YAML variable</span></span><br><span class="line"><span class="variable">$rawYaml</span> | <span class="built_in">ConvertFrom-RainbowYaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get IItemData and disable all field filters</span></span><br><span class="line"><span class="comment"># (use this if you ran ConvertTo-RainbowYaml with -Raw)</span></span><br><span class="line"><span class="variable">$yaml</span> | <span class="built_in">ConvertFrom-RainbowYaml</span> <span class="literal">-Raw</span></span><br></pre></td></tr></table></figure><h2 id="Deserialization"><a href="#Deserialization" class="headerlink" title="Deserialization"></a>Deserialization</h2><p>To deserialize items, use <code>Import-RainbowItem</code> which takes <code>IItemData</code> items in and deserializes them into the Sitecore database. No comparison is done before deserialization, which makes this a bit slower than a full Unicorn sync.</p><img src="/index.php/2017/02/Unicorn-4-Preview-Part-2-SPE-Support/elephant.png" class=""><p>As a shorthand <code>Import-RainbowItem</code> also accepts YAML strings, however as <code>IItemData</code> can represent any sort of item, it is not limited only to deserializing YAML-sourced items.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deserialize IItemDatas from ConvertFrom-RainbowYaml</span></span><br><span class="line"><span class="variable">$rawYaml</span> | <span class="built_in">ConvertFrom-RainbowYaml</span> | <span class="built_in">Import-RainbowItem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deserialize raw YAML from pipeline into Sitecore </span></span><br><span class="line"><span class="comment"># Shortcut bypassing ConvertFrom-RainbowYaml</span></span><br><span class="line"><span class="variable">$yaml</span> | <span class="built_in">Import-RainbowItem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deserialize and disable all field filters</span></span><br><span class="line"><span class="comment"># (use this if you ran ConvertTo-RainbowYaml with -Raw)</span></span><br><span class="line"><span class="variable">$yaml</span> | <span class="built_in">Import-RainbowItem</span> <span class="literal">-Raw</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deserialize multiple at once</span></span><br><span class="line"><span class="variable">$yamlStringArray</span> | <span class="built_in">Import-RainbowItem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Complete example that does nothing but eat CPU</span></span><br><span class="line"><span class="built_in">Get-ChildItem</span> <span class="string">&quot;/sitecore/content&quot;</span> | <span class="built_in">ConvertTo-RainbowYaml</span> | <span class="built_in">Import-RainbowItem</span></span><br></pre></td></tr></table></figure><h2 id="Questions"><a href="#Questions" class="headerlink" title="Questions?"></a>Questions?</h2><h3 id="Does-this-mean-the-existing-PowerShell-Remote-API-is-obsolete"><a href="#Does-this-mean-the-existing-PowerShell-Remote-API-is-obsolete" class="headerlink" title="Does this mean the existing PowerShell Remote API is obsolete?"></a>Does this mean the existing <a href="https://github.com/kamsar/Unicorn/tree/master/doc/PowerShell%20Remote%20Scripting">PowerShell Remote API</a> is obsolete?</h3><p>No. The existing PowerShell API uses Windows PowerShell to provide remote syncing capability and does not require installing <em>Sitecore</em> PowerShell. They serve different parallel purposes, and both are here to stay.</p><h3 id="You-have-no-gifs-or-memes-in-this-post-Is-something-wrong"><a href="#You-have-no-gifs-or-memes-in-this-post-Is-something-wrong" class="headerlink" title="You have no gifs or memes in this post. Is something wrong?"></a>You have no gifs or memes in this post. Is something wrong?</h3><p><img src="https://i.giphy.com/qZZAQDUNeXams.gif" alt="you mad?"></p><h3 id="Can-I-have-a-beta-yet"><a href="#Can-I-have-a-beta-yet" class="headerlink" title="Can I have a beta yet?"></a>Can I have a beta yet?</h3><p>I’ll be releasing a beta once I finish the features I have planned. Yep, there’s at least one more ;)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Unicorn 4 will feature full support for &lt;a href=&quot;https://www.gitbook.com/book/sitecorepowershell/sitecore-powershell-extensions/details&quot;&gt;</summary>
      
    
    
    
    <category term="Unicorn" scheme="https://kamsar.net/index.php/category/Unicorn/"/>
    
    
  </entry>
  
</feed>
