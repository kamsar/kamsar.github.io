<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Category: Sitecore | Kam&#39;s Idea Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Kam&#39;s Idea Log">
<meta property="og:url" content="https://kamsar.net/index.php/category/Sitecore/index.html">
<meta property="og:site_name" content="Kam&#39;s Idea Log">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Kam Figy">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@kamsar">
  
    <link rel="alternative" href="/index.php/feed" title="Kam&#39;s Idea Log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62284328-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo">
        <span class="site-title">Kam&#39;s Idea Log</span>
        <span class="subtitle">C#, Jamstack, and Shenanigans</span>
      </a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=40" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=80 2x" alt="omg the beard"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </td>
      </tr>
    </table>
  </div>
  
  <div id="header-sub" class="header-sub header-inner">
    <div class="outer">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=128" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=256 2x" alt="#sitecorebeard">
      <h2 id="name">Kam Figy</h2>
      <h3 id="title">Principal Platform Architect at</h3>
      <a class="corp-logo" href="https://uniform.dev" target="_blank"><img src="/css/images/uniform-logo.svg" alt="Uniform" width="180"></a>
      <span id="location"><i class="fa fa-map-marker"></i>Vancouver, WA USA</span>
      <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/kamsar">FOLLOW</a>
  	</div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a target="_blank" rel="noopener" href="https://github.com/kamsar" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a target="_blank" rel="noopener" href="https://twitter.com/kamsar" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/index.php/feed" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    <div class="article-info profile-block bio">
      <h2>About</h2>
      <p>Kam has been making websites since 1996, starting out with a 14.4k modem on a <a href="https://en.wikipedia.org/wiki/Party_line_(telephony)" target="_blank">party line</a> in the Hawaiian rainforest. A veteran developer, architect, and speaker, he's been working in the content management space for well over a decade. Kam is the author of <a href="https://github.com/kamsar/Unicorn" target="_blank">Unicorn</a>, <a href="https://github.com/kamsar/Synthesis" target="_blank">Synthesis</a>, <a href="https://github.com/kamsar/Dianoga" target="_blank">Dianoga</a>, and several other open-source libraries.</p>
    </div>
  </div>
</aside>
      <section id="main">
  
  
    
    
      
        <div class="archive-year-wrap">
          <i class="fa fa-calendar"></i>
          <a href="/archives/2017" class="archive-year">2017</a>
        </div>
    
    <article id="post-The-lazy-way-to-install-Sitecore-9" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/11/The-lazy-way-to-install-Sitecore-9/">The lazy developer&#39;s way to install Sitecore 9</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/11/The-lazy-way-to-install-Sitecore-9/">
    <time datetime="2017-11-02T00:37:11.000Z" itemprop="datePublished">November 1, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Since Sitecore 9 was released, there’s been a lot of talk about the new installation techniques that it necessitates - namely, the move towards infrastructure as code and the Sitecore Install Framework (SIF). It’s no secret that installing Sitecore 9 can be a bit more difficult than previous versions, but it really doesn’t have to be.</p>
<p>This is the part where you might be expecting me to announce some crazy script I wrote, but not this time because someone else already did the work. So let’s address the elephant in the room.</p>
<h2 id="Solr-the-easy-way"><a href="#Solr-the-easy-way" class="headerlink" title="Solr the easy way"></a>Solr the easy way</h2><p>Back in the day <a href="https://kamsar.net/index.php/2016/03/The-Solr-Cannon/">I wrote some scripts to install Solr</a> using Bitnami. It worked, but I’d always wanted to find the time to make it simpler and less dependent on Bitnami and their notoriously hard to find older versions. Well <a target="_blank" rel="noopener" href="https://jermdavis.wordpress.com/2017/10/30/low-effort-solr-installs/">Jeremy Davis did exactly what I wanted to do</a> and scripted the whole Solr install, locally trusted SSL certificate, and installation as a service. You can also just <a target="_blank" rel="noopener" href="https://gist.github.com/jermdavis/8d8a79f680505f1074153f02f70b9105">skip straight to the gist of the PowerShell you need to run</a>.</p>
<p>Seriously, it’s awesome and you should use it especially for local dev setups.</p>
<p>A few things I noted when I used it:</p>
<ul>
<li>Change the download URLs for Solr and NSSM to be https (encrypted). They work fine that way.</li>
<li>You must install the Java Runtime Environment (JRE) first and plug in the right version - it won’t do it for you</li>
<li>Make sure to add the <code>$SolrHost</code> value to your hosts file before you run the script so that it can resolve with the SSL certificate correctly (it will be bound to that name; don’t use <code>localhost</code>).</li>
</ul>
<h2 id="SIF-the-easy-way-with-SIFless"><a href="#SIF-the-easy-way-with-SIFless" class="headerlink" title="SIF the easy way with SIFless"></a>SIF the easy way with SIFless</h2><p>SIF is a pretty amazing tool, but it has two shortcomings: one, that it’s great for automated infrastructure but not so great for a quick local setup and two, that it doesn’t yet have an uninstall feature. Well <a target="_blank" rel="noopener" href="http://www.rockpapersitecore.com/2017/10/introducing-sif-less-for-easy-sitecore-9-installation/">Rob Ahnemann wrote a handy GUI for SIF called SIFless</a> that fixes both of those issues, making quick setups with mostly default settings easy <em>and</em> generating hackable SIF PowerShell scripts that let you do whatever advanced things you want after using the GUI to get started. And it generates uninstall scripts too that get rid of the windows services, solr cores, and other artifacts that are left when you want to tear down that test site.</p>
<p>A few things to be aware of with SIFless:</p>
<ul>
<li>Despite the amusing name, SIFless <em>does</em> require SIF to be installed!</li>
<li>The Solr URL needs to be the path to the Solr admin panel (e.g. not <code>https://mysolr:8983</code>, but <code>https://mysolr:8983/solr</code>)</li>
<li>The Solr physical path needs to be to the root of the Solr instance (if it’s the right place you’ll see ‘bin’ and ‘server’ folders; if you used the script above with defaults this would be <code>C:\solr\solr-6.6.2</code>)</li>
</ul>
<h2 id="Go-forth-and-use-Sitecore-9"><a href="#Go-forth-and-use-Sitecore-9" class="headerlink" title="Go forth and use Sitecore 9"></a>Go forth and use Sitecore 9</h2><p>Using these two tools I went from having no Solr and no Sitecore installations to having a fully operational <del>battle station</del> Sitecore 9 instance with xConnect in about 45 minutes. And that includes debugging my own silly mistakes. I bet you can do it faster. Get thee to a PowerShell console!</p>
<p><img src="https://media.giphy.com/media/cCba2gQCxNpsc/giphy.gif" alt="time to get SIFty"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/11/The-lazy-way-to-install-Sitecore-9/" data-id="ckrl9emyo005a98q7a7wwheah" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-I-m-a-Sitecorian" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/10/I-m-a-Sitecorian/">I&#39;m a Sitecorian!</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/10/I-m-a-Sitecorian/">
    <time datetime="2017-10-23T20:01:58.000Z" itemprop="datePublished">October 23, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I am excited to announce that I am joining the Sitecore product team as a Platform Architect! </p>
<p><img src="https://media.giphy.com/media/1jnyRP4DorCh2/giphy.gif" alt="wth"></p>
<p>Now normally this wouldn’t merit a whole blog post, and we’d just let the recruiters find out about it on LinkedIn. But I’m sure many folks’ next question would be around all the libraries that I maintain and what will happen to them. So let’s address the elephant in the room:</p>
<p><img src="https://media.giphy.com/media/y63H09ZvHJdf2/giphy.gif" alt="not a thing"></p>
<h2 id="Unicorn-Rainbow-and-Dianoga"><a href="#Unicorn-Rainbow-and-Dianoga" class="headerlink" title="Unicorn, Rainbow, and Dianoga"></a><a target="_blank" rel="noopener" href="https://github.com/kamsar/Unicorn">Unicorn</a>, <a target="_blank" rel="noopener" href="https://github.com/kamsar/Rainbow">Rainbow</a>, and <a target="_blank" rel="noopener" href="https://github.com/kamsar/Dianoga">Dianoga</a></h2><p>These will continue exactly as they are today as independent, community driven projects. I will still be the maintainer. The license will remain MIT.</p>
<p>This also includes the dependency libraries that these projects use (e.g. <a target="_blank" rel="noopener" href="https://github.com/kamsar/Configy">Configy</a>, <a target="_blank" rel="noopener" href="https://github.com/kamsar/Kamsar.WebConsole">WebConsole</a>, <a target="_blank" rel="noopener" href="https://github.com/kamsar/MicroCHAP">MicroCHAP</a>).</p>
<h2 id="Synthesis-amp-Leprechaun"><a href="#Synthesis-amp-Leprechaun" class="headerlink" title="Synthesis &amp; Leprechaun"></a><a target="_blank" rel="noopener" href="https://github.com/kamsar/Synthesis">Synthesis</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/kamsar/Leprechaun">Leprechaun</a></h2><p>Ok hold up: let’s first define what Leprechaun <em>is</em> because I haven’t publicly spoken about it yet. It’s a stable command-line code generator that works from Rainbow serialized items. Kinda like the T4 templates that a lot of people use except that it’s better because:</p>
<ul>
<li>Uses Roslyn and C# Scripting, so it can run outside Visual Studio (e.g. on a CI server)</li>
<li>Ridiculously faster than T4</li>
<li>Has a watch mode that provides instant regeneration when saving templates in Sitecore</li>
<li>Uses the same configuration system as Unicorn does, so it’s familiar and simple to configure</li>
</ul>
<p>Leprechaun is currently working in production on a couple sites, but does not have complete documentation so it may require a bit more spelunking to use. Currently it supports Synthesis out of the box, but it’s easy to add or change code generation templates.</p>
<p>Ok back to what’s happening to these projects. For the last year or so it’s been difficult to come up with the time and inclination to give Synthesis and Leprechaun the love they deserve. In order to get them that love, I am ceding maintainership to the excellent <a target="_blank" rel="noopener" href="https://twitter.com/bllipson">Ben Lipson</a>. Ben is talented developer and Sitecore MVP with a lot of good ideas about where to take these tools. He’ll do a great job.</p>
<p>Aside from transferring the repositories to Ben, nothing else is changing.</p>
<h2 id="Will-you-be-disappearing-from-the-community"><a href="#Will-you-be-disappearing-from-the-community" class="headerlink" title="Will you be disappearing from the community?"></a>Will you be disappearing from the community?</h2><p><img src="https://media.giphy.com/media/O9BPkYr89lK2A/giphy.gif" alt="nope"></p>
<p>No. <code>#venting</code> 4lyfe.</p>
<h2 id="What-will-you-be-working-on-at-Sitecore"><a href="#What-will-you-be-working-on-at-Sitecore" class="headerlink" title="What will you be working on at Sitecore?"></a>What will you be working on at Sitecore?</h2><p>I’ll be on Team X, led by the illustrious <a target="_blank" rel="noopener" href="https://twitter.com/alexshyba">Alex Shyba</a>. In other words, if I told you I’d have to kill you.</p>
<p><img src="https://media.giphy.com/media/u4DnvVypp0q8U/giphy.gif" alt="actually it&#39;s JSS"></p>
<h2 id="giphy-magic8ball-quot-Will-this-be-awesome-quot"><a href="#giphy-magic8ball-quot-Will-this-be-awesome-quot" class="headerlink" title="/giphy #magic8ball &quot;Will this be awesome?&quot;"></a><code>/giphy #magic8ball &quot;Will this be awesome?&quot;</code></h2><p><img src="https://media.giphy.com/media/3o7abB06u9bNzA8lu8/giphy.gif" alt="yes"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/10/I-m-a-Sitecorian/" data-id="ckrl9emym005398q78sug7lyt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Quickly-add-SSL-to-Solr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/10/Quickly-add-SSL-to-Solr/">Quickly add SSL to Solr</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/10/Quickly-add-SSL-to-Solr/">
    <time datetime="2017-10-23T15:20:39.000Z" itemprop="datePublished">October 23, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>There have been several people recently who I’ve seen having trouble setting up SSL for their Solr in order to use it with Sitecore 9. So, I present the following gist to you. It’s designed to automate the complete setup process of adding SSL to Solr with a self-signed certificate, and trusting that self-signed certificate. For production setups with a real certificate, it should be quite easy to modify.</p>
<p>It’s been tested on standalone as well as Bitnami Solr. The script requires Windows 10 to use the <code>Import-PfxCertificate</code> cmdlet; if you don’t have that you can remove the trust scripting and do it manually.</p>
<script src="//gist.github.com/c3c8322c1ec40eac64c7dd546e5124de.js"></script>

<p><img src="https://media.giphy.com/media/IB9foBA4PVkKA/giphy.gif" alt="giphy"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/10/Quickly-add-SSL-to-Solr/" data-id="ckrl9emyn005898q7cchk9vyk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-All-about-xConnect-Security" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/10/All-about-xConnect-Security/">All about xConnect Security</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/10/All-about-xConnect-Security/">
    <time datetime="2017-10-22T20:57:18.000Z" itemprop="datePublished">October 22, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Sitecore 9 introduces the new xConnect server to the ecosystem. xConnect is an abstracted service layer that Sitecore uses for all its analytics and marketing automation features. If you’re using Sitecore XP (aka xDB), you’ll need an xConnect server if you upgrade to Sitecore 9.</p>
<p>xConnect is noteworthy because it introduces client certificate authentication for the Sitecore XP server to communicate with xConnect. Certificates are a complex subject, and can fail in any number of less than helpful ways. This post aims to help you understand how certificates work in Sitecore 9, and provide you some tools to diagnose what’s wrong when they are not working right. </p>
<h2 id="What-is-TLS"><a href="#What-is-TLS" class="headerlink" title="What is TLS?"></a>What is TLS?</h2><p>In order to understand how xConnect works, it’s important to understand what’s going on: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security</a> (TLS). You may also think of this as “SSL” or “HTTPS.”</p>
<p>TLS is a protocol for establishing secure encrypted connections between a <em>server</em> and a <em>client</em>. The key aspect of TLS is that the client and server can securely exchange encryption keys in such a way that they cannot be observed by malicious parties that may be watching the exchange.</p>
<h2 id="Asymmetric-vs-Symmetric-Encryption"><a href="#Asymmetric-vs-Symmetric-Encryption" class="headerlink" title="Asymmetric vs Symmetric Encryption"></a>Asymmetric vs Symmetric Encryption</h2><p>To understand how TLS works, it’s important to understand the distinction between Asymmetric (also called Public Key) Encryption, and Symmetric Encryption.</p>
<p>If you ever made secret codes as a kid, you’ve probably used <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm"><em>symmetric encryption</em></a>. This is where the sender and receiver both need to know a key to decrypt the message, for example a simple <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Caesar_cipher">shift cipher</a> where <code>D</code> = <code>A</code>, <code>E</code> = <code>B</code>, and so forth. Julius Caesar famously sent secret messages by shifting letters three places forward like this. Symmetric encryption does have one major downfall, however: posession of the secret key lets you read any encrypted message even if not the intended recipient.</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Public-key_cryptography">Asymmetric encryption</a> on the other hand uses two different keys: a <em>public key</em> and a <em>private key</em>. The public key can be shared with anyone without compromising anything. However a client can use the public key to encrypt a message in such a way that it can only be decrypted <em>with the server’s private key</em>. In this way, you can receive private encrypted messages from clients you don’t share any secrets with - but they can still send the server private messages.</p>
<p>TLS uses <em>asymmetric encryption</em> to transfer an encryption key for <em>symmetric encryption</em>, which is used for ongoing data transfer over the encrypted connection. This is done because asymmetric encryption is much much slower than symmetric.</p>
<p>It’s important to understand the difference between public and private keys when you set up Sitecore 9, because they need to be deployed to different servers in your infrastructure. A <em>certificate</em> generally includes both a public and private key, however it can also include only a public key.</p>
<h2 id="xConnect-Setup"><a href="#xConnect-Setup" class="headerlink" title="xConnect Setup"></a>xConnect Setup</h2><p>xConnect uses <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Mutual_authentication">mutual authentication</a> to secure the connections between it and the Sitecore XP server. This is accomplished using <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Client-authenticated_TLS_handshake">TLS client certificates</a>.</p>
<p>If you’ve worked with SSL certificates before, this is a stronger form of SSL where not only does the client have to trust the server, but the server also has to trust a second certificate issued to the client. In this case, the client is the Sitecore XP server, and the server is the xConnect server. Let’s take a look at how this works:</p>
<h2 id="SSL-Server-Certificate-Negotiation"><a href="#SSL-Server-Certificate-Negotiation" class="headerlink" title="SSL Server Certificate Negotiation"></a>SSL Server Certificate Negotiation</h2><p>All SSL connections go through this process, whether xConnect or otherwise. In a standard Sitecore 9 XP installation, the xConnect server will have the <em>server certificate</em> installed. The Sitecore XP server will only have a server certificate if access to Sitecore itself, e.g. for administration, is done via SSL (in which case it will likely be a separate server certificate from xConnect’s).</p>
<ol>
<li>Client prepares to make a HTTPS request (e.g. you ask for <code>https://xconnect</code>)</li>
<li>Client sends a <em>ClientHello</em> message to the server. This proposes encryption standards, among other things.</li>
<li>The server replies with a <em>ServerHello</em> message back to the client. This includes the server’s <em>public key</em>, and the encryption standards that the server has selected from what the client proposed in the <em>ClientHello</em>.</li>
<li>The client <em>validates</em> the server certificate (e.g. must have correct domain and trusted issuer)</li>
<li>A symmetric encryption key is generated and exchanged using the server’s public key</li>
<li>Now that an encrypted connection is established, a normal HTTP request is sent over the encrypted channel</li>
</ol>
<h3 id="What-can-go-wrong-with-server-certificate-negotiation"><a href="#What-can-go-wrong-with-server-certificate-negotiation" class="headerlink" title="What can go wrong with server certificate negotiation"></a>What can go wrong with server certificate negotiation</h3><p>The most common issues are domain mismatches and untrusted certificates. Generally you can diagnose issues with server certificates using a web browser - request the site over HTTPS and review the error shown in the browser. Make sure you request the xConnect server URL, <strong>not</strong> the Sitecore XP URL if you are diagnosing an xConnect connectivity issue.</p>
<h4 id="Domain-Mismatches"><a href="#Domain-Mismatches" class="headerlink" title="Domain Mismatches"></a>Domain Mismatches</h4><p>A domain mismatch occurs when a certificate’s domain does not match the domain being requested. For example, a certificate issued to <code>sitecore.net</code> will fail this validation if the site you’re requesting is <code>https://foo.local</code>. Certificates may also be issued using <em>wildcards</em> (e.g. <code>*.sitecore.net</code>). Note that wildcards apply to one level of subdomains only - so in the previous example <code>sitecore.net</code> or <code>foo.sitecore.net</code> would be valid, but <code>bar.foo.sitecore.net</code> would <em>not</em> be.</p>
<p>Domain matching is done based on the host header the server receives. For example if the xConnect server is <code>https://xconnect</code> but can also be accessed via <code>https://127.0.0.1</code>, the certificate will be invalid if the IP address is used because the certificate was not issued for <code>127.0.0.1</code>.</p>
<p>If you have a domain mismatch issue, you will need to either get a new certificate (and update the xConnect IIS site(s) to use the new certificate) or change the domain for xConnect to one that is valid for the certificate.</p>
<h4 id="Untrusted-Certificates"><a href="#Untrusted-Certificates" class="headerlink" title="Untrusted Certificates"></a>Untrusted Certificates</h4><p>To understand trust issues, it’s important to understand how certificates are issued. Certificates are issued by other certificates.</p>
<img src="/index.php/2017/10/All-about-xConnect-Security/cert-issuer.jpg" class="">

<p>In fact, certificates can be issued in <em>chains</em> (Xzibit would definitely approve). Trust issues occur when the certificate that issued the <em>server</em> certificate is not considered to be trusted by the <em>client</em>. On Windows, trust is established by being included in the <em>Trusted Root Certification Authorities</em> in the machine certificates:</p>
<img src="/index.php/2017/10/All-about-xConnect-Security/trusted-certs.png" class="">

<p>Note that to trust a certificate, only the <em>public key</em> for the server certificate must be imported here. If you’re using self-signed certificates that issued themselves - like <code>localhost</code> in the screenshot - you can add the certificate itself to the trusted root certificates by exporting it and reimporting it into the root certificates. If using a commercially issued certificate, that certification authority’s root certificates must be added to the trusted root - in most cases, they are already present.</p>
<h4 id="More-esoteric-errors"><a href="#More-esoteric-errors" class="headerlink" title="More esoteric errors"></a>More esoteric errors</h4><p>There are some less common issues that can also cause server certificate negotiation errors. Servers will be commonly secured against supporting vulnerable <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/RC4">ciphers</a>, <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SHA-1">hash algorithms</a> or <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/POODLE">SSL protocol versions</a>. You might have heard of Heartbleed or POODLE vulnerabilities, or had to support TLS 1.2 if working with some web APIs such as SalesForce. This is a good idea, but if the server and client cannot mutually agree on a supported cipher, hash, and protocol version the connection will fail. If the certificate is trusted and has the correct domain, this would be the next thing to check.</p>
<p>If you’ve never heard of this before, you can secure your IIS servers using a tool like <a target="_blank" rel="noopener" href="https://www.nartac.com/Products/IISCrypto">IISCrypto</a>. Go do it now, this post will wait.</p>
<p>Note that the .NET HTTP client with framework versions prior to 4.6.2 defaults to only supporting TLS up to 1.1. Many modern security scripts will disable all TLS protocol versions except for 1.2, which will cause HTTP requests from clients with earlier versions of the .NET framework installed to fail.</p>
<h2 id="SSL-Client-Certificate-Negotiation"><a href="#SSL-Client-Certificate-Negotiation" class="headerlink" title="SSL Client Certificate Negotiation"></a>SSL Client Certificate Negotiation</h2><p>Hopefully now you have a decent idea of how <em>server</em> certificates work. But xConnect also uses <em>client certificates</em>. A client certificate enables <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Mutual_authentication"><em>mutual authentication</em></a>. With only a server certificate, the client must decide to trust the server but the server has no way to know if it should trust the client. Enter client certificates.</p>
<p>A client certificate is essentially the opposite of the server certificate. When using a client certificate, the negotiation works similarly to the server certificate, except that when the server sends the <code>ServerHello</code> (#3 above) it requests a client certificate in addition to sending its public key. The client then sends the public key of its <em>client certificate</em> back to the server - and then <em>the server decides whether it should trust the client certificate</em>.</p>
<p>If the client certificate is not trusted, it is rejected. The rules for validating a client certificate are up to the server and do not necessarily follow the same validation rules as a server certificate on the client. In the case of xConnect:</p>
<ul>
<li>The domain/subject on the client certificate does not seem to matter to xConnect</li>
<li>The trusting of the certificate is done using the <em>thumbprint</em> of the certificate (a hash of the certficate which uniquely identifies it). Note that the thumbprint will change when an expired certificate is renewed, so you will need to reconfigure xConnect after renewing a client certificate so that it trusts the newer thumbprint.</li>
<li>The xConnect server must trust the issuer of the client certificate</li>
</ul>
<h3 id="What-can-go-wrong-with-client-certificate-negotiation"><a href="#What-can-go-wrong-with-client-certificate-negotiation" class="headerlink" title="What can go wrong with client certificate negotiation"></a>What can go wrong with client certificate negotiation</h3><p>There are a lot of things that can go wrong with the client certificate, moreso than the server certificate. When troubleshooting, make your first step the Sitecore XP logs - they generally have some basic information about a bad client cert.</p>
<h4 id="If-you’re-receiving-HTTP-4xx-responses"><a href="#If-you’re-receiving-HTTP-4xx-responses" class="headerlink" title="If you’re receiving HTTP 4xx responses"></a>If you’re receiving HTTP 4xx responses</h4><p>Chances are your client certificate validation failed. This could mean:</p>
<ul>
<li>The client certificate is not installed on both the Sitecore XP server and the xConnect server (the xConnect server would only need the public key)</li>
<li>The client certificate is not considered trusted on the xConnect server</li>
<li>The certificate <em>thumbprint</em> configured in the xConnect server’s <code>App_Config\ConnectionStrings.config</code> is missing or incorrect. Note that the thumbprint must be all uppercase with no spaces or colons. If copied from certificate manager, an unprintable character might prefix the thumbprint - check for a hidden character there.</li>
<li>The certificate <em>location</em> configured in the xConnect server’s <code>App_Config\ConnectionStrings.config</code> is incorrect. Normally the certificate should be stored in local machine certificates and have a connection string similar to <code>StoreName=My;StoreLocation=LocalMachine;FindType=FindByThumbprint;FindValue=THUMBPRINTVALUE</code>.</li>
</ul>
<h4 id="“The-certificate-was-not-found”"><a href="#“The-certificate-was-not-found”" class="headerlink" title="“The certificate was not found”"></a>“The certificate was not found”</h4><p>This indicates one of two things:</p>
<ul>
<li>The <em>thumbprint</em> is incorrect in the Sitecore XP server’s <code>App_Config\ConnectionStrings.config</code> file. Note that the thumbprint must be all uppercase with no spaces or colons. If copied from certificate manager, an unprintable character might prefix the thumbprint - check for a hidden character there.</li>
<li>The certificate <em>location</em> configured in the Sitecore XP server’s <code>App_Config\ConnectionStrings.config</code> is incorrect. Normally the certificate should be stored in local machine certificates and have a connection string similar to <code>StoreName=My;StoreLocation=LocalMachine;FindType=FindByThumbprint;FindValue=THUMBPRINTVALUE</code>.</li>
</ul>
<h4 id="System-Net-WebException-The-request-was-aborted-Could-not-create-SSL-TLS-secure-channel"><a href="#System-Net-WebException-The-request-was-aborted-Could-not-create-SSL-TLS-secure-channel" class="headerlink" title="System.Net.WebException: The request was aborted: Could not create SSL/TLS secure channel."></a>System.Net.WebException: The request was aborted: Could not create SSL/TLS secure channel.</h4><p><em>As long as the server certificate is valid</em>, this message is most likely that the Sitecore XP server’s IIS app pool user account does not have read access to the client certificate’s private key. This access is needed so that the Sitecore XP server can encrypt communications using its client certificate.</p>
<p>To remedy this issue, open the local machine certificates (“Manage computer certificates” in a start menu search) on the Sitecore XP server. Find the client certificate (normally under <code>Personal\Certificates</code>). Right click it, choose <code>All Tasks</code>, then <code>Manage Private Keys...</code>. You should get a security assignment window like this:</p>
<img src="/index.php/2017/10/All-about-xConnect-Security/pkey-security.png" class="">

<p>Next, add your IIS app pool user to the ACLs and grant it <code>Read</code> permissions (as above). Remember if you’re using AppPoolIdentity (you should be, unless using a domain account for windows auth to SQL), you must select the account by choosing <code>Local Computer</code> as the search location, and enter <code>IIS APPPOOL\MyAppPoolsName</code> as the account name to find.</p>
<p>Still having issues? Well, you can also use the security audit log to find out which account is failing to get access, then add that account in the key ACLs above:</p>
<img src="/index.php/2017/10/All-about-xConnect-Security/key-security-audit-failure.png" class="">

<h2 id="Local-Development-Tip"><a href="#Local-Development-Tip" class="headerlink" title="Local Development Tip"></a>Local Development Tip</h2><p>If you work at a Sitecore partner and will have multiple copies of Sitecore 9 running locally, this can cause issues if you issue a dedicated SSL server certificate to each site. This is because a given TCP port (e.g. 443, the default) can only have one SSL certificate bound to it. This precludes having multiple Sitecore 9 instances running together locally <em>unless they share the same SSL certificate</em>.</p>
<p>Wildcard certificates are perfect for this job. As long as you use the same top level suffix for all your dev sites (e.g. <code>*.local.dev</code>), you can use the same wildcard certificate for your server certificate for all dev sites. Note that IIS’ self-signed certificate generator will not create a wildcard certificate for you. You’ll have to use something else, like <a target="_blank" rel="noopener" href="https://technet.microsoft.com/en-us/itpro/powershell/windows/pkiclient/new-selfsignedcertificate">New-SelfSignedCertificate</a>, to create one.</p>
<p>Important note: You must issue a wildcard for at least two segments of domain for it to be trusted. For example <code>*.dev</code> is bad, but <code>*.local.dev</code> is good.</p>
<p>Note that <em>client</em> certificates should be unique on each site, only the server certificate should be shared.</p>
<p>In the release version of Sitecore 9, you can also disable the requirement to use encryption with xConnect which can bypass a lot of debugging. Do not do this in production or else a herd of elephants will destroy you.</p>
<h2 id="Advanced-Debugging-with-Wireshark"><a href="#Advanced-Debugging-with-Wireshark" class="headerlink" title="Advanced Debugging with Wireshark"></a>Advanced Debugging with Wireshark</h2><p>It’s possible to watch the SSL negotiation at a TCP/IP level using a network monitor such as <a target="_blank" rel="noopener" href="https://www.wireshark.org/">Wireshark</a>. This can provide insights on why your setup is failing when error messages are less than optimal. For example I spent a couple days diagnosing what turned out to be private key security issues. I figured this out by using Wireshark and observing that the client was never sending its client certificate after the server requested it, and figuring out why that was.</p>
<p>To use Wireshark to watch SSL traffic, you’ll have to set it up to decrypt traffic. <a target="_blank" rel="noopener" href="https://blogs.technet.microsoft.com/nettracer/2013/10/12/decrypting-ssltls-sessions-with-wireshark-reloaded/">This guide</a> walks you through setting up decryption on Windows with an exported private key.</p>
<p>If you’re tracing local dev traffic (e.g. from <code>localhost</code> to <code>localhost</code>, including using your machine’s DNS name) Wireshark will not capture that unless you install <a target="_blank" rel="noopener" href="https://nmap.org/npcap/">npcap</a> instead of the default <code>pcap</code> packet capture software. Once <code>npcap</code> is installed, tell Wireshark to bind to the <code>Npcap Loopback Adapter</code> to see local traffic.</p>
<p>Here is a screenshot of the Wireshark capture where I diagnosed the client certificate security issue:</p>
<img src="/index.php/2017/10/All-about-xConnect-Security/wireshark-trace.png" class="">

<h2 id="Good-luck"><a href="#Good-luck" class="headerlink" title="Good luck!"></a>Good luck!</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/10/All-about-xConnect-Security/" data-id="ckrl9emz0006698q72frf3uca" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Where-to-find-Sitecore-documentation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/10/Where-to-find-Sitecore-documentation/">Where to find Sitecore documentation</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/10/Where-to-find-Sitecore-documentation/">
    <time datetime="2017-10-22T19:29:29.000Z" itemprop="datePublished">October 22, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <img src="/index.php/2017/10/Where-to-find-Sitecore-documentation/keep-calm-and-rtfm.jpg" class="">

<p>The land of Sitecore documentation is becoming a bit crowded these days. While at Symposium, I heard some people say they didn’t know how to keep up on new documentation - so here’s what I know. No doubt I missed some resources too, but these are the ones I usually use and follow.</p>
<h1 id="Official-Docs"><a href="#Official-Docs" class="headerlink" title="Official Docs"></a>Official Docs</h1><h2 id="Sitecore-Doc-Site"><a href="#Sitecore-Doc-Site" class="headerlink" title="Sitecore Doc Site"></a><a target="_blank" rel="noopener" href="https://doc.sitecore.net/">Sitecore Doc Site</a></h2><p>This is the main place to find documentation for Sitecore, as well as Sitecore modules. It has a handy <a target="_blank" rel="noopener" href="https://doc.sitecore.net/~/link.aspx?_id=C12C95F2683A4AF98BABA504B4701DD7&_z=z">RSS feed</a> of updated articles you should subscribe to.</p>
<p>Unfortunately the RSS feed is not entirely complete due to documentation microsites being proxied in under the main doc site (for example <a target="_blank" rel="noopener" href="http://commercesdn.sitecore.net/SitecoreCommerce/UsersGuide/en-us/index.html">Commerce</a> and the <a target="_blank" rel="noopener" href="https://doc.sitecore.net/developers/scaling-guide/">v9 Scaling Guide</a>). These statically generated sites generally do not provide their own RSS feeds, and are thus harder to track updates to.</p>
<h2 id="Sitecore-Knowledge-Base"><a href="#Sitecore-Knowledge-Base" class="headerlink" title="Sitecore Knowledge Base"></a><a target="_blank" rel="noopener" href="https://kb.sitecore.net/">Sitecore Knowledge Base</a></h2><p>The Sitecore KB lists known issues, support resolutions, security bulletins, and other support information. Like the main doc site, it has its own <a target="_blank" rel="noopener" href="https://kb.sitecore.net/en/Articles_RSS_Feed.aspx">RSS feed</a> of updated articles that is absolutely worth subscribing to.</p>
<h2 id="Sitecore-Helix-Docs"><a href="#Sitecore-Helix-Docs" class="headerlink" title="Sitecore Helix Docs"></a><a target="_blank" rel="noopener" href="http://helix.sitecore.net/">Sitecore Helix Docs</a></h2><p>Sitecore’s official architecture guidance has its own website. Unfortunately, no RSS feed of updates.</p>
<h2 id="Sitecore-JSS-Docs"><a href="#Sitecore-JSS-Docs" class="headerlink" title="Sitecore JSS Docs"></a><a target="_blank" rel="noopener" href="https://jss.sitecore.net/">Sitecore JSS Docs</a></h2><p>The JavaScript Services module has its own separate documentation site. Unfortunately, no RSS feed of updates.</p>
<h2 id="Sitecore-Dev-Site"><a href="#Sitecore-Dev-Site" class="headerlink" title="Sitecore Dev Site"></a><a target="_blank" rel="noopener" href="https://dev.sitecore.net/">Sitecore Dev Site</a></h2><p>Where to go to actually download Sitecore releases and official modules such as SXA and PXM. There’s no RSS feed of new releases and updates, unfortunately.</p>
<h1 id="Community-run-Docs"><a href="#Community-run-Docs" class="headerlink" title="Community-run Docs"></a>Community-run Docs</h1><h2 id="Sitecore-Blog-Feed"><a href="#Sitecore-Blog-Feed" class="headerlink" title="Sitecore Blog Feed"></a><a target="_blank" rel="noopener" href="http://feeds.sitecore.net/">Sitecore Blog Feed</a></h2><p>A Sitecore-run blog aggregator that serves up a fresh helping of most major Sitecore blogs. Worth subscribing to via its <a target="_blank" rel="noopener" href="http://feeds.sitecore.net/Feed/LatestPosts">RSS feed</a>.</p>
<h2 id="Sitecore-StackExchange"><a href="#Sitecore-StackExchange" class="headerlink" title="Sitecore StackExchange"></a><a target="_blank" rel="noopener" href="https://sitecore.stackexchange.com/">Sitecore StackExchange</a></h2><p>A community-driven Q&amp;A site that’s part of <a target="_blank" rel="noopener" href="https://stackexchange.com/">StackExchange</a>. If you have a question about Sitecore, there are many highly active members who are happy to help here.</p>
<h2 id="Sitecore-Slack"><a href="#Sitecore-Slack" class="headerlink" title="Sitecore Slack"></a><a target="_blank" rel="noopener" href="https://www.akshaysura.com/2015/10/27/how-to-join-sitecore-slack-community-chat/">Sitecore Slack</a></h2><p><a target="_blank" rel="noopener" href="https://slack.com/">Slack</a> is a group messaging/discussion tool. The Sitecore Community Slack group has over 2,700 Sitecore developers with very active participation. If you do Sitecore, you should be here.</p>
<h2 id="Unofficial-Sitecore-Training"><a href="#Unofficial-Sitecore-Training" class="headerlink" title="Unofficial Sitecore Training"></a><a target="_blank" rel="noopener" href="http://www.akshaysura.com/2016/02/03/unofficial-sitecore-8-training-webinar-series-full-curriculum/">Unofficial Sitecore Training</a></h2><p>Community run unofficial training videos that cover development practices that are commonly used, but not covered in official Sitecore training. More opinionated, influenced heavily by real-world implementation experiences.</p>
<h2 id="Sitecore-Community-Docs"><a href="#Sitecore-Community-Docs" class="headerlink" title="Sitecore Community Docs"></a><a target="_blank" rel="noopener" href="https://sitecore-community.github.io/docs/">Sitecore Community Docs</a></h2><p>Unofficial documentation. Not updated that often any longer but still some good information, especially the article on <a target="_blank" rel="noopener" href="http://sitecore-community.github.io/docs/documentation/Sitecore%20Fundamentals/Patch%20Files/">config patching</a>.</p>
<h2 id="Sitecore-Powershell-Extensions-Docs"><a href="#Sitecore-Powershell-Extensions-Docs" class="headerlink" title="Sitecore Powershell Extensions Docs"></a><a target="_blank" rel="noopener" href="https://sitecorepowershell.gitbooks.io/sitecore-powershell-extensions/">Sitecore Powershell Extensions Docs</a></h2><p>The SPE documentation is so complete that it’s worth mentioning even though it’s for a single Sitecore module.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/10/Where-to-find-Sitecore-documentation/" data-id="ckrl9emyn005698q735v930da" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Simplifying-Contact-Facets-with-C-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/">Simplifying Contact Facets with C# 6</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/">
    <time datetime="2017-06-02T17:04:08.000Z" itemprop="datePublished">June 2, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/index.php/category/Sitecore/xDB/">xDB</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Contact Facets allow you to persist information about visitors into the Sitecore xDB. We’re not going to get into the theory behind them in this post; for that go read Pete Navarra’s <a target="_blank" rel="noopener" href="https://sitecorehacker.com/2016/09/03/creating-custom-sitecore-xdb-contact-facets/">great blog post</a> that summarizes current practices and how to add facets.</p>
<p>Today we’re going to discuss how to syntactically improve the declaration of a contact facet class using syntaxes available in C# 6.0 (VS 2015) and C# 7.0 (VS 2017). It’s important to note that the C# version is decoupled from the .NET framework version: the C# 7.0 compiler is perfectly capable of emitting C# 7 syntax to a .NET 4.5-targeted assembly, for instance. So you can use these modern language features as long as you’ve got the right version of MSBuild or Visual Studio :)</p>
<p>Here’s the example Pete uses in his post, which follows <a target="_blank" rel="noopener" href="https://community.sitecore.net/technical_blogs/b/getting_to_know_sitecore/posts/introducing-contact-facets">other examples</a> out there as well:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SitecoreHacker.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> CUSTOMER_ID = <span class="string">&quot;CustomerId&quot;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> SEGEMENT = <span class="string">&quot;Segment&quot;</span>; <span class="comment">// sic :p</span></span><br><span class="line"> </span><br><span class="line">        <span class="meta">#<span class="meta-keyword">region</span> Properties</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(CUSTOMER_ID); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(CUSTOMER_ID, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(SEGEMENT); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(SEGEMENT, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(CUSTOMER_ID);</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(SEGEMENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As you can see, the facet API requires string keys for the facet values - in this case stored as <code>const string</code> - to get and set them. Further, as Pete notes:</p>
<blockquote>
<p>I found out the hard way that the constants defined, the value must equal the actual name of the class property for the same attribute.</p>
</blockquote>
<p>Well in C# 6 (VS 2015), there’s a syntax for that. The <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/nameof"><code>nameof</code></a> statement allows you to get the string name of a variable or property. This essentially hands off the management and maintenance of the <code>const</code> value to the compiler, instead of the developer.</p>
<p>So we can clean up this example by using <code>nameof</code> instead of constants - and get as a bonus refactoring support and compile-time validation of the names:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Elephant.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId)); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(<span class="keyword">nameof</span>(CustomerId), <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment)); &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetAttribute(<span class="keyword">nameof</span>(Segment), <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally if you have C# 7.0 (VS 2017), you can also utilize <a target="_blank" rel="noopener" href="https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/">expression bodied members</a> to further clean up the property syntax:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Sitecore.Analytics.Model.Framework;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Rhino.Sandbox.Facets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MarketingData</span>: <span class="title">Facet</span>, <span class="title">IMarketingData</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> CustomerId</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// expression bodied members turn the single-expression get </span></span><br><span class="line">            <span class="comment">// into a lamdba-style syntax, removing the need for braces</span></span><br><span class="line">            <span class="keyword">get</span> =&gt; GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            <span class="keyword">set</span> =&gt; SetAttribute(<span class="keyword">nameof</span>(CustomerId), <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Segment</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> =&gt; GetAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">            <span class="keyword">set</span> =&gt; SetAttribute(<span class="keyword">nameof</span>(Segment), <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MarketingData</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(CustomerId));</span><br><span class="line">            EnsureAttribute&lt;<span class="built_in">string</span>&gt;(<span class="keyword">nameof</span>(Segment));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So there - now go forth and put your data in the xDB :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/06/Simplifying-Contact-Facets-with-C-6/" data-id="ckrl9emyk004z98q75ktq4dv6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Controlling-Rendering-Order-in-Sitecore-MVC" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/01/Controlling-Rendering-Order-in-Sitecore-MVC/">Controlling Rendering Order in Sitecore MVC</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/01/Controlling-Rendering-Order-in-Sitecore-MVC/">
    <time datetime="2017-01-14T00:25:47.000Z" itemprop="datePublished">January 13, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Back in the bad old Web Forms days, rendering a page was a multi-step process. There were <code>Init</code>, <code>Load</code>, <code>PreRender</code>, and <code>Render</code>, just to name a few. This was mostly a pain to deal with as it made it hard to know when in the page lifecycle you should place your code to deal with framework side effects. It also made its fair share of inane interview questions.</p>
<p>But it <em>did</em> mean one useful thing: there was a place you could put code where it would always run even if a rendering was output cached, that went before the page actually rendered. Why was this useful? Suppose you needed a certain CSS class on <code>&lt;body&gt;</code> when a specific rendering was added to the page. Maybe a rendering would override the <code>&lt;title&gt;</code>, or any number of other techniques* which require code to execute prior to page layout composition.</p>
<p>* most of these techniques are just as bad as Web Forms :P</p>
<p>When MVC became popular, it brought its own single-step rendering pipeline. This is awesome because it’s easy to understand: the page rendering starts at the top and works its way down, rendering partials and the like in order. No more “the form value is missing because you added the dynamic field after init so data binding had already run.” (Seriously?) Simple.</p>
<p>But in a single step pipeline, there’s no room for a later component to signal an earlier component anything. Take this for example:</p>
<pre><code>// support class
public class Body
&#123;
    public static string CssClass &#123; get; set; &#125;
&#125;

// layout
&lt;body class=&quot;@Body.CssClass&quot;&gt;
    @Html.Sitecore().Placeholder(&quot;wrapper&quot;)
&lt;/body&gt;

// inside wrapper, in a controller
public ActionResult Rendering()
&#123;
    Body.CssClass = &quot;🐘&quot;;
    return View();
&#125;
</code></pre>
<p>What will happen? Well, first the body tag will execute, then the <code>wrapper</code> placeholder will be executed. The body class will be set <em>after</em> the <code>&lt;body&gt;</code> tag has been rendered: there will be no class on the <code>body</code>.</p>
<p>There are two ways I know of to get around this.</p>
<h2 id="Use-a-Layout"><a href="#Use-a-Layout" class="headerlink" title="Use a Layout"></a>Use a Layout</h2><img src="/index.php/2017/01/Controlling-Rendering-Order-in-Sitecore-MVC/dawg.jpg" class="">

<p>A layout? Aren’t we already using one of those? Nope: an <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/layout">MVC layout</a>, not a Sitecore layout. In our example above, we could refactor the layout like this:</p>
<pre><code>// _Layout.cshtml
&lt;body class=&quot;@Body.CssClass&quot;&gt;
    @RenderBody()
&lt;/body&gt; 

// SitecoreLayout.cshtml
@&#123;
    Layout = &quot;~/Path/To/_Layout.cshtml&quot;;
&#125;

// the body of this is placed in the @RenderBody() in the MVC layout
@Html.Sitecore().Placeholder(&quot;wrapper&quot;)
</code></pre>
<p>Here the Sitecore layout inherits the MVC layout by setting the <code>Layout</code> property. This also has the side effect that the Sitecore view is executed <em>before</em> the MVC layout. So in our example, now the <code>SitecoreLayout.cshtml</code> is rendered (including the rendering which sets the body class), and then the <code>_Layout.cshtml</code> renders and places the Sitecore content in the <code>@RenderBody()</code>. The body class is thus set how we want.</p>
<p>MVC layouts are also a lovely tool if you have several Sitecore layouts which share a lot of common boilerplate wrapper code - for example, the same meta tags, favicon, or version footer - without duplicating them several times. <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/layout#sections">Sections</a> enable you to have your Sitecore layout also write to specific places in the MVC layout. For example you might choose to expose a <code>head</code> section to enable the Sitecore layout to add CSS files or analytics scripts to the MVC layout <code>&lt;head&gt;</code>.</p>
<h2 id="Reversed-Rendering"><a href="#Reversed-Rendering" class="headerlink" title="Reversed Rendering"></a>Reversed Rendering</h2><img src="/index.php/2017/01/Controlling-Rendering-Order-in-Sitecore-MVC/redpill.jpg" class="">

<p>The second way to control your renderings’ order is to use a technique I call Reversed Rendering. This is a simple trick that relies on the fact that HTML helpers are really just functions. This is a completely valid layout:</p>
<pre><code>@&#123;
    var wrapper = Html.Sitecore().Placeholder(&quot;wrapper&quot;);
&#125;

&lt;body class=&quot;@Body.CssClass&quot;&gt;
    @wrapper
&lt;/body&gt;
</code></pre>
<p>The <code>Placeholder()</code> method returns a <code>HtmlString</code> object, which contains the markup for the placeholder. You can take advantage of this to change the order by assigning the placeholder to a variable instead of rendering it directly into the output. Then you can control the order in which things render to make the body content render before the parent tags, thus facilitating communications.</p>
<p>I haven’t tried it (and performance wouldn’t be great dealing with large strings), but you could also theoretically use this trick to perform HTML post-processing on rendered renderings.</p>
<h2 id="What-about-output-caching"><a href="#What-about-output-caching" class="headerlink" title="What about output caching?"></a>What about output caching?</h2><p>Output caching gains performance by not executing the whole rendering pipeline and instead serving a pre-cached static version or a rendering. The problem is that by bypassing the rendering pipeline it also bypasses the code (controller or view) that pushes data up to the layout.</p>
<p>So when using these techniques, make sure to not enable output caching on any renderings that are setting variables used in the layout - or else the variables won’t be set as soon as the caching kicks in.</p>
<p>So there you have it. Go forth and have fun!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/01/Controlling-Rendering-Order-in-Sitecore-MVC/" data-id="ckrl9emyh004n98q75lmv2wwm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-EditContext-Considered-Harmful" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2017/01/EditContext-Considered-Harmful/">EditContext Considered Harmful</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2017/01/EditContext-Considered-Harmful/">
    <time datetime="2017-01-13T01:52:42.000Z" itemprop="datePublished">January 12, 2017</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you’ve worked with Sitecore for very long, you have probably needed to update an item’s content programmatically. A pattern in common usage for this is to use the <code>EditContext</code> class, for example:</p>
<pre><code>Item item;
using(new EditContext(item))
&#123;
    item[&quot;FieldName&quot;] = &quot;A new value&quot;;
&#125;
</code></pre>
<p>Unfortunately, it has a fatal flaw. A fatal flaw that Jakob Christensen <a target="_blank" rel="noopener" href="http://sitecore.alexiasoft.nl/2006/04/03/new-way-of-editing-items/#comment-16">pointed out <em>in 2006</em></a>. Unfortunately it’s still in wide use, and is not marked as obsolete. Hopefully this post can help change that!</p>
<p>The problem lies in the way the <code>using</code> statement works. It is effectively equivalent to this:</p>
<pre><code>var context = new EditContext(item);
try
&#123;
    item[&quot;FieldName&quot;] = &quot;A new value&quot;;
&#125;
finally
&#123;
    context.Dispose();
&#125;
</code></pre>
<p>An astute observer will notice that due to the <code>finally</code> semantic, the <code>EditContext</code> is <em>always disposed</em>, regardless of whether an exception occurs. Take this code for example:</p>
<pre><code>Item item;
using(new EditContext(item))
&#123;
    item[&quot;FieldA&quot;] = &quot;Sample&quot;;
    item[&quot;FieldB&quot;] = GetFieldValue();
    item[&quot;FieldC&quot;] = &quot;A new value&quot;;
&#125;

public string GetFieldValue() 
&#123;
    throw new ArgumentException(&quot;Let&#39;s address the elephant in the room.&quot;);
&#125;
</code></pre>
<p>In this example <code>GetFieldValue()</code> throws an exception. This will cause an immediate drop through to the <code>finally</code> of the <code>using</code> statement, which executes whether an exception is thrown or not. Which will <em>commit</em> the partial item change to <code>FieldA</code> without <code>FieldB</code> or <code>FieldC</code>, leaving the Sitecore item in an inconsistent state. Which you probably do not want.</p>
<h2 id="So-what-should-we-use"><a href="#So-what-should-we-use" class="headerlink" title="So what should we use?"></a>So what <em>should</em> we use?</h2><p>The correct way to edit an item is with the <code>Editing</code> property, for example:</p>
<pre><code>Item item;
item.Editing.BeginEdit();
item[&quot;FieldA&quot;] = &quot;Sample&quot;;
item[&quot;FieldB&quot;] = GetFieldValue();
item[&quot;FieldC&quot;] = &quot;A new value&quot;;
item.Editing.EndEdit();
</code></pre>
<p>Note how <code>EndEdit()</code> will <em>not</em> be called if an exception occurs. This prevents Sitecore from writing any field changes to the database (changes are queued up and committed all together when <code>EndEdit()</code> is called).</p>
<p>This syntax is however a bit hard to read, because it is difficult to parse the code compared to the neat indentation of <code>EditContext</code>. I would like to propose an alternative syntax, taking advantage of the fact that you can use <em>arbitrary braces</em> in C#:</p>
<pre><code>Item item;

item.Editing.BeginEdit();
&#123;
    item[&quot;FieldA&quot;] = &quot;Sample&quot;;
    item[&quot;FieldB&quot;] = GetFieldValue();
    item[&quot;FieldC&quot;] = &quot;A new value&quot;;
&#125;
item.Editing.EndEdit();
</code></pre>
<p>There! Now it reads nearly like <code>EditContext</code>, but does not suffer from its downsides :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2017/01/EditContext-Considered-Harmful/" data-id="ckrl9emyh004l98q77tzhbo68" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
      
        <div class="archive-year-wrap">
          <i class="fa fa-calendar"></i>
          <a href="/archives/2016" class="archive-year">2016</a>
        </div>
    
    <article id="post-Become-a-Sitecore-admin-without-a-login" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2016/10/Become-a-Sitecore-admin-without-a-login/">Become a Sitecore admin without a login</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2016/10/Become-a-Sitecore-admin-without-a-login/">
    <time datetime="2016-10-24T22:48:51.000Z" itemprop="datePublished">October 24, 2016</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Suppose someone sends you a Sitecore solution to review, and they forgot to send you a username and password. You could ask for one, or you could just make yourself an account with this handy trick that I call “The Shiv.” This is the entirety of the trick:</p>
<ol>
<li><p>Create a <code>Shiv.aspx</code> file somewhere under the webroot. It can be named anything.</p>
</li>
<li><p>Paste the following code in it</p>
<pre><code> &lt;%@ Page Language=&quot;C#&quot; AutoEventWireup=&quot;true&quot; %&gt;
 &lt;%@ Import Namespace=&quot;Sitecore.Security.Authentication&quot; %&gt;

 &lt;%
     AuthenticationManager.Login(&quot;sitecore\\admin&quot;, false, true);
     Response.Redirect(&quot;/sitecore/shell&quot;);
 %&gt;
</code></pre>
</li>
<li><p>Hit the page in a browser</p>
</li>
<li><p>Boom, you’re an administrator</p>
</li>
<li><p><strong>IMPORTANT</strong>: Delete the file. For obvious reasons.</p>
</li>
</ol>
<p>Handy, eh?</p>
<p>You can do a very similar thing using the “Login as administrator” option in <a target="_blank" rel="noopener" href="http://dl.sitecore.net/updater/sim/">SIM</a>, however I often find myself in environments without SIM and this code works anywhere.</p>
<p><img src="https://i.giphy.com/Njjakmj3DC7pS.gif" alt="bang"></p>
<p>This code is also a good security reminder: if someone malicious can upload an arbitrary file somewhere in your webroot that is then executed, <em>they can upload this shiv-file</em> and your security is gone. It doesn’t matter if you have encrypted 64-character database passwords, they’re in. It doesn’t matter if you’ve locked down TLS and imposed SAML logins, they’re in. Game over. So <a target="_blank" rel="noopener" href="https://doc.sitecore.net/sitecore_experience_platform/setting_up__maintaining/security_hardening/configuring/secure_the_file_upload_functionality">secure your filesystem</a> and be awfully wary of accepting users’ uploads anywhere on disk.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2016/10/Become-a-Sitecore-admin-without-a-login/" data-id="ckrl9emye004b98q72hfgentj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Nugetify-your-Sitecore-References" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/index.php/2016/09/Nugetify-your-Sitecore-References/">Nugetify your Sitecore References</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2016/09/Nugetify-your-Sitecore-References/">
    <time datetime="2016-09-20T23:01:17.000Z" itemprop="datePublished">September 20, 2016</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently, in a fit of brilliance, Sitecore released a <a target="_blank" rel="noopener" href="https://doc.sitecore.net/sitecore_experience_platform/developing/developing_with_sitecore/sitecore_public_nuget_packages_faq">public NuGet feed</a> that you can use to reference Sitecore assemblies from your projects. While some people have been doing this with home grown packages for years, it’s nice to have a stable, official source to get your references from. </p>
<p>If you’re not familiar with how this works, <a target="_blank" rel="noopener" href="https://jermdavis.wordpress.com/2016/09/05/the-official-sitecore-nuget-feed-is-here/">Jeremy Davis wrote a great post</a> about the details of using the official feed.</p>
<h2 id="Okay-so-what-are-you-on-about"><a href="#Okay-so-what-are-you-on-about" class="headerlink" title="Okay so what are you on about?"></a>Okay so what are you on about?</h2><p>If you’ve got a project of reasonable size, especially one using <a target="_blank" rel="noopener" href="http://helix.sitecore.net/">Helix</a>, you probably have a bucketload of references to Sitecore assemblies. Manually converting all these references to packages is a bit of a tedious process, and you know what we do to tedious processes around here.</p>
<img src="/index.php/2016/09/Nugetify-your-Sitecore-References/nugetify.jpg" class="">

<p>That’s right, we script them.</p>
<h2 id="How"><a href="#How" class="headerlink" title="How?"></a>How?</h2><p>Migrating your direct Sitecore references to NuGet is a quite simple process with this script. For obvious reasons, use source control so you have a fallback in case the script doesn’t work for your particular setup. It worked for me on several projects, but just in case :)</p>
<h3 id="1-Install-NuGet-config"><a href="#1-Install-NuGet-config" class="headerlink" title="1. Install NuGet.config"></a>1. Install NuGet.config</h3><p>Copy this to the root of your solution:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;configuration&gt;
  &lt;!--
  Used to specify the default Sources for list, install and update.
  --&gt;
  &lt;packageSources&gt;
    &lt;add key=&quot;Official Sitecore&quot; value=&quot;https://sitecore.myget.org/F/sc-packages/api/v3/index.json&quot; /&gt;
  &lt;/packageSources&gt;
  
  &lt;activePackageSource&gt;
    &lt;!-- this tells that all of them are active --&gt;
    &lt;add key=&quot;All&quot; value=&quot;(Aggregate source)&quot; /&gt;
  &lt;/activePackageSource&gt;
&lt;/configuration&gt;
</code></pre>
<p>This will add the official Sitecore NuGet package feed to your solution. Unlike adding it via Visual Studio, this will also apply for CI and MSBuild-executed builds.</p>
<h3 id="2-Copy-Nugetify-ps1"><a href="#2-Copy-Nugetify-ps1" class="headerlink" title="2. Copy Nugetify.ps1"></a>2. Copy <strong>Nugetify.ps1</strong></h3><p>Copy the following PowerShell script to the root of your solution. <strong>Open it in a text editor and set the correct <code>$SitecoreVersion</code> and <code>$FrameworkVersion</code></strong> for your solution. The NuGet feed has packages for Sitecore 7.0-8.2.</p>
<pre><code># Script to convert all sitecore assembly references to Sitecore Public NuGet feed
# Run from root solution folder (where your packages folder is)
# execute this script with powershell
Param
(
    $sitecoreVersion = &#39;8.2.160729&#39;, # NuGet package version to convert to. Format is major.minor.releasedate.
    $frameworkVersion = &#39;net452&#39; # for 8.2: net452. For 7.0-8.1: net45
)

$ScriptPath = $MyInvocation.MyCommand.Path
$ScriptDir  = Split-Path -Parent $ScriptPath
$MsbNSString = &#39;http://schemas.microsoft.com/developer/msbuild/2003&#39;
$MsbNS = @&#123;msb = $MsbNSString&#125;
$PackagesConfigFileName = &#39;packages.config&#39;

#Create project.json from packages.config
Write-Host &#39;Scanning for projects to update...&#39; -ForegroundColor Green
Get-ChildItem -path &#39;.&#39; -Recurse -Include $PackagesConfigFileName |
    ForEach &#123;
        $PackageFilePath = $_.FullName
        $PackageFileDir = $_.Directory
        Write-Host &quot;Processing $PackageFilePath&quot; -ForegroundColor Green

        # Find existing csproj to match direct references
        $csproj = Resolve-Path &quot;$($_.Directory)\*.csproj&quot;
        $proj = [xml] (Get-Content $csproj)

        # Find existing Sitecore references and NuGet-ify them
        Write-Host &quot;Checking for non-NuGet Sitecore references in $csproj&quot;
        $xpath = &quot;//msb:Reference/msb:HintPath[not(contains(.,&#39;packages\&#39;))]&quot;

        $changedProj = $false
        $sitecoreNuGetPackages = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;
            $node = $_.Node.ParentNode

            $referenceName = $node.Attributes[&#39;Include&#39;].Value.Split(&#39;,&#39;)[0]

              # Filter non-NuGet references to transform into NuGet packages
            if($referenceName.StartsWith(&quot;Sitecore&quot;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Modules&#39;) `
                -and -not $referenceName.Contains(&#39;WFFM&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Forms&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Foundation&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Feature&#39;) `
                -and -not ($referenceName.StartsWith(&#39;Sitecore&#39;) -and $referenceName.EndsWith(&#39;Website&#39;))) &#123;

                $changedProj = $true

                Write-Host &quot;NuGet-ifying assembly reference $referenceName&quot;

                # set hintPath to package path
                Push-Location -Path $PackageFileDir
                $hintPathRoot = Resolve-Path &quot;$ScriptDir\packages&quot; -Relative
                Pop-Location

                $hintPath = &quot;$hintPathRoot\$referenceName.NoReferences.$sitecoreVersion\lib\$frameworkVersion\$referenceName.dll&quot;

                $existingHintPath = $node[&#39;HintPath&#39;, $MsbNSString]
                if($existingHintPath -eq $null) &#123;
                    $hint = $proj.CreateElement(&quot;HintPath&quot;, $MsbNSString)
                    $hint.InnerXml = $hintPath
                    $foo = $node.AppendChild($hint)
                &#125; else &#123;
                    $existingHintPath.InnerXml = $hintPath
                &#125;

                &quot;$referenceName.NoReferences&quot;
            &#125;
        &#125;)

        if($changedProj) &#123;
            Write-Host &quot;Saving NuGet-ified references to csproj&quot; -ForegroundColor Yellow
            $proj.Save($csproj)
        &#125; else &#123;
            Write-Host &quot;Found no references to change.&quot;
        &#125;

        # Add packages to packages.config
        $packageXml = [xml] (Get-Content $PackageFilePath)

        $sitecoreNuGetPackages | % &#123;
            $packageNode = $packageXml.CreateElement(&#39;package&#39;);
            $packageNode.SetAttribute(&#39;id&#39;, $_)
            $packageNode.SetAttribute(&#39;version&#39;, $sitecoreVersion)
            $packageNode.SetAttribute(&#39;targetFramework&#39;, $frameworkVersion)

            $foo = $packageXml.DocumentElement.AppendChild($packageNode)
        &#125;

        Write-Host &quot;Updating packages.config with new packages&quot; -ForegroundColor Yellow
        $packageXml.Save($PackageFilePath)
    &#125;
</code></pre>
<h3 id="3-Run-Nugetify-ps1"><a href="#3-Run-Nugetify-ps1" class="headerlink" title="3. Run Nugetify.ps1"></a>3. Run <strong>Nugetify.ps1</strong></h3><p>Open a PowerShell and execute <code>Nugetify.ps1</code>.</p>
<p>That’s it. Open Visual Studio and verify that everything was converted correctly, and you should be good to go.</p>
<h2 id="What-about-NuGet-3-project-json"><a href="#What-about-NuGet-3-project-json" class="headerlink" title="What about NuGet 3 + project.json?"></a>What about NuGet 3 + <code>project.json</code>?</h2><p>Another option is to use the NuGet 3.x style package management which is integrated into a <code>project.json</code> file that lives next to your csproj files. NuGet 3’s major advantage is that the <code>project.json</code> both references packages <strong>and</strong> adds them to your project references. So adding packages does not result in alterations to the csproj file, and upgrading packages is as simple as changing a json file.</p>
<p>Sounds idyllic, right? Well there’s one huge downside. Microsoft, in their infinite wisdom, decided that it was not necessary to support content files being deployed into the project the package is installed into. For Sitecore projects, that means packages that come with config files, such as Unicorn, Synthesis, and Glass Mapper, will not install those files into projects using <code>project.json</code>. The content-containing packages can still be used, but then it becomes your task to reverse engineer the content they install, add that to your project, and handle upgrades of those content files when the package is upgraded.</p>
<p>For the moment, I wouldn’t use <code>project.json</code>, but I hope it becomes more tenable in the future. But if you want to use it, I have a script for that too - a script that both nugetifies your Sitecore references <strong>and</strong> converts <strong>all</strong> of your packages in <code>packages.config</code> to <code>project.json</code>. This script is based on <a target="_blank" rel="noopener" href="https://github.com/wgtmpeters/nugetprojectjson">this one</a>.</p>
<pre><code># Script to generate project.json for all packages.config file in the solution.
# This script will also migrate non-NuGet Sitecore package references to Sitecore Public NuGet feed

# Run from root solution folder
# execute this script with powershell

# TargetFramework: Use the .NET framework version your projects are targeting, which may NOT be the version Sitecore is built aginst
# SitecoreVersion: NuGet version you want to convert to for local sitecore assembly references
Param
(
      [string] $TargetFramework = &quot;net452&quot;,
    $sitecoreVersion = &#39;8.2.160729&#39;
)

# Filter existing installed NuGet packages to transform versions and such
function Filter-Packages &#123;
    $input | % &#123;
        $package = $_.Node.id
        $version = $_.Node.version

        # Translate nuget package generator 8.2 package version to official
        if($version -eq &quot;8.2.0.160729&quot;) &#123;
            $version = &quot;8.2.160729&quot;
        &#125;

        # Translate 3rd party refs from old SC versions to target public versions
        if($package.Equals(&#39;Microsoft.Extensions.DependencyInjection.Abstractions&#39;)) &#123;
            $version = &#39;1.0.0&#39;
        &#125;

        if($package.Equals(&#39;MongoDB.Driver&#39;)) &#123;
            $package = &#39;mongocsharpdriver&#39;
            $version = &#39;1.11.0&#39;
        &#125;

        # Blacklist these older sitecore nuget generator metapackages, modules, and nonexistant packages
        if($package.EndsWith(&quot;-Core&quot;) `
            -or $package.EndsWith(&quot;-CoreGroup&quot;) `
            -or $package.Equals(&#39;MongoDB.Bson&#39;) `
            -or $package.Equals(&quot;Telerik.Web.UI&quot;)) &#123;

            return # skip loop
        &#125;

        # Packages that started with Sitecore before should now get NoReferences for sanity (note: you may need to exclude sitecore modules whose name begins in Sitecore here)
        if($package.StartsWith(&#39;Sitecore&#39;) `
            -and -not $package.StartsWith(&#39;Sitecore.FakeDb&#39;) `
            -and -not $package.EndsWith(&#39;PatchableIgnoreList&#39;)) &#123;

            $package = &quot;$package.NoReferences&quot;;
        &#125;

        $_.Node.id = $package
        $_.Node.version = $version

        $_
    &#125;
&#125;

$ScriptPath = $MyInvocation.MyCommand.Path
$ScriptDir  = Split-Path -Parent $ScriptPath
$MsbNS = @&#123;msb = &#39;http://schemas.microsoft.com/developer/msbuild/2003&#39;&#125;
$PackagesConfigFileName = &#39;packages.config&#39;

#Create project.json from packages.config
Get-ChildItem -path &#39;.&#39; -Recurse -Include $PackagesConfigFileName |
    ForEach &#123;
        $PackageFilePath = $_.FullName
        $ProjectFilePath = $_.Directory.FullName + &#39;\project.json&#39;
        Write-Host &quot;Processing $PackageFilePath&quot;

        # Find existing csproj to match direct references
        $csproj = Resolve-Path &quot;$($_.Directory)\*.csproj&quot;
        $proj = [xml] (Get-Content $csproj)

        # Find existing Sitecore references and NuGet-ify them
        Write-Host &quot;Checking for non-NuGet Sitecore references in $csproj&quot;
        $xpath = &quot;//msb:Reference/msb:HintPath[not(contains(.,&#39;packages\&#39;))]&quot;

        $changedProj = $false
        $sitecoreNuGetPackages = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;
            $node = $_.Node.ParentNode

            $referenceName = $node.Attributes[&#39;Include&#39;].Value.Split(&#39;,&#39;)[0]

      # Filter non-NuGet references to transform into NuGet packages
            if($referenceName.StartsWith(&quot;Sitecore&quot;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Modules&#39;) `
        -and -not $referenceName.Contains(&#39;WFFM&#39;) `
        -and -not $referenceName.StartsWith(&#39;Sitecore.Forms&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Foundation&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Feature&#39;) `
                -and -not ($referenceName.StartsWith(&#39;Sitecore&#39;) -and $referenceName.EndsWith(&#39;Website&#39;))) &#123;

                $changedProj = $true

                Write-Host &quot;NuGet-ifying assembly reference $referenceName&quot;

                # remove old reference we&#39;re NuGet-ing
                [void]$node.ParentNode.RemoveChild($node);

                &quot;$referenceName.NoReferences&quot;
            &#125;
        &#125;)

        if($changedProj) &#123;
            Write-Host &quot;Saving NuGet-ified references in $csproj&quot;
            $proj.Save($csproj)
        &#125;

        # Generate project.json
        $file = &#39;&#123;
  &quot;dependencies&quot;: &#123;
&#39;

$packages = (Select-xml -xpath &#39;//package&#39; -Path $PackageFilePath | Filter-Packages | % &#123; &quot;    &quot;&quot;&#123;0&#125;&quot;&quot;: &quot;&quot;&#123;1&#125;&quot;&quot;&quot; -f $_.Node.id,$_.Node.version &#125;) -join &quot;,`r`n&quot;

$file += $packages;

$sitecorePackages = (($sitecoreNuGetPackages | % &#123; &quot;    &quot;&quot;&#123;0&#125;&quot;&quot;: &quot;&quot;&#123;1&#125;&quot;&quot;&quot; -f $_, $sitecoreVersion &#125;) -join &quot;,`r`n&quot;)

# separate the json elements if both converted and sitecore packages exist
if($packages.Length -gt 0) &#123;
    $file += &quot;,`r`n&quot;
&#125; else &#123;
    $file += &quot;`r`n&quot;
&#125;

$file += $sitecorePackages

$file += &#39;
  &#125;,
  &quot;frameworks&quot;: &#123;
    &quot;&#39; + $TargetFramework + &#39;&quot;: &#123;&#125;
  &#125;,
  &quot;runtimes&quot;:  &#123;
      &quot;win-anycpu&quot;: &#123;&#125;,
      &quot;win&quot;: &#123;&#125;
  &#125;
&#125;&#39;

$file | Out-File $ProjectFilePath

    Remove-Item $PackageFilePath
&#125;

Get-ChildItem -path &#39;.&#39; -Recurse -Include &#39;*.csproj&#39; | ForEach &#123;
    $CsProjFilePath = $_.FullName
    $ProjectFilePath = $_.Directory.FullName + &#39;\project.json&#39;

    Write-Host $csProjFilePath

    $proj = [xml] (Get-Content $CsProjFilePath)

    #Remove all references to ..packages files
    $xpath = &quot;//msb:Reference/msb:HintPath[contains(.,&#39;packages\&#39;)]&quot;
    $nodes = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    if (!$nodes) &#123; Write-Verbose &quot;RemoveElement: XPath $XPath not found&quot; &#125;
    Write-Output &#39;Reference Nodes found: &#39; $nodes.Count
    foreach($node in $nodes) &#123;
        $referenceNode = $node.ParentNode
        $itemGroupNode = $referenceNode.ParentNode
        [void]$itemGroupNode.RemoveChild($referenceNode)
    &#125;
    [System.XML.XMLElement] $itemGroupNoneNode = $null
    #Find itemgroup with None Elements, if not found add.
    $itemGroupNoneNodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:None&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;$itemGroupNoneNode found: &#39; $itemGroupNoneNodes.Count
    if($itemGroupNoneNodes.Count -eq 0)&#123;
        # create itemgroup element for None nodes.
        Write-Output &#39;Adding ItemGroup for None Nodes&#39;
        $itemGroupNoneNode =  $proj.CreateElement(&#39;ItemGroup&#39;,$proj.DocumentElement.NamespaceURI)
        $itemGroupNodes = @(Select-Xml -xpath &quot;//msb:ItemGroup&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        #$itemGroupNodes.Count
        [void]$proj.DocumentElement.InsertAfter($itemGroupNoneNode,$itemGroupNodes[$itemGroupNodes.Count-1])

    &#125;else&#123;
        $itemGroupNoneNode = $itemGroupNoneNodes[0].ParentNode
    &#125;

    #Remove packages.config from ItemGroup
    $nodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:None[@Include=&#39;packages.config&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;packages.config Nodes found: &#39; $nodes.Count
    foreach($node in $nodes) &#123;
        $itemGroupNode = $node.ParentNode
        [void]$itemGroupNode.RemoveChild($node)
    &#125;

    #Remove packages.config from ItemGroup (if it was set to content)
    $nodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:Content[@Include=&#39;packages.config&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;packages.config Nodes found: &#39; $nodes.Count
    foreach($node in $nodes) &#123;
        $itemGroupNode = $node.ParentNode
        [void]$itemGroupNode.RemoveChild($node)
    &#125;

    #Remove build target EnsureNuGetPackageBuildImports from csproj
    $nodes = @(Select-Xml -xpath &quot;//msb:Target[@Name=&#39;EnsureNuGetPackageBuildImports&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;EnsureNuGetPackageBuildImports target found: &#39; $nodes.CountAd
    foreach($node in $nodes) &#123;
        $itemGroupNode = $node.ParentNode
        [void]$itemGroupNode.RemoveChild($node)
    &#125;

    #Add project.json to itemGroup
    if( Test-Path $ProjectFilePath)&#123;
        $nodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:None[@Include=&#39;project.json&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        if($nodes.Count -eq 0)&#123;
            $projectJsonNoneNode = $proj.CreateElement(&quot;None&quot;, $proj.DocumentElement.NamespaceURI)
            $projectJsonNoneNode.SetAttribute(&quot;Include&quot;,&quot;project.json&quot;)
            [void]$itemGroupNoneNode.AppendChild($projectJsonNoneNode)
            Write-Output &#39;Adding None node for project.json&#39;
        &#125;
    &#125;

    #add PropertyGroup nodes targetFrameworkProfile, CopyNuGetImplementations, PlatformTarget
    # Find the TargetFrameworkVersion to be used to find the parent PropertyGroup node
    $xpath = &quot;//msb:PropertyGroup/msb:TargetFrameworkVersion&quot;
    $nodes = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    if ($nodes.Count -gt 0) &#123;
        [System.XML.XMLElement] $node = $nodes[0]
        $propertyGroupNode = $node.ParentNode
        $nodes = @(Select-Xml -xpath &quot;//msb:PropertyGroup/msb:TargetFrameworkProfile&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        if($nodes.Count -eq 0)&#123;
            $node = $proj.CreateElement(&quot;TargetFrameworkProfile&quot;, $proj.DocumentElement.NamespaceURI)
            [void]$propertyGroupNode.AppendChild($node)
            Write-Output &#39;Adding TargetFrameworkProfile node for PropertyGroup&#39;
        &#125;
        #$nodes = @(Select-Xml -xpath &quot;//msb:PropertyGroup/msb:CopyNuGetImplementations&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        #if($nodes.Count -eq 0)&#123;
        #    $node = $proj.CreateElement(&quot;CopyNuGetImplementations&quot;, $proj.DocumentElement.NamespaceURI)
        #    $textnode = $proj.CreateTextNode(&quot;true&quot;)
        #    $node.AppendChild($textnode)
        #    [void]$propertyGroupNode.AppendChild($node)
        #    Write-Output &#39;Adding CopyNuGetImplementations node for PropertyGroup&#39;
        #&#125;
        $nodes = @(Select-Xml -xpath &quot;//msb:PropertyGroup/msb:PlatformTarget[not(@*)]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        if($nodes.Count -eq 0)&#123;
            $node = $proj.CreateElement(&quot;PlatformTarget&quot;, $proj.DocumentElement.NamespaceURI)
            $textnode = $proj.CreateTextNode(&quot;AnyCPU&quot;)
            $foo = $node.AppendChild($textnode)
            [void]$propertyGroupNode.AppendChild($node)
            Write-Output &#39;Adding PlatformTarget node for PropertyGroup&#39;
        &#125;
    &#125;

    # replace ToolsVersion with 14.0
    $attibutes = Select-Xml -xpath &quot;//@ToolsVersion&quot; $proj -Namespace $MsbNS
    foreach ($attribute in $attibutes)&#123;

        $attribute.Node.value = &quot;14.0&quot;
        Write-Output &#39;Setting ToolsVersion to 14.0&#39;
    &#125;

    $proj.Save($CsProjFilePath)
 &#125;
</code></pre>
<p>Till next time, happy NuGetting!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2016/09/Nugetify-your-Sitecore-References/" data-id="ckrl9emyz006498q72acmf52o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/index.php/category/Sitecore/index.php/page/2/">2</a><a class="page-number" href="/index.php/category/Sitecore/index.php/page/3/">3</a><a class="page-number" href="/index.php/category/Sitecore/index.php/page/4/">4</a><a class="extend next" rel="next" href="/index.php/category/Sitecore/index.php/page/2/">Next &amp;raquo;</a>
    </nav>
  
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JavaScript/">JavaScript</a></p>
              <p class="item-title"><a href="/index.php/2021/07/Fun-with-async-generators-and-for-await/" class="title">Fun with async generators and for await</a></p>
              <p class="item-date"><time datetime="2021-07-26T23:30:51.000Z" itemprop="datePublished">July 26, 2021</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/Jamstack/">Jamstack</a></p>
              <p class="item-title"><a href="/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/" class="title">Deploying multiple Netlify sites from one monorepo</a></p>
              <p class="item-date"><time datetime="2020-08-21T03:30:32.000Z" itemprop="datePublished">August 20, 2020</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/" class="title">Running JSS headless mode in containers part 2: Build containers</a></p>
              <p class="item-date"><time datetime="2019-09-16T02:14:04.000Z" itemprop="datePublished">September 15, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/" class="title">Running JSS headless mode in containers, part 1</a></p>
              <p class="item-date"><time datetime="2019-09-08T19:00:36.000Z" itemprop="datePublished">September 8, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/C/">C#</a></p>
              <p class="item-title"><a href="/index.php/2019/05/Build-2019-All-the-things/" class="title">Build 2019: All the things</a></p>
              <p class="item-date"><time datetime="2019-05-10T23:01:11.000Z" itemprop="datePublished">May 10, 2019</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Crypto/">Crypto</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Lucene/">Lucene</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/MVC/">MVC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Search/">Search</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/xDB/">xDB</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>&copy; 2021 Kam Figy</p>
      <p><small>Opinions expressed on this blog are my own, and not necessarily those of my employer.</small></p>
     <p><small>This work is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</small></p>
    </div>
  </div>
</footer>
    


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>