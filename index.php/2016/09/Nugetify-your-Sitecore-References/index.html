<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Nugetify your Sitecore References | Kam&#39;s Idea Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Recently, in a fit of brilliance, Sitecore released a public NuGet feed that you can use to reference Sitecore assemblies from your projects. While some people have been doing this with home grown pac">
<meta property="og:type" content="article">
<meta property="og:title" content="Nugetify your Sitecore References">
<meta property="og:url" content="https://kamsar.net/index.php/2016/09/Nugetify-your-Sitecore-References/index.html">
<meta property="og:site_name" content="Kam&#39;s Idea Log">
<meta property="og:description" content="Recently, in a fit of brilliance, Sitecore released a public NuGet feed that you can use to reference Sitecore assemblies from your projects. While some people have been doing this with home grown pac">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://kamsar.net/index.php/2016/09/Nugetify-your-Sitecore-References/nugetify.jpg">
<meta property="article:published_time" content="2016-09-20T23:01:17.000Z">
<meta property="article:modified_time" content="2021-07-26T23:19:02.483Z">
<meta property="article:author" content="Kam Figy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kamsar.net/index.php/2016/09/Nugetify-your-Sitecore-References/nugetify.jpg">
<meta name="twitter:creator" content="@kamsar">
  
    <link rel="alternative" href="/index.php/feed" title="Kam&#39;s Idea Log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62284328-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo">
        <span class="site-title">Kam&#39;s Idea Log</span>
        <span class="subtitle">C#, Jamstack, and Shenanigans</span>
      </a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=40" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=80 2x" alt="omg the beard"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://kamsar.net"></form>
      </td>
      </tr>
    </table>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=128" srcset="https://www.gravatar.com/avatar/314826f5d569260f26ac9f26f9e38b86?s=256 2x" alt="#sitecorebeard">
      <h2 id="name">Kam Figy</h2>
      <h3 id="title">Principal Platform Architect at</h3>
      <a class="corp-logo" href="https://uniform.dev" target="_blank"><img src="/css/images/uniform-logo.svg" alt="Uniform" width="180"></a>
      <span id="location"><i class="fa fa-map-marker"></i>Vancouver, WA USA</span>
      <a id="follow" target="_blank" rel="noopener" href="https://twitter.com/kamsar">FOLLOW</a>
  	</div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a target="_blank" rel="noopener" href="https://github.com/kamsar" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a target="_blank" rel="noopener" href="https://twitter.com/kamsar" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/index.php/feed" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    <div class="article-info profile-block bio">
      <h2>About</h2>
      <p>Kam has been making websites since 1996, starting out with a 14.4k modem on a <a href="https://en.wikipedia.org/wiki/Party_line_(telephony)" target="_blank">party line</a> in the Hawaiian rainforest. A veteran developer, architect, and speaker, he's been working in the content management space for well over a decade. Kam is the author of <a href="https://github.com/kamsar/Unicorn" target="_blank">Unicorn</a>, <a href="https://github.com/kamsar/Synthesis" target="_blank">Synthesis</a>, <a href="https://github.com/kamsar/Dianoga" target="_blank">Dianoga</a>, and several other open-source libraries.</p>
    </div>
  </div>
</aside>
      <section id="main"><article id="post-Nugetify-your-Sitecore-References" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Nugetify your Sitecore References
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/index.php/2016/09/Nugetify-your-Sitecore-References/">
    <time datetime="2016-09-20T23:01:17.000Z" itemprop="datePublished">September 20, 2016</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/index.php/category/Sitecore/">Sitecore</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently, in a fit of brilliance, Sitecore released a <a target="_blank" rel="noopener" href="https://doc.sitecore.net/sitecore_experience_platform/developing/developing_with_sitecore/sitecore_public_nuget_packages_faq">public NuGet feed</a> that you can use to reference Sitecore assemblies from your projects. While some people have been doing this with home grown packages for years, it’s nice to have a stable, official source to get your references from. </p>
<p>If you’re not familiar with how this works, <a target="_blank" rel="noopener" href="https://jermdavis.wordpress.com/2016/09/05/the-official-sitecore-nuget-feed-is-here/">Jeremy Davis wrote a great post</a> about the details of using the official feed.</p>
<h2 id="Okay-so-what-are-you-on-about"><a href="#Okay-so-what-are-you-on-about" class="headerlink" title="Okay so what are you on about?"></a>Okay so what are you on about?</h2><p>If you’ve got a project of reasonable size, especially one using <a target="_blank" rel="noopener" href="http://helix.sitecore.net/">Helix</a>, you probably have a bucketload of references to Sitecore assemblies. Manually converting all these references to packages is a bit of a tedious process, and you know what we do to tedious processes around here.</p>
<img src="/index.php/2016/09/Nugetify-your-Sitecore-References/nugetify.jpg" class="">

<p>That’s right, we script them.</p>
<h2 id="How"><a href="#How" class="headerlink" title="How?"></a>How?</h2><p>Migrating your direct Sitecore references to NuGet is a quite simple process with this script. For obvious reasons, use source control so you have a fallback in case the script doesn’t work for your particular setup. It worked for me on several projects, but just in case :)</p>
<h3 id="1-Install-NuGet-config"><a href="#1-Install-NuGet-config" class="headerlink" title="1. Install NuGet.config"></a>1. Install NuGet.config</h3><p>Copy this to the root of your solution:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;configuration&gt;
  &lt;!--
  Used to specify the default Sources for list, install and update.
  --&gt;
  &lt;packageSources&gt;
    &lt;add key=&quot;Official Sitecore&quot; value=&quot;https://sitecore.myget.org/F/sc-packages/api/v3/index.json&quot; /&gt;
  &lt;/packageSources&gt;
  
  &lt;activePackageSource&gt;
    &lt;!-- this tells that all of them are active --&gt;
    &lt;add key=&quot;All&quot; value=&quot;(Aggregate source)&quot; /&gt;
  &lt;/activePackageSource&gt;
&lt;/configuration&gt;
</code></pre>
<p>This will add the official Sitecore NuGet package feed to your solution. Unlike adding it via Visual Studio, this will also apply for CI and MSBuild-executed builds.</p>
<h3 id="2-Copy-Nugetify-ps1"><a href="#2-Copy-Nugetify-ps1" class="headerlink" title="2. Copy Nugetify.ps1"></a>2. Copy <strong>Nugetify.ps1</strong></h3><p>Copy the following PowerShell script to the root of your solution. <strong>Open it in a text editor and set the correct <code>$SitecoreVersion</code> and <code>$FrameworkVersion</code></strong> for your solution. The NuGet feed has packages for Sitecore 7.0-8.2.</p>
<pre><code># Script to convert all sitecore assembly references to Sitecore Public NuGet feed
# Run from root solution folder (where your packages folder is)
# execute this script with powershell
Param
(
    $sitecoreVersion = &#39;8.2.160729&#39;, # NuGet package version to convert to. Format is major.minor.releasedate.
    $frameworkVersion = &#39;net452&#39; # for 8.2: net452. For 7.0-8.1: net45
)

$ScriptPath = $MyInvocation.MyCommand.Path
$ScriptDir  = Split-Path -Parent $ScriptPath
$MsbNSString = &#39;http://schemas.microsoft.com/developer/msbuild/2003&#39;
$MsbNS = @&#123;msb = $MsbNSString&#125;
$PackagesConfigFileName = &#39;packages.config&#39;

#Create project.json from packages.config
Write-Host &#39;Scanning for projects to update...&#39; -ForegroundColor Green
Get-ChildItem -path &#39;.&#39; -Recurse -Include $PackagesConfigFileName |
    ForEach &#123;
        $PackageFilePath = $_.FullName
        $PackageFileDir = $_.Directory
        Write-Host &quot;Processing $PackageFilePath&quot; -ForegroundColor Green

        # Find existing csproj to match direct references
        $csproj = Resolve-Path &quot;$($_.Directory)\*.csproj&quot;
        $proj = [xml] (Get-Content $csproj)

        # Find existing Sitecore references and NuGet-ify them
        Write-Host &quot;Checking for non-NuGet Sitecore references in $csproj&quot;
        $xpath = &quot;//msb:Reference/msb:HintPath[not(contains(.,&#39;packages\&#39;))]&quot;

        $changedProj = $false
        $sitecoreNuGetPackages = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;
            $node = $_.Node.ParentNode

            $referenceName = $node.Attributes[&#39;Include&#39;].Value.Split(&#39;,&#39;)[0]

              # Filter non-NuGet references to transform into NuGet packages
            if($referenceName.StartsWith(&quot;Sitecore&quot;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Modules&#39;) `
                -and -not $referenceName.Contains(&#39;WFFM&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Forms&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Foundation&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Feature&#39;) `
                -and -not ($referenceName.StartsWith(&#39;Sitecore&#39;) -and $referenceName.EndsWith(&#39;Website&#39;))) &#123;

                $changedProj = $true

                Write-Host &quot;NuGet-ifying assembly reference $referenceName&quot;

                # set hintPath to package path
                Push-Location -Path $PackageFileDir
                $hintPathRoot = Resolve-Path &quot;$ScriptDir\packages&quot; -Relative
                Pop-Location

                $hintPath = &quot;$hintPathRoot\$referenceName.NoReferences.$sitecoreVersion\lib\$frameworkVersion\$referenceName.dll&quot;

                $existingHintPath = $node[&#39;HintPath&#39;, $MsbNSString]
                if($existingHintPath -eq $null) &#123;
                    $hint = $proj.CreateElement(&quot;HintPath&quot;, $MsbNSString)
                    $hint.InnerXml = $hintPath
                    $foo = $node.AppendChild($hint)
                &#125; else &#123;
                    $existingHintPath.InnerXml = $hintPath
                &#125;

                &quot;$referenceName.NoReferences&quot;
            &#125;
        &#125;)

        if($changedProj) &#123;
            Write-Host &quot;Saving NuGet-ified references to csproj&quot; -ForegroundColor Yellow
            $proj.Save($csproj)
        &#125; else &#123;
            Write-Host &quot;Found no references to change.&quot;
        &#125;

        # Add packages to packages.config
        $packageXml = [xml] (Get-Content $PackageFilePath)

        $sitecoreNuGetPackages | % &#123;
            $packageNode = $packageXml.CreateElement(&#39;package&#39;);
            $packageNode.SetAttribute(&#39;id&#39;, $_)
            $packageNode.SetAttribute(&#39;version&#39;, $sitecoreVersion)
            $packageNode.SetAttribute(&#39;targetFramework&#39;, $frameworkVersion)

            $foo = $packageXml.DocumentElement.AppendChild($packageNode)
        &#125;

        Write-Host &quot;Updating packages.config with new packages&quot; -ForegroundColor Yellow
        $packageXml.Save($PackageFilePath)
    &#125;
</code></pre>
<h3 id="3-Run-Nugetify-ps1"><a href="#3-Run-Nugetify-ps1" class="headerlink" title="3. Run Nugetify.ps1"></a>3. Run <strong>Nugetify.ps1</strong></h3><p>Open a PowerShell and execute <code>Nugetify.ps1</code>.</p>
<p>That’s it. Open Visual Studio and verify that everything was converted correctly, and you should be good to go.</p>
<h2 id="What-about-NuGet-3-project-json"><a href="#What-about-NuGet-3-project-json" class="headerlink" title="What about NuGet 3 + project.json?"></a>What about NuGet 3 + <code>project.json</code>?</h2><p>Another option is to use the NuGet 3.x style package management which is integrated into a <code>project.json</code> file that lives next to your csproj files. NuGet 3’s major advantage is that the <code>project.json</code> both references packages <strong>and</strong> adds them to your project references. So adding packages does not result in alterations to the csproj file, and upgrading packages is as simple as changing a json file.</p>
<p>Sounds idyllic, right? Well there’s one huge downside. Microsoft, in their infinite wisdom, decided that it was not necessary to support content files being deployed into the project the package is installed into. For Sitecore projects, that means packages that come with config files, such as Unicorn, Synthesis, and Glass Mapper, will not install those files into projects using <code>project.json</code>. The content-containing packages can still be used, but then it becomes your task to reverse engineer the content they install, add that to your project, and handle upgrades of those content files when the package is upgraded.</p>
<p>For the moment, I wouldn’t use <code>project.json</code>, but I hope it becomes more tenable in the future. But if you want to use it, I have a script for that too - a script that both nugetifies your Sitecore references <strong>and</strong> converts <strong>all</strong> of your packages in <code>packages.config</code> to <code>project.json</code>. This script is based on <a target="_blank" rel="noopener" href="https://github.com/wgtmpeters/nugetprojectjson">this one</a>.</p>
<pre><code># Script to generate project.json for all packages.config file in the solution.
# This script will also migrate non-NuGet Sitecore package references to Sitecore Public NuGet feed

# Run from root solution folder
# execute this script with powershell

# TargetFramework: Use the .NET framework version your projects are targeting, which may NOT be the version Sitecore is built aginst
# SitecoreVersion: NuGet version you want to convert to for local sitecore assembly references
Param
(
      [string] $TargetFramework = &quot;net452&quot;,
    $sitecoreVersion = &#39;8.2.160729&#39;
)

# Filter existing installed NuGet packages to transform versions and such
function Filter-Packages &#123;
    $input | % &#123;
        $package = $_.Node.id
        $version = $_.Node.version

        # Translate nuget package generator 8.2 package version to official
        if($version -eq &quot;8.2.0.160729&quot;) &#123;
            $version = &quot;8.2.160729&quot;
        &#125;

        # Translate 3rd party refs from old SC versions to target public versions
        if($package.Equals(&#39;Microsoft.Extensions.DependencyInjection.Abstractions&#39;)) &#123;
            $version = &#39;1.0.0&#39;
        &#125;

        if($package.Equals(&#39;MongoDB.Driver&#39;)) &#123;
            $package = &#39;mongocsharpdriver&#39;
            $version = &#39;1.11.0&#39;
        &#125;

        # Blacklist these older sitecore nuget generator metapackages, modules, and nonexistant packages
        if($package.EndsWith(&quot;-Core&quot;) `
            -or $package.EndsWith(&quot;-CoreGroup&quot;) `
            -or $package.Equals(&#39;MongoDB.Bson&#39;) `
            -or $package.Equals(&quot;Telerik.Web.UI&quot;)) &#123;

            return # skip loop
        &#125;

        # Packages that started with Sitecore before should now get NoReferences for sanity (note: you may need to exclude sitecore modules whose name begins in Sitecore here)
        if($package.StartsWith(&#39;Sitecore&#39;) `
            -and -not $package.StartsWith(&#39;Sitecore.FakeDb&#39;) `
            -and -not $package.EndsWith(&#39;PatchableIgnoreList&#39;)) &#123;

            $package = &quot;$package.NoReferences&quot;;
        &#125;

        $_.Node.id = $package
        $_.Node.version = $version

        $_
    &#125;
&#125;

$ScriptPath = $MyInvocation.MyCommand.Path
$ScriptDir  = Split-Path -Parent $ScriptPath
$MsbNS = @&#123;msb = &#39;http://schemas.microsoft.com/developer/msbuild/2003&#39;&#125;
$PackagesConfigFileName = &#39;packages.config&#39;

#Create project.json from packages.config
Get-ChildItem -path &#39;.&#39; -Recurse -Include $PackagesConfigFileName |
    ForEach &#123;
        $PackageFilePath = $_.FullName
        $ProjectFilePath = $_.Directory.FullName + &#39;\project.json&#39;
        Write-Host &quot;Processing $PackageFilePath&quot;

        # Find existing csproj to match direct references
        $csproj = Resolve-Path &quot;$($_.Directory)\*.csproj&quot;
        $proj = [xml] (Get-Content $csproj)

        # Find existing Sitecore references and NuGet-ify them
        Write-Host &quot;Checking for non-NuGet Sitecore references in $csproj&quot;
        $xpath = &quot;//msb:Reference/msb:HintPath[not(contains(.,&#39;packages\&#39;))]&quot;

        $changedProj = $false
        $sitecoreNuGetPackages = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;
            $node = $_.Node.ParentNode

            $referenceName = $node.Attributes[&#39;Include&#39;].Value.Split(&#39;,&#39;)[0]

      # Filter non-NuGet references to transform into NuGet packages
            if($referenceName.StartsWith(&quot;Sitecore&quot;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Modules&#39;) `
        -and -not $referenceName.Contains(&#39;WFFM&#39;) `
        -and -not $referenceName.StartsWith(&#39;Sitecore.Forms&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Foundation&#39;) `
                -and -not $referenceName.StartsWith(&#39;Sitecore.Feature&#39;) `
                -and -not ($referenceName.StartsWith(&#39;Sitecore&#39;) -and $referenceName.EndsWith(&#39;Website&#39;))) &#123;

                $changedProj = $true

                Write-Host &quot;NuGet-ifying assembly reference $referenceName&quot;

                # remove old reference we&#39;re NuGet-ing
                [void]$node.ParentNode.RemoveChild($node);

                &quot;$referenceName.NoReferences&quot;
            &#125;
        &#125;)

        if($changedProj) &#123;
            Write-Host &quot;Saving NuGet-ified references in $csproj&quot;
            $proj.Save($csproj)
        &#125;

        # Generate project.json
        $file = &#39;&#123;
  &quot;dependencies&quot;: &#123;
&#39;

$packages = (Select-xml -xpath &#39;//package&#39; -Path $PackageFilePath | Filter-Packages | % &#123; &quot;    &quot;&quot;&#123;0&#125;&quot;&quot;: &quot;&quot;&#123;1&#125;&quot;&quot;&quot; -f $_.Node.id,$_.Node.version &#125;) -join &quot;,`r`n&quot;

$file += $packages;

$sitecorePackages = (($sitecoreNuGetPackages | % &#123; &quot;    &quot;&quot;&#123;0&#125;&quot;&quot;: &quot;&quot;&#123;1&#125;&quot;&quot;&quot; -f $_, $sitecoreVersion &#125;) -join &quot;,`r`n&quot;)

# separate the json elements if both converted and sitecore packages exist
if($packages.Length -gt 0) &#123;
    $file += &quot;,`r`n&quot;
&#125; else &#123;
    $file += &quot;`r`n&quot;
&#125;

$file += $sitecorePackages

$file += &#39;
  &#125;,
  &quot;frameworks&quot;: &#123;
    &quot;&#39; + $TargetFramework + &#39;&quot;: &#123;&#125;
  &#125;,
  &quot;runtimes&quot;:  &#123;
      &quot;win-anycpu&quot;: &#123;&#125;,
      &quot;win&quot;: &#123;&#125;
  &#125;
&#125;&#39;

$file | Out-File $ProjectFilePath

    Remove-Item $PackageFilePath
&#125;

Get-ChildItem -path &#39;.&#39; -Recurse -Include &#39;*.csproj&#39; | ForEach &#123;
    $CsProjFilePath = $_.FullName
    $ProjectFilePath = $_.Directory.FullName + &#39;\project.json&#39;

    Write-Host $csProjFilePath

    $proj = [xml] (Get-Content $CsProjFilePath)

    #Remove all references to ..packages files
    $xpath = &quot;//msb:Reference/msb:HintPath[contains(.,&#39;packages\&#39;)]&quot;
    $nodes = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    if (!$nodes) &#123; Write-Verbose &quot;RemoveElement: XPath $XPath not found&quot; &#125;
    Write-Output &#39;Reference Nodes found: &#39; $nodes.Count
    foreach($node in $nodes) &#123;
        $referenceNode = $node.ParentNode
        $itemGroupNode = $referenceNode.ParentNode
        [void]$itemGroupNode.RemoveChild($referenceNode)
    &#125;
    [System.XML.XMLElement] $itemGroupNoneNode = $null
    #Find itemgroup with None Elements, if not found add.
    $itemGroupNoneNodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:None&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;$itemGroupNoneNode found: &#39; $itemGroupNoneNodes.Count
    if($itemGroupNoneNodes.Count -eq 0)&#123;
        # create itemgroup element for None nodes.
        Write-Output &#39;Adding ItemGroup for None Nodes&#39;
        $itemGroupNoneNode =  $proj.CreateElement(&#39;ItemGroup&#39;,$proj.DocumentElement.NamespaceURI)
        $itemGroupNodes = @(Select-Xml -xpath &quot;//msb:ItemGroup&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        #$itemGroupNodes.Count
        [void]$proj.DocumentElement.InsertAfter($itemGroupNoneNode,$itemGroupNodes[$itemGroupNodes.Count-1])

    &#125;else&#123;
        $itemGroupNoneNode = $itemGroupNoneNodes[0].ParentNode
    &#125;

    #Remove packages.config from ItemGroup
    $nodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:None[@Include=&#39;packages.config&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;packages.config Nodes found: &#39; $nodes.Count
    foreach($node in $nodes) &#123;
        $itemGroupNode = $node.ParentNode
        [void]$itemGroupNode.RemoveChild($node)
    &#125;

    #Remove packages.config from ItemGroup (if it was set to content)
    $nodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:Content[@Include=&#39;packages.config&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;packages.config Nodes found: &#39; $nodes.Count
    foreach($node in $nodes) &#123;
        $itemGroupNode = $node.ParentNode
        [void]$itemGroupNode.RemoveChild($node)
    &#125;

    #Remove build target EnsureNuGetPackageBuildImports from csproj
    $nodes = @(Select-Xml -xpath &quot;//msb:Target[@Name=&#39;EnsureNuGetPackageBuildImports&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    Write-Output &#39;EnsureNuGetPackageBuildImports target found: &#39; $nodes.CountAd
    foreach($node in $nodes) &#123;
        $itemGroupNode = $node.ParentNode
        [void]$itemGroupNode.RemoveChild($node)
    &#125;

    #Add project.json to itemGroup
    if( Test-Path $ProjectFilePath)&#123;
        $nodes = @(Select-Xml -xpath &quot;//msb:ItemGroup/msb:None[@Include=&#39;project.json&#39;]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        if($nodes.Count -eq 0)&#123;
            $projectJsonNoneNode = $proj.CreateElement(&quot;None&quot;, $proj.DocumentElement.NamespaceURI)
            $projectJsonNoneNode.SetAttribute(&quot;Include&quot;,&quot;project.json&quot;)
            [void]$itemGroupNoneNode.AppendChild($projectJsonNoneNode)
            Write-Output &#39;Adding None node for project.json&#39;
        &#125;
    &#125;

    #add PropertyGroup nodes targetFrameworkProfile, CopyNuGetImplementations, PlatformTarget
    # Find the TargetFrameworkVersion to be used to find the parent PropertyGroup node
    $xpath = &quot;//msb:PropertyGroup/msb:TargetFrameworkVersion&quot;
    $nodes = @(Select-Xml -xpath $xpath $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
    if ($nodes.Count -gt 0) &#123;
        [System.XML.XMLElement] $node = $nodes[0]
        $propertyGroupNode = $node.ParentNode
        $nodes = @(Select-Xml -xpath &quot;//msb:PropertyGroup/msb:TargetFrameworkProfile&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        if($nodes.Count -eq 0)&#123;
            $node = $proj.CreateElement(&quot;TargetFrameworkProfile&quot;, $proj.DocumentElement.NamespaceURI)
            [void]$propertyGroupNode.AppendChild($node)
            Write-Output &#39;Adding TargetFrameworkProfile node for PropertyGroup&#39;
        &#125;
        #$nodes = @(Select-Xml -xpath &quot;//msb:PropertyGroup/msb:CopyNuGetImplementations&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        #if($nodes.Count -eq 0)&#123;
        #    $node = $proj.CreateElement(&quot;CopyNuGetImplementations&quot;, $proj.DocumentElement.NamespaceURI)
        #    $textnode = $proj.CreateTextNode(&quot;true&quot;)
        #    $node.AppendChild($textnode)
        #    [void]$propertyGroupNode.AppendChild($node)
        #    Write-Output &#39;Adding CopyNuGetImplementations node for PropertyGroup&#39;
        #&#125;
        $nodes = @(Select-Xml -xpath &quot;//msb:PropertyGroup/msb:PlatformTarget[not(@*)]&quot; $proj -Namespace $MsbNS | foreach &#123;$_.Node&#125;)
        if($nodes.Count -eq 0)&#123;
            $node = $proj.CreateElement(&quot;PlatformTarget&quot;, $proj.DocumentElement.NamespaceURI)
            $textnode = $proj.CreateTextNode(&quot;AnyCPU&quot;)
            $foo = $node.AppendChild($textnode)
            [void]$propertyGroupNode.AppendChild($node)
            Write-Output &#39;Adding PlatformTarget node for PropertyGroup&#39;
        &#125;
    &#125;

    # replace ToolsVersion with 14.0
    $attibutes = Select-Xml -xpath &quot;//@ToolsVersion&quot; $proj -Namespace $MsbNS
    foreach ($attribute in $attibutes)&#123;

        $attribute.Node.value = &quot;14.0&quot;
        Write-Output &#39;Setting ToolsVersion to 14.0&#39;
    &#125;

    $proj.Save($CsProjFilePath)
 &#125;
</code></pre>
<p>Till next time, happy NuGetting!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kamsar.net/index.php/2016/09/Nugetify-your-Sitecore-References/" data-id="ckrl9emyz006498q72acmf52o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/index.php/2016/10/Become-a-Sitecore-admin-without-a-login/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Become a Sitecore admin without a login
        
      </div>
    </a>
  
  
    <a href="/index.php/2016/09/Precompiled-Views-with-Sitecore-8-2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Precompiled Views with Sitecore 8.2</div>
    </a>
  
</nav>

  
</article>

</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JavaScript/">JavaScript</a></p>
              <p class="item-title"><a href="/index.php/2021/07/Fun-with-async-generators-and-for-await/" class="title">Fun with async generators and for await</a></p>
              <p class="item-date"><time datetime="2021-07-26T23:30:51.000Z" itemprop="datePublished">July 26, 2021</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/Jamstack/">Jamstack</a></p>
              <p class="item-title"><a href="/index.php/2020/08/Deploying-multiple-Netlify-sites-from-one-Git-repository/" class="title">Deploying multiple Netlify sites from one monorepo</a></p>
              <p class="item-date"><time datetime="2020-08-21T03:30:32.000Z" itemprop="datePublished">August 20, 2020</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-2-Build-containers/" class="title">Running JSS headless mode in containers part 2: Build containers</a></p>
              <p class="item-date"><time datetime="2019-09-16T02:14:04.000Z" itemprop="datePublished">September 15, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/JSS/">JSS</a></p>
              <p class="item-title"><a href="/index.php/2019/09/Running-JSS-headless-mode-in-containers-part-1/" class="title">Running JSS headless mode in containers, part 1</a></p>
              <p class="item-date"><time datetime="2019-09-08T19:00:36.000Z" itemprop="datePublished">September 8, 2019</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/index.php/category/C/">C#</a></p>
              <p class="item-title"><a href="/index.php/2019/05/Build-2019-All-the-things/" class="title">Build 2019: All the things</a></p>
              <p class="item-date"><time datetime="2019-05-10T23:01:11.000Z" itemprop="datePublished">May 10, 2019</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/April-1/">April 1</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Blade/">Blade</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Build-Scripts/">Build Scripts</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Dianoga/">Dianoga</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JSS/">JSS</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Jamstack/">Jamstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/">Sitecore</a><span class="category-list-count">39</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Crypto/">Crypto</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Lucene/">Lucene</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/MVC/">MVC</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/Search/">Search</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Sitecore/xDB/">xDB</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Synthesis/">Synthesis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/Unicorn/">Unicorn</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/index.php/category/WebConsole/">WebConsole</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>&copy; 2021 Kam Figy</p>
      <p><small>Opinions expressed on this blog are my own, and not necessarily those of my employer.</small></p>
     <p><small>This work is licensed under a <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</small></p>
    </div>
  </div>
</footer>
    


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>